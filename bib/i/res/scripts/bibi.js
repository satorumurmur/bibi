/*!
 *
 * # BiB/i | Copyright (c) Satoru MATSUSHIMA - http://bibi.epub.link/ or https://github.com/satorumurmur/bibi | Licensed under the MIT license.
 *
 * ## Including:
 * 1. dev-bib/i/res/scripts/__lib/npo.src.js    - Native Promise Only | Copyright (c) Kyle Simpson - https://github.com/getify/native-promise-only | Licensed under the MIT license.
 * 2. dev-bib/i/res/scripts/__lib/hammer.min.js - Hammer.js | Copyright (c) Jorik Tangelder - http://hammerjs.github.io/ | Licensed under the MIT license.
 * 3. dev-bib/i/res/scripts/__lib/easing.js     - easing.js | Copyright (c) Dan Rogers - https://github.com/danro/easing-js | Licensed under the MIT license.
 * 4. dev-bib/i/res/scripts/__lib/sML.js        - sML | Copyright (c) Satoru MATSUSHIMA - https://github.com/satorumurmur/sML | Licensed under the MIT license.
 * 5. dev-bib/i/res/scripts/bibi.core.js        - BiB/i Core
 */
/*! Native Promise Only
    v0.7.6-a (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
!function(a,b,c){b[a]=b[a]||c(),"undefined"!=typeof module&&module.exports?module.exports=b[a]:"function"==typeof define&&define.amd&&define(function(){return b[a]})}("Promise","undefined"!=typeof global?global:this,function(){"use strict";function a(a,b){m.add(a,b),l||(l=o(m.drain))}function b(a){var b,c=typeof a;return null==a||"object"!=c&&"function"!=c||(b=a.then),"function"==typeof b?b:!1}function c(){for(var a=0;a<this.chain.length;a++)d(this,1===this.state?this.chain[a].success:this.chain[a].failure,this.chain[a]);this.chain.length=0}function d(a,c,d){var e,f;try{c===!1?d.reject(a.msg):(e=c===!0?a.msg:c.call(void 0,a.msg),e===d.promise?d.reject(TypeError("Promise-chain cycle")):(f=b(e))?f.call(e,d.resolve,d.reject):d.resolve(e))}catch(g){d.reject(g)}}function e(d){var g,i,j=this;if(!j.triggered){j.triggered=!0,j.def&&(j=j.def);try{(g=b(d))?(i=new h(j),g.call(d,function(){e.apply(i,arguments)},function(){f.apply(i,arguments)})):(j.msg=d,j.state=1,j.chain.length>0&&a(c,j))}catch(k){f.call(i||new h(j),k)}}}function f(b){var d=this;d.triggered||(d.triggered=!0,d.def&&(d=d.def),d.msg=b,d.state=2,d.chain.length>0&&a(c,d))}function g(a,b,c,d){for(var e=0;e<b.length;e++)!function(e){a.resolve(b[e]).then(function(a){c(e,a)},d)}(e)}function h(a){this.def=a,this.triggered=!1}function i(a){this.promise=a,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function j(b){if("function"!=typeof b)throw TypeError("Not a function");if(0!==this.__NPO__)throw TypeError("Not a promise");this.__NPO__=1;var d=new i(this);this.then=function(b,e){var f={success:"function"==typeof b?b:!0,failure:"function"==typeof e?e:!1};return f.promise=new this.constructor(function(a,b){if("function"!=typeof a||"function"!=typeof b)throw TypeError("Not a function");f.resolve=a,f.reject=b}),d.chain.push(f),0!==d.state&&a(c,d),f.promise},this["catch"]=function(a){return this.then(void 0,a)};try{b.call(void 0,function(a){e.call(d,a)},function(a){f.call(d,a)})}catch(g){f.call(d,g)}}var k,l,m,n=Object.prototype.toString,o="undefined"!=typeof setImmediate?function(a){return setImmediate(a)}:setTimeout;try{Object.defineProperty({},"x",{}),k=function(a,b,c,d){return Object.defineProperty(a,b,{value:c,writable:!0,configurable:d!==!1})}}catch(p){k=function(a,b,c){return a[b]=c,a}}m=function(){function a(a,b){this.fn=a,this.self=b,this.next=void 0}var b,c,d;return{add:function(e,f){d=new a(e,f),c?c.next=d:b=d,c=d,d=void 0},drain:function(){var a=b;for(b=c=l=void 0;a;)a.fn.call(a.self),a=a.next}}}();var q=k({},"constructor",j,!1);return k(j,"prototype",q,!1),k(q,"__NPO__",0,!1),k(j,"resolve",function(a){var b=this;return a&&"object"==typeof a&&1===a.__NPO__?a:new b(function(b,c){if("function"!=typeof b||"function"!=typeof c)throw TypeError("Not a function");b(a)})}),k(j,"reject",function(a){return new this(function(b,c){if("function"!=typeof b||"function"!=typeof c)throw TypeError("Not a function");c(a)})}),k(j,"all",function(a){var b=this;return"[object Array]"!=n.call(a)?b.reject(TypeError("Not an array")):0===a.length?b.resolve([]):new b(function(c,d){if("function"!=typeof c||"function"!=typeof d)throw TypeError("Not a function");var e=a.length,f=Array(e),h=0;g(b,a,function(a,b){f[a]=b,++h===e&&c(f)},d)})}),k(j,"race",function(a){var b=this;return"[object Array]"!=n.call(a)?b.reject(TypeError("Not an array")):new b(function(c,d){if("function"!=typeof c||"function"!=typeof d)throw TypeError("Not a function");g(b,a,function(a,b){c(b)},d)})}),j}),/*! Hammer.JS - v2.0.4 - 2014-09-28
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2014 Jorik Tangelder;
 * Licensed under the MIT license */
!function(a,b,c,d){"use strict";function e(a,b,c){return setTimeout(k(a,c),b)}function f(a,b,c){return Array.isArray(a)?(g(a,c[b],c),!0):!1}function g(a,b,c){var e;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0;e<a.length;)b.call(c,a[e],e,a),e++;else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(a,b,c){for(var e=Object.keys(b),f=0;f<e.length;)(!c||c&&a[e[f]]===d)&&(a[e[f]]=b[e[f]]),f++;return a}function i(a,b){return h(a,b,!0)}function j(a,b,c){var d,e=b.prototype;d=a.prototype=Object.create(e),d.constructor=a,d._super=e,c&&h(d,c)}function k(a,b){return function(){return a.apply(b,arguments)}}function l(a,b){return typeof a==ka?a.apply(b?b[0]||d:d,b):a}function m(a,b){return a===d?b:a}function n(a,b,c){g(r(b),function(b){a.addEventListener(b,c,!1)})}function o(a,b,c){g(r(b),function(b){a.removeEventListener(b,c,!1)})}function p(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function q(a,b){return a.indexOf(b)>-1}function r(a){return a.trim().split(/\s+/g)}function s(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==b||!c&&a[d]===b)return d;d++}return-1}function t(a){return Array.prototype.slice.call(a,0)}function u(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];s(e,g)<0&&d.push(a[f]),e[f]=g,f++}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function v(a,b){for(var c,e,f=b[0].toUpperCase()+b.slice(1),g=0;g<ia.length;){if(c=ia[g],e=c?c+f:b,e in a)return e;g++}return d}function w(){return oa++}function x(a){var b=a.ownerDocument;return b.defaultView||b.parentWindow}function y(a,b){var c=this;this.manager=a,this.callback=b,this.element=a.element,this.target=a.options.inputTarget,this.domHandler=function(b){l(a.options.enable,[a])&&c.handler(b)},this.init()}function z(a){var b,c=a.options.inputClass;return new(b=c?c:ra?N:sa?Q:qa?S:M)(a,A)}function A(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&ya&&d-e===0,g=b&(Aa|Ba)&&d-e===0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,B(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function B(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=E(b)),e>1&&!c.firstMultiple?c.firstMultiple=E(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=F(d);b.timeStamp=na(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=J(h,i),b.distance=I(h,i),C(c,b),b.offsetDirection=H(b.deltaX,b.deltaY),b.scale=g?L(g.pointers,d):1,b.rotation=g?K(g.pointers,d):0,D(c,b);var j=a.element;p(b.srcEvent.target,j)&&(j=b.srcEvent.target),b.target=j}function C(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};(b.eventType===ya||f.eventType===Aa)&&(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function D(a,b){var c,e,f,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=Ba&&(i>xa||h.velocity===d)){var j=h.deltaX-b.deltaX,k=h.deltaY-b.deltaY,l=G(i,j,k);e=l.x,f=l.y,c=ma(l.x)>ma(l.y)?l.x:l.y,g=H(j,k),a.lastInterval=b}else c=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=e,b.velocityY=f,b.direction=g}function E(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:la(a.pointers[c].clientX),clientY:la(a.pointers[c].clientY)},c++;return{timeStamp:na(),pointers:b,center:F(b),deltaX:a.deltaX,deltaY:a.deltaY}}function F(a){var b=a.length;if(1===b)return{x:la(a[0].clientX),y:la(a[0].clientY)};for(var c=0,d=0,e=0;b>e;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:la(c/b),y:la(d/b)}}function G(a,b,c){return{x:b/a||0,y:c/a||0}}function H(a,b){return a===b?Ca:ma(a)>=ma(b)?a>0?Da:Ea:b>0?Fa:Ga}function I(a,b,c){c||(c=Ka);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function J(a,b,c){c||(c=Ka);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function K(a,b){return J(b[1],b[0],La)-J(a[1],a[0],La)}function L(a,b){return I(b[0],b[1],La)/I(a[0],a[1],La)}function M(){this.evEl=Na,this.evWin=Oa,this.allow=!0,this.pressed=!1,y.apply(this,arguments)}function N(){this.evEl=Ra,this.evWin=Sa,y.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function O(){this.evTarget=Ua,this.evWin=Va,this.started=!1,y.apply(this,arguments)}function P(a,b){var c=t(a.touches),d=t(a.changedTouches);return b&(Aa|Ba)&&(c=u(c.concat(d),"identifier",!0)),[c,d]}function Q(){this.evTarget=Xa,this.targetIds={},y.apply(this,arguments)}function R(a,b){var c=t(a.touches),d=this.targetIds;if(b&(ya|za)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=t(a.changedTouches),h=[],i=this.target;if(f=c.filter(function(a){return p(a.target,i)}),b===ya)for(e=0;e<f.length;)d[f[e].identifier]=!0,e++;for(e=0;e<g.length;)d[g[e].identifier]&&h.push(g[e]),b&(Aa|Ba)&&delete d[g[e].identifier],e++;return h.length?[u(f.concat(h),"identifier",!0),h]:void 0}function S(){y.apply(this,arguments);var a=k(this.handler,this);this.touch=new Q(this.manager,a),this.mouse=new M(this.manager,a)}function T(a,b){this.manager=a,this.set(b)}function U(a){if(q(a,bb))return bb;var b=q(a,cb),c=q(a,db);return b&&c?cb+" "+db:b||c?b?cb:db:q(a,ab)?ab:_a}function V(a){this.id=w(),this.manager=null,this.options=i(a||{},this.defaults),this.options.enable=m(this.options.enable,!0),this.state=eb,this.simultaneous={},this.requireFail=[]}function W(a){return a&jb?"cancel":a&hb?"end":a&gb?"move":a&fb?"start":""}function X(a){return a==Ga?"down":a==Fa?"up":a==Da?"left":a==Ea?"right":""}function Y(a,b){var c=b.manager;return c?c.get(a):a}function Z(){V.apply(this,arguments)}function $(){Z.apply(this,arguments),this.pX=null,this.pY=null}function _(){Z.apply(this,arguments)}function aa(){V.apply(this,arguments),this._timer=null,this._input=null}function ba(){Z.apply(this,arguments)}function ca(){Z.apply(this,arguments)}function da(){V.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ea(a,b){return b=b||{},b.recognizers=m(b.recognizers,ea.defaults.preset),new fa(a,b)}function fa(a,b){b=b||{},this.options=i(b,ea.defaults),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.element=a,this.input=z(this),this.touchAction=new T(this,this.options.touchAction),ga(this,!0),g(b.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[3])},this)}function ga(a,b){var c=a.element;g(a.options.cssProps,function(a,d){c.style[v(c.style,d)]=b?a:""})}function ha(a,c){var d=b.createEvent("Event");d.initEvent(a,!0,!0),d.gesture=c,c.target.dispatchEvent(d)}var ia=["","webkit","moz","MS","ms","o"],ja=b.createElement("div"),ka="function",la=Math.round,ma=Math.abs,na=Date.now,oa=1,pa=/mobile|tablet|ip(ad|hone|od)|android/i,qa="ontouchstart"in a,ra=v(a,"PointerEvent")!==d,sa=qa&&pa.test(navigator.userAgent),ta="touch",ua="pen",va="mouse",wa="kinect",xa=25,ya=1,za=2,Aa=4,Ba=8,Ca=1,Da=2,Ea=4,Fa=8,Ga=16,Ha=Da|Ea,Ia=Fa|Ga,Ja=Ha|Ia,Ka=["x","y"],La=["clientX","clientY"];y.prototype={handler:function(){},init:function(){this.evEl&&n(this.element,this.evEl,this.domHandler),this.evTarget&&n(this.target,this.evTarget,this.domHandler),this.evWin&&n(x(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&o(this.element,this.evEl,this.domHandler),this.evTarget&&o(this.target,this.evTarget,this.domHandler),this.evWin&&o(x(this.element),this.evWin,this.domHandler)}};var Ma={mousedown:ya,mousemove:za,mouseup:Aa},Na="mousedown",Oa="mousemove mouseup";j(M,y,{handler:function(a){var b=Ma[a.type];b&ya&&0===a.button&&(this.pressed=!0),b&za&&1!==a.which&&(b=Aa),this.pressed&&this.allow&&(b&Aa&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:va,srcEvent:a}))}});var Pa={pointerdown:ya,pointermove:za,pointerup:Aa,pointercancel:Ba,pointerout:Ba},Qa={2:ta,3:ua,4:va,5:wa},Ra="pointerdown",Sa="pointermove pointerup pointercancel";a.MSPointerEvent&&(Ra="MSPointerDown",Sa="MSPointerMove MSPointerUp MSPointerCancel"),j(N,y,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Pa[d],f=Qa[a.pointerType]||a.pointerType,g=f==ta,h=s(b,a.pointerId,"pointerId");e&ya&&(0===a.button||g)?0>h&&(b.push(a),h=b.length-1):e&(Aa|Ba)&&(c=!0),0>h||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Ta={touchstart:ya,touchmove:za,touchend:Aa,touchcancel:Ba},Ua="touchstart",Va="touchstart touchmove touchend touchcancel";j(O,y,{handler:function(a){var b=Ta[a.type];if(b===ya&&(this.started=!0),this.started){var c=P.call(this,a,b);b&(Aa|Ba)&&c[0].length-c[1].length===0&&(this.started=!1),this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:ta,srcEvent:a})}}});var Wa={touchstart:ya,touchmove:za,touchend:Aa,touchcancel:Ba},Xa="touchstart touchmove touchend touchcancel";j(Q,y,{handler:function(a){var b=Wa[a.type],c=R.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:ta,srcEvent:a})}}),j(S,y,{handler:function(a,b,c){var d=c.pointerType==ta,e=c.pointerType==va;if(d)this.mouse.allow=!1;else if(e&&!this.mouse.allow)return;b&(Aa|Ba)&&(this.mouse.allow=!0),this.callback(a,b,c)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Ya=v(ja.style,"touchAction"),Za=Ya!==d,$a="compute",_a="auto",ab="manipulation",bb="none",cb="pan-x",db="pan-y";T.prototype={set:function(a){a==$a&&(a=this.compute()),Za&&(this.manager.element.style[Ya]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return g(this.manager.recognizers,function(b){l(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),U(a.join(" "))},preventDefaults:function(a){if(!Za){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,e=q(d,bb),f=q(d,db),g=q(d,cb);return e||f&&c&Ha||g&&c&Ia?this.preventSrc(b):void 0}},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var eb=1,fb=2,gb=4,hb=8,ib=hb,jb=16,kb=32;V.prototype={defaults:{},set:function(a){return h(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(f(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=Y(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return f(a,"dropRecognizeWith",this)?this:(a=Y(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(f(a,"requireFailure",this))return this;var b=this.requireFail;return a=Y(a,this),-1===s(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(f(a,"dropRequireFailure",this))return this;a=Y(a,this);var b=s(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(c.options.event+(b?W(d):""),a)}var c=this,d=this.state;hb>d&&b(!0),b(),d>=hb&&b(!0)},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=kb)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(kb|eb)))return!1;a++}return!0},recognize:function(a){var b=h({},a);return l(this.options.enable,[this,b])?(this.state&(ib|jb|kb)&&(this.state=eb),this.state=this.process(b),void(this.state&(fb|gb|hb|jb)&&this.tryEmit(b))):(this.reset(),void(this.state=kb))},process:function(){},getTouchAction:function(){},reset:function(){}},j(Z,V,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(fb|gb),e=this.attrTest(a);return d&&(c&Ba||!e)?b|jb:d||e?c&Aa?b|hb:b&fb?b|gb:fb:kb}}),j($,Z,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ja},getTouchAction:function(){var a=this.options.direction,b=[];return a&Ha&&b.push(db),a&Ia&&b.push(cb),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Ha?(e=0===f?Ca:0>f?Da:Ea,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?Ca:0>g?Fa:Ga,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return Z.prototype.attrTest.call(this,a)&&(this.state&fb||!(this.state&fb)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=X(a.direction);b&&this.manager.emit(this.options.event+b,a),this._super.emit.call(this,a)}}),j(_,Z,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[bb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&fb)},emit:function(a){if(this._super.emit.call(this,a),1!==a.scale){var b=a.scale<1?"in":"out";this.manager.emit(this.options.event+b,a)}}}),j(aa,V,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[_a]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(Aa|Ba)&&!f)this.reset();else if(a.eventType&ya)this.reset(),this._timer=e(function(){this.state=ib,this.tryEmit()},b.time,this);else if(a.eventType&Aa)return ib;return kb},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===ib&&(a&&a.eventType&Aa?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=na(),this.manager.emit(this.options.event,this._input)))}}),j(ba,Z,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[bb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&fb)}}),j(ca,Z,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Ha|Ia,pointers:1},getTouchAction:function(){return $.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Ha|Ia)?b=a.velocity:c&Ha?b=a.velocityX:c&Ia&&(b=a.velocityY),this._super.attrTest.call(this,a)&&c&a.direction&&a.distance>this.options.threshold&&ma(b)>this.options.velocity&&a.eventType&Aa},emit:function(a){var b=X(a.direction);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),j(da,V,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[ab]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime<b.time;if(this.reset(),a.eventType&ya&&0===this.count)return this.failTimeout();if(d&&f&&c){if(a.eventType!=Aa)return this.failTimeout();var g=this.pTime?a.timeStamp-this.pTime<b.interval:!0,h=!this.pCenter||I(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,h&&g?this.count+=1:this.count=1,this._input=a;var i=this.count%b.taps;if(0===i)return this.hasRequireFailures()?(this._timer=e(function(){this.state=ib,this.tryEmit()},b.interval,this),fb):ib}return kb},failTimeout:function(){return this._timer=e(function(){this.state=kb},this.options.interval,this),kb},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ib&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ea.VERSION="2.0.4",ea.defaults={domEvents:!1,touchAction:$a,enable:!0,inputTarget:null,inputClass:null,preset:[[ba,{enable:!1}],[_,{enable:!1},["rotate"]],[ca,{direction:Ha}],[$,{direction:Ha},["swipe"]],[da],[da,{event:"doubletap",taps:2},["tap"]],[aa]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var lb=1,mb=2;fa.prototype={set:function(a){return h(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?mb:lb},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&ib)&&(e=b.curRecognizer=null);for(var f=0;f<d.length;)c=d[f],b.stopped===mb||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(fb|gb|hb)&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof V)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(f(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(f(a,"remove",this))return this;var b=this.recognizers;return a=this.get(a),b.splice(s(b,a),1),this.touchAction.update(),this},on:function(a,b){var c=this.handlers;return g(r(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this},off:function(a,b){var c=this.handlers;return g(r(a),function(a){b?c[a].splice(s(c[a],b),1):delete c[a]}),this},emit:function(a,b){this.options.domEvents&&ha(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&ga(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},h(ea,{INPUT_START:ya,INPUT_MOVE:za,INPUT_END:Aa,INPUT_CANCEL:Ba,STATE_POSSIBLE:eb,STATE_BEGAN:fb,STATE_CHANGED:gb,STATE_ENDED:hb,STATE_RECOGNIZED:ib,STATE_CANCELLED:jb,STATE_FAILED:kb,DIRECTION_NONE:Ca,DIRECTION_LEFT:Da,DIRECTION_RIGHT:Ea,DIRECTION_UP:Fa,DIRECTION_DOWN:Ga,DIRECTION_HORIZONTAL:Ha,DIRECTION_VERTICAL:Ia,DIRECTION_ALL:Ja,Manager:fa,Input:y,TouchAction:T,TouchInput:Q,MouseInput:M,PointerEventInput:N,TouchMouseInput:S,SingleTouchInput:O,Recognizer:V,AttrRecognizer:Z,Tap:da,Pan:$,Swipe:ca,Pinch:_,Rotate:ba,Press:aa,on:n,off:o,each:g,merge:i,extend:h,inherit:j,bindFn:k,prefixed:v}),typeof define==ka&&define.amd?define(function(){return ea}):"undefined"!=typeof module&&module.exports?module.exports=ea:a[c]=ea}(window,document,"Hammer"),/*!
// --------------------------------------------------
// easing.js v0.5.4
// Generic set of easing functions with AMD support
// https://github.com/danro/easing-js
// This code may be freely distributed under the MIT license
// http://danro.mit-license.org/
// --------------------------------------------------
// All functions adapted from Thomas Fuchs & Jeremy Kahn
// Easing Equations (c) 2003 Robert Penner, BSD license
// https://raw.github.com/danro/easing-js/master/LICENSE
// --------------------------------------------------
 */
function(a,b){"function"==typeof define?define(b):"undefined"!=typeof module?module.exports=b:this[a]=b}("easing",{easeInQuad:function(a){return Math.pow(a,2)},easeOutQuad:function(a){return-(Math.pow(a-1,2)-1)},easeInOutQuad:function(a){return(a/=.5)<1?.5*Math.pow(a,2):-.5*((a-=2)*a-2)},easeInCubic:function(a){return Math.pow(a,3)},easeOutCubic:function(a){return Math.pow(a-1,3)+1},easeInOutCubic:function(a){return(a/=.5)<1?.5*Math.pow(a,3):.5*(Math.pow(a-2,3)+2)},easeInQuart:function(a){return Math.pow(a,4)},easeOutQuart:function(a){return-(Math.pow(a-1,4)-1)},easeInOutQuart:function(a){return(a/=.5)<1?.5*Math.pow(a,4):-.5*((a-=2)*Math.pow(a,3)-2)},easeInQuint:function(a){return Math.pow(a,5)},easeOutQuint:function(a){return Math.pow(a-1,5)+1},easeInOutQuint:function(a){return(a/=.5)<1?.5*Math.pow(a,5):.5*(Math.pow(a-2,5)+2)},easeInSine:function(a){return-Math.cos(a*(Math.PI/2))+1},easeOutSine:function(a){return Math.sin(a*(Math.PI/2))},easeInOutSine:function(a){return-.5*(Math.cos(Math.PI*a)-1)},easeInExpo:function(a){return 0===a?0:Math.pow(2,10*(a-1))},easeOutExpo:function(a){return 1===a?1:-Math.pow(2,-10*a)+1},easeInOutExpo:function(a){return 0===a?0:1===a?1:(a/=.5)<1?.5*Math.pow(2,10*(a-1)):.5*(-Math.pow(2,-10*--a)+2)},easeInCirc:function(a){return-(Math.sqrt(1-a*a)-1)},easeOutCirc:function(a){return Math.sqrt(1-Math.pow(a-1,2))},easeInOutCirc:function(a){return(a/=.5)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},easeOutBounce:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},easeInBack:function(a){var b=1.70158;return a*a*((b+1)*a-b)},easeOutBack:function(a){var b=1.70158;return(a-=1)*a*((b+1)*a+b)+1},easeInOutBack:function(a){var b=1.70158;return(a/=.5)<1?.5*a*a*(((b*=1.525)+1)*a-b):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},elastic:function(a){return-1*Math.pow(4,-8*a)*Math.sin(2*(6*a-1)*Math.PI/2)+1},swingFromTo:function(a){var b=1.70158;return(a/=.5)<1?.5*a*a*(((b*=1.525)+1)*a-b):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},swingFrom:function(a){var b=1.70158;return a*a*((b+1)*a-b)},swingTo:function(a){var b=1.70158;return(a-=1)*a*((b+1)*a+b)+1},bounce:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},bouncePast:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?2-(7.5625*(a-=1.5/2.75)*a+.75):2.5/2.75>a?2-(7.5625*(a-=2.25/2.75)*a+.9375):2-(7.5625*(a-=2.625/2.75)*a+.984375)},easeFromTo:function(a){return(a/=.5)<1?.5*Math.pow(a,4):-.5*((a-=2)*Math.pow(a,3)-2)},easeFrom:function(a){return Math.pow(a,4)},easeTo:function(a){return Math.pow(a,.25)}}),/*!
 *
 * # sML JavaScript Library
 *
 * - "I'm a Simple and Middling Library."
 * - Copyright (c) Satoru MATSUSHIMA - https://github.com/satorumurmur/sML
 * - Licensed under the MIT license. - http://www.opensource.org/licenses/mit-license.php
 *
 * - Wed February 25 22:22:00 2015 +0900
 */
sML=function(){var Version="0.999.14",Build=20150225,sML=function(a){var b="string"==typeof a?[sML.create.apply(this,arguments)]:a.length?a:[a];if(window.__proto__)b.__proto__=sML.SML;else for(var c in sML.SML)b[c]=sML.SML[c];return b};sML.Version=Version,sML.Build=Build;var nUA=navigator.userAgent,v2n=function(a,b){var c=parseFloat(a.replace(b,"$1").replace(/[_\.]/g,",").replace(/\,/,".").replace(/\,/g,""));return isNaN(c)?void 0:c},iOSV=/(iPod|iPhone|iPad)( Simulator)?;/.test(nUA)?v2n(nUA,/^.+? OS ([\d_]+).+$/):void 0,AndV=/Android /.test(nUA)?v2n(nUA,/^.+? Android ([\d\.]+).+$/):void 0;sML.OperatingSystem=sML.OS={OSX:nUA.indexOf("Mac")>-1&&!iOSV?1:void 0,Windows:nUA.indexOf("Windows")>-1?1:void 0,Linux:nUA.indexOf("Linux")>-1&&!AndV?1:void 0,iOS:iOSV,Android:AndV},sML.DeviceName=sML.DN=function(){return sML.OS.OSX?"Mac":sML.OS.Windows?"PC":sML.OS.Linux?"PC":sML.OS.iOS?nUA.replace(/^.+?(iPod|iPhone|iPad)( Simulator)?;.+$/,"$1"):sML.OS.Android?nUA.replace(/^.+?\(.+?; ([^;]+)\).+$/,"$1"):""}(),sML.UserAgent=sML.UA={WebKit:nUA.indexOf("AppleWebKit")>-1?v2n(nUA,/^.+AppleWebKit\/([\d\.]+).+$/):void 0,Safari:nUA.indexOf("Safari/")>-1?v2n(nUA,/^.+Version\/([\d\.]+).+$/):void 0,Chrome:nUA.indexOf("Chrome/")>-1?v2n(nUA,/^.+Chrome\/([\d\.]+).+$/):void 0,Gecko:nUA.indexOf("Gecko/")>-1?v2n(nUA,/^.+rv\:([\d\.]+).+$/):void 0,Firefox:nUA.indexOf("Firefox/")>-1?v2n(nUA,/^.+Firefox\/([\d\.]+).+$/):void 0,Presto:nUA.indexOf("Presto")>-1?v2n(nUA,/^.+Presto\/([\d\.]+).+$/):void 0,Opera:nUA.indexOf("OPR/")>-1?v2n(nUA,/^.+OPR\/([\d\.]+).*$/):void 0,Trident:nUA.indexOf("Trident/")>-1?v2n(nUA,/^.+Trident\/([\d\.]+).*$/):void 0,InternetExplorer:nUA.indexOf("MSIE ")>-1?v2n(nUA,/^.+MSIE ([\d\.]+).*$/):void 0,Flash:void 0},sML.UA.Trident>=7&&(sML.UA.InternetExplorer=v2n(nUA,/^.+rv:([\d\.]+).*$/)),sML.UA.Opera||(sML.UA.Opera=nUA.indexOf("Opera/")>-1?v2n(nUA,/^.+Version\/([\d\.]+).*$/):void 0),sML.Environments=sML.Env=function(a,b){for(var c in b)for(var d in b[c])b[c][d]&&a.push(d);return a}([sML.DeviceName],[sML.OS,sML.UA]);try{sML.UA.Flash=parseFloat(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin.description.replace(/^.+?([\d\.]+).*$/,"$1"))}catch(e){}if(sML.UA.InternetExplorer)try{sML.UA.Flash=parseFloat(new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7").GetVariable("$version").replace(/^[^\d]+(\d+)\,([\d\,]+)$/,"$1.$2").replace(/\,/g,""))}catch(e){}return sML.OS.Mac=sML.OS.OSX,sML.OS.Win=sML.OS.Windows,sML.OS.Lin=sML.OS.Linux,sML.OS.And=sML.OS.Android,sML.UA.WK=sML.UA.WebKit,sML.UA.Sa=sML.UA.Safari,sML.UA.Ch=sML.UA.Chrome,sML.UA.Ge=sML.UA.Gecko,sML.UA.Fx=sML.UA.Firefox,sML.UA.Pr=sML.UA.Presto,sML.UA.Op=sML.UA.Opera,sML.UA.Tr=sML.UA.Trident,sML.UA.IE=sML.UA.InternetExplorer,sML.UA.Fl=sML.UA.Flash,sML.log=function(){try{console.log.apply(console,arguments)}catch(a){}},sML.write=function(){document.open();for(var a=0,b=arguments.length;b>a;a++)document.write(arguments[a]);document.close()},sML.Fill={Prefixes:["webkit","moz","MS","ms","o"],extendElements:function(a){return a},carePrefix:function(a,b){if(b in a)return a[b];b=b[0].toUpperCase()+b.slice(1);for(var c="",d=0,e=this.Prefixes.length;e>d;d++)if(c=this.Prefixes[d]+b,c in a)return a[c];return void 0}},sML.UA.InternetExplorer<9&&(sML.Fill.extendElement=function(a){return a.getElementsByClassName=sML.Fill.getElementsByClassName,a.addEventListener=sML.Fill.addEventListener,a.removeEventListener=sML.Fill.removeEventListener,a},sML.Fill.extendElements=function(a){return sML.Fill.extendElement(a),sML.each(a.getElementsByTagName("*"),function(){sML.Fill.extendElement(this)}),a},sML.Fill.getElementsByClassName=function(a){return this.querySelectorAll("."+a.replace(/^\s+/,"").replace(/\s+$/,"").replace(/\s+/,"."))},sML.Fill.addEventListener=function(a,b){this["FunctionsOn"+a]||(this["FunctionsOn"+a]=[],this["XWrappersOn"+a]=[]);var c=this,d=this["FunctionsOn"+a],e=this["XWrappersOn"+a];if("DOMContentLoaded"==a){var f=function(){"complete"===c.readyState&&b.apply(c,arguments)};a="readystatechange"}else var f=function(){b.apply(c,arguments)};return this.attachEvent("on"+a,f),e.push(f),d.push(b),this},sML.Fill.removeEventListener=function(a,b){for(var c=this["FunctionsOn"+a],d=this["XWrappersOn"+a],e=0,f=c.length;f>e&&c[e]!=b;e++);return"DOMContentLoaded"==a&&(a="readystatechange"),this.detachEvent("on"+a,d[e]),d[e]=c[e]=null,this},window.getComputedStyle=function(a){return a.currentStyle},window.addEventListener=function(a,b){return this.attachEvent("on"+a,b),this},window.removeEventListener=function(a,b){return this.detachEvent("on"+a,b),this},sML.Fill.extendElement(document),document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",arguments.callee),sML.extendElements(document.documentElement))}),window.Event.prototype.stopPropagation=function(){this.cancelBubble=!0},window.Event.prototype.preventDefault=function(){this.returnValue=!1},Array.prototype.map=function(a,b){if("function"!=typeof a)throw new TypeError;for(var c=[],d=0,e=this.length;e>d;d++)c.push(a.call(b,this[d],d,this));return c},Array.prototype.filter=function(a,b){if("function"!=typeof a)throw new TypeError;for(var c=[],d=0,e=this.length;e>d;d++)a.call(b,this[d],d,this)&&c.push(this[d]);return c},Array.prototype.forEach=function(a,b){if("function"!=typeof a)throw new TypeError;for(var c=0,d=this.length;d>c;c++)a.call(b,this[c],c,this)},["section","article","nav","aside","header","footer","figure"].forEach(function(a){document.createElement(a)})),sML.UA.InternetExplorer<=9&&("undefined"==typeof window.console&&(window.console={}),"function"!=typeof window.console.log&&(window.console.log=function(){})),sML.extendElements=sML.Fill.extendElements,window.requestAnimationFrame=sML.Fill.carePrefix(window,"requestAnimationFrame")||function(a){setTimeout(a,1e3/60)},sML.Event={OnRead:{Done:!1,Functions:[]},OnLoad:{Done:!1,Functions:[]},add:function(a,b,c,d){return a.addEventListener(b,c,d?!0:!1),a},remove:function(a,b,c,d){return a.removeEventListener(b,c,d?!0:!1),a},stopPropagation:function(){/*@cc_on @if (@_jscript_version<9) arguments[0]=event; @end @*/return arguments[0].stopPropagation()},preventDefault:function(){/*@cc_on @if (@_jscript_version<9) arguments[0]=event; @end @*/return arguments[0].preventDefault()}},sML.addEventListener=sML.Event.add,sML.removeEventListener=sML.Event.remove,sML.stopPropagation=sML.Event.stopPropagation,sML.preventDefault=sML.Event.preventDefault,sML.Event.OnRead.doOnRead=sML.Event.OnLoad.doOnLoad=function(){if(!this.Done)for(this.Done=!0;this.Functions.length;)this.Functions.shift()()},sML.Event.OnRead.addEventListener=sML.Event.OnLoad.addEventListener=function(a){return this.Done?a():this.Functions.push(a)},sML.onread=sML.ready=function(a){return sML.Event.OnRead.addEventListener(a)},sML.onload=sML.done=function(a){return sML.Event.OnLoad.addEventListener(a)},document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,!1),sML.Event.OnRead.doOnRead()},!1),window.addEventListener("load",function(){window.removeEventListener("load",arguments.callee,!1),sML.Event.OnRead.doOnRead(),sML.Event.OnLoad.doOnLoad()},!1),sML.Event.OnResizeFont=sML.onResizeFont=sML.onresizefont={RegularFunctions:[],onZoomInFunctions:[],onZoomOutFunctions:[],addEventListener:function(a,b){b&&b>0?this.onZoomInFunctions.push(a):b&&0>b?this.onZoomOutFunctions.push(a):this.RegularFunctions.push(a)},detect:function(a,b){if(!a)var a=document.body;if(!b)var b=200;this.checker=a,this.timer=setInterval(function(){var a=sML.Coord.getElementSize(sML.onResizeFont.checker).h;if(sML.onResizeFont.prevHeight&&sML.onResizeFont.prevHeight!=a){var b=sML.onResizeFont.RegularFunctions;sML.onResizeFont.prevHeight&&sML.onResizeFont.prevHeight<a?b=b.concat(sML.onResizeFont.onZoomInFunctions):sML.onResizeFont.prevHeight&&sML.onResizeFont.prevHeight>a&&(b=b.concat(sML.onResizeFont.onZoomOutFunctions));for(var c=0,d=b.length;d>c;c++)b[c]()}sML.onResizeFont.prevHeight=a},b)},stopDetect:function(){this.timer&&clearTimeout(this.timer)}},sML.addTouchEventObserver=sML.observeTouch=function(a,b){/*! Requires Hammer.js - http://hammerjs.github.io/ - Copyright (c) Jorik Tangelder - Licensed under the MIT license. */
if(a.addTouchEventListener)return a;if(!window.Hammer)return sML.edit(a,{addTouchEventListener:function(){return!1},removeTouchEventListener:function(){return!1}});var c=new Hammer.Manager(a);return(!b||b.Pan)&&c.add(new Hammer.Pan({threshold:0,pointers:0})),(!b||b.Swipe)&&c.add(new Hammer.Swipe).recognizeWith(c.get("pan")),(!b||b.Rotate)&&c.add(new Hammer.Rotate({threshold:0})).recognizeWith(c.get("pan")),(!b||b.Pinch)&&c.add(new Hammer.Pinch({threshold:0})).recognizeWith([c.get("pan"),c.get("rotate")]),(!b||b.DoubleTap)&&c.add(new Hammer.Tap({event:"doubletap",taps:2})),(!b||b.Tap)&&c.add(new Hammer.Tap),sML.edit(a,{TouchEventObserver:c,TouchEventHandlers:[],addTouchEventListener:function(b,c){var d=function(b){c.apply(a,[b.srcEvent,b])};return a.TouchEventHandlers.push([c,d]),a.TouchEventObserver.on(b,d),a},removeTouchEventListener:function(b,c){if(c&&"function"==typeof c){for(var d=[],e=0,f=a.TouchEventHandlers.length;f>e;e++)a.TouchEventHandlers[e][0]==c?a.TouchEventObserver.off(b,a.TouchEventHandlers[e][1]):d.push(a.TouchEventHandlers[e]);a.TouchEventHandlers=d}else a.TouchEventObserver.off(b);return a}})},sML.Chain=function(){this.Functions=arguments.length?sML.toArray(arguments):[],this.add=function(){for(var a=0,b=arguments.length;b>a;a++)this.Functions.push(arguments[a])},this.start=this.next=function(){var a=this.Functions.shift();"function"==typeof a&&a.apply(null,arguments)},this.skip=function(a){if("number"==typeof a)for(var b=0;a>b;b++)this.Functions.shift()}},sML.Timers={setTimeout:function(){var a=Array.prototype.shift.call(arguments),b=Array.prototype.shift.call(arguments);return Array.prototype.unshift.call(arguments,a),Array.prototype.unshift.call(arguments,b),setTimeout.apply(window,arguments)},setInterval:function(){var a=Array.prototype.shift.call(arguments),b=Array.prototype.shift.call(arguments);return Array.prototype.unshift.call(arguments,a),Array.prototype.unshift.call(arguments,b),setInterval.apply(window,arguments)}},sML.setTimeout=sML.Timers.setTimeout,sML.setInterval=sML.Timers.setInterval,sML.Drawer={draw:function(a,b){a.ToBeDrawn||(requestAnimationFrame(function(){b.apply(a,arguments),a.ToBeDrawn=!1}),a.ToBeDrawn=!0)}},sML.draw=sML.Drawer.draw,sML.getElements=sML.getElementsBySelector=function(){for(var a=1,b=arguments.length;b>a;a++)arguments[0]+=","+arguments[a];return document.querySelectorAll(arguments[0])},sML.cloneObject=function(a){var b=function(){};return b.prototype=a,new b},sML.set=sML.edit=sML.setProperties=sML.setMembers=function(a,b,c){if(b){b.ObserveTouch&&(sML.addTouchEventObserver(a),delete b.ObserveTouch);for(var d in b)/^data-/.test(d)?a.setAttribute(d,b[d]):a[d]=b[d]}/*@cc_on @if (@_jscript_version<9) sML.Fill.extendElements(arguments[0]); @end @*/
return c&&sML.CSS.set(a,c),a},sML.create=sML.createElement=function(a,b,c){return sML.set(document.createElement(a),b,c)},sML.changeClass=sML.changeClassName=function(a,b){return b?a.className=b:a.removeAttribute("class"),a.className},sML.addClass=sML.addClassName=function(a,b){if("string"!=typeof b)return a.className;if(b=b.replace(/ +/g," ").replace(/^ /,"").replace(/ $/,""),!b)return a.className;if(a.className){if((" "+a.className+" ").indexOf(" "+b+" ")>-1)return a.className;b=a.className+" "+b}return sML.changeClass(a,b)},sML.removeClass=sML.removeClassName=function(a,b){return a.className?"string"!=typeof b?a.className:(b=b.replace(/ +/g," ").replace(/^ /,"").replace(/ $/,""))?(" "+a.className+" ").indexOf(" "+b+" ")<0?a.className:(b=(" "+a.className+" ").replace(" "+b+" "," ").replace(/ +/g," ").replace(/^ /,"").replace(/ $/,""),sML.changeClass(a,b)):a.className:""},sML.replaceClass=sML.replaceClassName=function(a,b,c){return sML.removeClass(a,b),sML.addClass(a,c),a.className},sML.appendChildren=function(a,b){if(a.length)for(var c=0,d=a.length;d>c;c++)b.appendChild(a[c]);else b.appendChild(a);return a},sML.insertBefore=function(a,b){return b.parentNode.insertBefore(a,b),b.previousSibling},sML.insertAfter=function(a,b){return b.parentNode.insertBefore(a,b.nextSibling),b.nextSibling},sML.replaceElement=function(a,b){return b.parentNode.insertBefore(a,b),a=b.previousSibling,b.parentNode.removeChild(b),a},sML.removeElement=function(a){a.parentNode.removeChild(a)},sML.deleteElement=function(a){a.parentNode&&a.parentNode.removeChild(a),a.innerHTML="",a=null,delete a},sML.hatch=function(){for(var a="",b=0,c=arguments.length;c>b;b++)a+=arguments[b];var d=document.createElement("div"),e=document.createDocumentFragment(),f=function(){d.innerHTML=a;for(var b=0,c=d.childNodes.length;c>b;b++)e.appendChild(d.firstChild)};return sML.UA.InternetExplorer<9?(document.body.appendChild(d).style.display="none",f(),document.body.removeChild(d)):f(),e},sML.getContentDocument=function(a){return sML.UA.IE<8?a.contentWindow.document:a.contentDocument},sML.CSS=sML.S={Prefix:sML.UA.WK?"Webkit":sML.UA.Ge?"Moz":sML.UA.IE?"ms":"",TransitionEnd:sML.UA.WK?"webkitTransitionEnd":sML.UA.Ge?"transitionend":sML.UA.IE?"MSTransitionEnd":"",AnimationEnd:sML.UA.WK?"webkitAnimationEnd":sML.UA.Ge?"animationend":sML.UA.IE?"MSAnimationEnd":"",Catalogue:[],getSFO:function(a){for(var b=0,c=this.Catalogue.length;c>b;b++)if(this.Catalogue[b].Element==a)return this.Catalogue[b];return this.Catalogue[this.Catalogue.push({Element:a})-1]},getComputedStyle:function(a,b){var c=a.currentStyle||document.defaultView.getComputedStyle(a,b?b:"");return c},StyleSheets:[],getStyleSheet:function(a){if(sML.UA.IE<9)return a.styleSheets[a.styleSheets.length-1];for(var b=0,c=this.StyleSheets.length;c>b;b++)if(this.StyleSheets[b].StyleFor==a)return this.StyleSheets[b].StyleSheet;var d=a.createElement("style");return d.appendChild(a.createTextNode("")),a.getElementsByTagName("head")[0].appendChild(d),this.StyleSheets.push({StyleFor:a,StyleSheet:d.sheet}),d.sheet},addRule:function(a,b,c){if("function"==typeof b.join)b=b.join(" ");else if("object"==typeof b){var d=[];for(var e in b)d.push(e+": "+b[e]+";");b=d.join(" ")}var f=this.getStyleSheet(c?c:document);if(f){if(f.addRule){var g=f.rules.length;return f.addRule(a,b,g),g}if(f.insertRule)return f.insertRule(a+"{"+b+"}",f.cssRules.length)}return null},addRules:function(a,b){var c=[];if("function"==typeof a.join)for(var d=0,e=a.length/2;e>d;d++)c.push(this.addRule(a[2*d],a[2*d+1],b));else if("object"==typeof a)for(var f in a)c.push(this.addRule(f,a[f],b));return c},add:function(a,b){return this.addRules(a,b)},removeRule:function(a,b){var c=this.getStyleSheet(b?b:document);if(c){if(c.removeRule)c.removeRule(a);else{if(!c.deleteRule)return null;c.deleteRule(a)}return a}return null},removeRules:function(a,b){for(var c=0,d=a.length;d>c;c++)this.removeRule(a[c],b);return a},remove:function(a,b){return this.removeRules(a,b)},setProperty:function(a,b,c){return a&&b?(/^(animation|background(-s|S)ize|box|break|column|filter|flow|hyphens|region|shape|transform|transition|writing)/.test(b)?a.style[this.Prefix+b.replace(/(-|^)([a-z])/g,function(a,b,c){return c?c.toUpperCase():""})]=c:"float"==b&&(b=sML.UA.IE?"styleFloat":"cssFloat"),a.style[b]=c,a):a},addTransitionEndListener:function(a,b){"function"==typeof b&&(a.sMLTransitionEndListener=b,sML.Event.add(a,this.TransitionEnd,a.sMLTransitionEndListener))},removeTransitionEndListener:function(a){"function"==typeof a.sMLTransitionEndListener&&(sML.Event.remove(a,this.TransitionEnd,a.sMLTransitionEndListener),delete a.sMLTransitionEndListener)},set:function(a,b,c){if(!a||"object"!=typeof b)return a;if(this.removeTransitionEndListener(a),"function"==typeof c&&this.addTransitionEndListener(a,c),!(b instanceof Array)){var d=[];for(var e in b)/^transition/.test(e)?this.setProperty(a,e,b[e]):d[d.push(e)]=b[e];b=d}if(b.length%2<1)for(var f=0,g=b.length/2;g>f;f++)this.setProperty(a,b[2*f],b[2*f+1]);return a},getRGB:function(a){for(var b=a.replace(/rgb\(([\d\., ]+)\)/,"$1").replace(/\s/g,"").split(","),c=0,d=b.length;d>c;c++)b[c]=parseInt(b[c]);return b},getRGBA:function(a){for(var b=a.replace(/rgba?\(([\d\., ]+)\)/,"$1").replace(/\s/g,"").split(","),c=0,d=b.length;d>c;c++)b[c]=parseInt(b[c]);return b[3]||(b[3]=1),b}},sML.style=sML.css=function(a,b,c){return sML.CSS.set(a,b,c)},sML.Easing="object"==typeof window.easing?window.easing:{},sML.Easing.linear=function(a){return a},sML.Easing.getEaser=function(a){return function(b){return b+a/100*(1-b)*b}},sML.Transition=sML.T={Catalogue:[],getSFO:function(a){for(var b=0,c=this.Catalogue.length;c>b;b++)if(this.Catalogue[b].Element==a)return this.Catalogue[b];return this.Catalogue[this.Catalogue.push({Element:a})-1]},begin:function(a,b,c){if(!b)var b={};if(!c)var c={};this.Element=a;var d=this.getSFO(a);d.Timer&&clearTimeout(d.Timer),d.Param={c:0,f:b.f?b.f:10,t:b.t?b.t:10,e:b.e?b.e:null,x:b.x?b.x:null},d.Functions={s:c.s?c.s:null,m:c.m?c.m:null,e:c.e?c.e:null,c:c.c?c.c:null},d.gN=d.getNext=function(a,b,c,e){var f=1,g=d.Param.c/d.Param.f;if(!c&&d.Param.e)var c=d.Param.e;if(!e&&d.Param.x)var e=d.Param.x;return f=c?0==e?g+c/(100*Math.PI)*Math.sin(Math.PI*g):e?(100+e*c)*g/(2*e*c*g+100-e*c):g+c/100*(1-g)*g:g,a+(b-a)*f},d.gC=d.getNextRGBA=function(a,b){var c=[],d=a.length,e=b.length;4==d&&3==e&&(b[3]=1);for(var f=0;d>f;f++)c[f]=Math.round(this.gN(a[f],b[f]));return c},d.Functions.s&&d.Functions.s.call(a,d),function(){d.Param.c++!=d.Param.f?(d.Functions.m&&d.Functions.m.call(a,d),d.Timer=setTimeout(arguments.callee,d.Param.t)):(d.Functions.e&&d.Functions.e.call(a,d),d.Functions.c&&d.Functions.c.call(a,d))}()}},sML.transition=function(){return sML.Transition.begin.apply(sML.Transition,arguments)},sML.Coord=sML.C={getXY:function(a,b){return{X:a,x:a,Y:b,y:b}},getWH:function(a,b){return{Width:a,W:a,w:a,Height:b,H:b,h:b}},getXYTRBLCMWH:function(a,b,c,d,e,f,g,h,i,j){return{X:a,x:a,Y:b,y:b,Top:c,top:c,T:c,t:c,Right:d,right:d,R:d,r:d,Bottom:e,bottom:e,B:e,b:e,Left:f,left:f,L:f,l:f,Center:g,center:g,C:g,c:g,Middle:h,middle:h,M:h,m:h,Width:i,width:i,W:i,w:i,Height:j,height:j,H:j,h:j}},getScreenSize:function(){return this.getWH(screen.availWidth,screen.availHeight)},getScrollSize:function(a){return a&&a!=window&&a!=document||(a=document.documentElement),this.getWH(a.scrollWidth,a.scrollHeight)},getOffsetSize:function(a){return a&&a!=window||(a=document.documentElement),a==document?this.getScrollSize(document.documentElement):this.getWH(a.offsetWidth,a.offsetHeight)},getClientSize:function(a){return a&&a!=window||(a=document.documentElement),a==document?this.getScrollSize(document.documentElement):this.getWH(a.clientWidth,a.clientHeight)},getDocumentSize:function(){return this.getScrollSize(document.documentElement)},getWindowSize:function(){return this.getOffsetSize(document.documentElement)},getElementSize:function(a){return this.getOffsetSize(a)},getWindowCoord:function(){return this.getXY(window.screenLeft||window.screenX,window.screenTop||window.screenY)},getElementCoord:function(a,b){var c=a.offsetLeft,d=a.offsetTop;for(b&&(c=c+a.offsetWidth-this.getOffsetSize(document.documentElement).W);a.offsetParent;)a=a.offsetParent,c+=a.offsetLeft,d+=a.offsetTop;return this.getXY(c,d)},getScrollCoord:function(a){return a&&a!=window?this.getXY(a.scrollLeft,a.scrollTop):this.getXY(window.scrollX||window.pageXOffset||document.documentElement.scrollLeft,window.scrollY||window.pageYOffset||document.documentElement.scrollTop)},getScrollLimitCoord:function(a,b){a&&a!=window||(a=document.documentElement);var c=this.getScrollSize(a),d=this.getClientSize(a);return this.getXY((c.W-d.W)*(b?-1:1),c.H-d.H)},getEventCoord:function(a){return a?this.getXY(a.pageX,a.pageY):this.getXY(0,0)},getCoord:function(a,b){if(b)return this.getCoord_RtL(a);if(a==screen)var c=this.getScreenSize(),d={X:0,Y:0},e={X:c.W,Y:c.H};else if(a==window)var c=this.getOffsetSize(document.documentElement),d=this.getScrollCoord(),e={X:d.X+c.W,Y:d.Y+c.H};else if(a==document)var c=this.getScrollSize(document.documentElement),d={X:0,Y:0},e={X:c.W,Y:c.H};else{if(!a.tagName)return{};var c=this.getOffsetSize(a),d=this.getElementCoord(a),e={X:d.X+c.W,Y:d.Y+c.H}}return this.getXYTRBLCMWH(d.X,d.Y,d.Y,e.X,e.Y,d.X,Math.round((d.X+e.X)/2),Math.round((d.Y+e.Y)/2),c.W,c.H)},getCoord_RtL:function(a){if(a==screen)var b=this.getScreenSize(),c={X:b.W,Y:0},d={X:0,Y:b.H};else if(a==window)var b=this.getOffsetSize(document.documentElement),c=this.getScrollCoord(),d={X:c.X-b.W,Y:c.Y+b.H};else if(a==document)var b=this.getScrollSize(document.documentElement),c={X:0,Y:0},d={X:b.W,Y:b.H};else{if(!a.tagName)return{};var b=this.getElementSize(a),c=this.getElementCoord(a,1),d={X:c.X-b.W,Y:c.Y+b.H}}return this.getXYTRBLCMWH(c.X,c.Y,c.Y,c.X,d.Y,d.X,Math.round((d.X+c.X)/2),Math.round((c.Y+d.Y)/2),b.W,b.H)},isInside:function(a,b,c){var d=this.getOffsetSize(document.documentElement);if(c)var e=this.getScrollCoord(),f={T:e.Y,R:e.X,B:e.Y+d.H,L:e.X-d.W};else var g=this.getScrollCoord(),f={T:g.Y,R:g.X+d.W,B:g.Y+d.H,L:g.X};if(a.tagName){var h=this.getElementSize(a);if(c)var i=this.getElementCoord(a,1),j={T:i.Y,R:i.X,B:i.Y+h.H,L:i.X-h.W};else var k=this.getElementCoord(a),j={T:k.Y,R:k.X+h.W,B:k.Y+h.H,L:k.X};j.C=(j.L+j.R)/2,j.M=(j.T+j.B)/2;var l=j.L>=f.L&&j.L<=f.R,m=j.C>=f.L&&j.C<=f.R,n=j.R>=f.L&&j.R<=f.R,o=j.T>=f.T&&j.T<=f.B,p=j.M>=f.T&&j.M<=f.B,q=j.B>=f.T&&j.B<=f.B,r=b?l&&n:l||m||n,s=b?o&&q:o||p||q}else if("object"==typeof a){if("number"==typeof a.X){var r=a.X>=f.L&&a.X<=f.R;if("number"!=typeof a.Y)return r}if("number"==typeof a.Y){var s=a.Y>=f.T&&a.Y<=f.B;if("number"!=typeof a.X)return s}}return r&&s}},sML.getCoord=function(){return sML.Coord.getCoord.apply(sML.Coord,arguments)},sML.Scroller={scrollTo_Legacy:function(a,b,c,d){b||(b={}),c||(c={}),"function"==typeof c&&(c={c:c}),this.SFO={};var e=b.rtl||b.rl||b.vt||b.vertical||/-rl$/.test(b.writingMode?b.writingMode:b["writing-mode"]?b["writing-mode"]:b.wm?b.wm:void 0);sML.Scroller.Timer&&clearTimeout(sML.Scroller.Timer),"number"==typeof a?a={Y:a}:a?a.tagName&&(a=sML.Coord.getElementCoord(a,e)):a={};var f=this.SFO,g=sML.Coord.getScrollCoord(),h=sML.Coord.getScrollLimitCoord(window,e);f.DC={X:"number"==typeof a.x?a.x:g.X,Y:"number"==typeof a.y?a.y:g.Y},e?(f.DC.X<h.X&&(f.DC.X=h.X),f.DC.X>0&&(f.DC.X=0)):(f.DC.X>h.x&&(f.DC.X=h.X),f.DC.X<0&&(f.DC.X=0)),f.DC.Y>h.Y&&(f.DC.Y=h.Y),f.DC.Y<0&&(f.DC.Y=0),f.Param={P:b.p?b.p:.25,T:b.t?b.t:20},f.Functions={start:c.s?c.s:null,middle:c.m?c.m:null,end:c.e?c.e:null,callback:c.c?c.c:null},d&&sML.Scroller.preventUserScrolling(),f.Functions.start&&f.Functions.start(f),function(){f.cC=sML.Coord.getScrollCoord(),f.mV={X:Math.floor((f.DC.X-f.cC.X)*f.Param.P),Y:Math.floor((f.DC.Y-f.cC.Y)*f.Param.P)},Math.abs(f.mV.X)>1||Math.abs(f.mV.Y)>1?(window.scrollBy(f.mV.X,f.mV.Y),f.Functions.middle&&f.Functions.middle(f),sML.Scroller.Timer=setTimeout(arguments.callee,f.Param.T)):(e?window.scrollBy(f.DC.X-f.cC.X,f.DC.Y-f.cC.Y):window.scrollTo(f.DC.X,f.DC.Y),d&&sML.Scroller.allowUserScrolling(),f.Functions.end&&f.Functions.end(f),f.Functions.callback&&f.Functions.callback(f))}(),d||sML.Scroller.addScrollCancelation()},scrollTo:function(a,b,c,d){{var e=sML.Coord.getScrollCoord(a);sML.Coord.getScrollLimitCoord(a)}if("number"==typeof b)b={X:e.X,Y:b};else if("object"!=typeof b||!b)return;"number"!=typeof b.X&&(b.X=e.X),"number"!=typeof b.Y&&(b.Y=e.Y),c||(c={}),("number"!=typeof c.Duration||c.Duration<0)&&(c.Duration=100);var f=sML.Easing.linear;if("function"==typeof c.Easing)var f=c.Easing;else if("string"==typeof c.Easing)var f=sML.Easing[c.Easing]?sML.Easing[c.Easing]:sML.Easing.linear;else if("number"==typeof c.Easing)var f=sML.Easing.getEaser(c.Easing);"function"==typeof d?d={callback:d}:"object"==typeof d&&d||(d={}),sML.Scroller.Timer&&clearTimeout(sML.Scroller.Timer),c.ForceScroll?sML.Scroller.preventUserScrolling():sML.Scroller.addScrollCancelation(),"function"==typeof d.start&&d.start();var g=a==window?window.scrollTo:function(b,c){a.scrollLeft=b,a.scrollTop=c};!function(a,b,c,d){var e=c.Duration?((new Date).getTime()-a.Time)/c.Duration:1;if(1>e){var h=f(e);g(Math.round(a.X+(b.X-a.X)*h),Math.round(a.Y+(b.Y-a.Y)*h)),"function"==typeof d.middle&&d.middle();var i=arguments.callee;sML.Scroller.Timer=setTimeout(function(){i(a,b,c,d)},10)}else g(b.X,b.Y),"function"==typeof d.end&&d.end(),"function"==typeof d.callback&&d.callback(),c.ForceScroll&&sML.Scroller.allowUserScrolling()}({X:e.X,Y:e.Y,Time:(new Date).getTime()},b,c,d)},addScrollCancelation:function(){sML.addEventListener(document,"mousedown",sML.Scroller.cancelScrolling),sML.addEventListener(document,"keydown",sML.Scroller.cancelScrolling),sML.addEventListener(document,"mousewheel",sML.Scroller.cancelScrolling),sML.addEventListener(document,"DOMMouseScroll",sML.Scroller.cancelScrolling)},cancelScrolling:function(){sML.removeEventListener(document,"mousedown",sML.Scroller.cancelScrolling),sML.removeEventListener(document,"keydown",sML.Scroller.cancelScrolling),sML.removeEventListener(document,"mousewheel",sML.Scroller.cancelScrolling),sML.removeEventListener(document,"DOMMouseScroll",sML.Scroller.cancelScrolling)},preventUserScrolling:function(){sML.addEventListener(document,"mousedown",sML.preventDefault),sML.addEventListener(document,"keydown",sML.preventDefault),sML.addEventListener(document,"mousewheel",sML.preventDefault),sML.addEventListener(document,"DOMMouseScroll",sML.preventDefault)},allowUserScrolling:function(){sML.removeEventListener(document,"mousedown",sML.preventDefault),sML.removeEventListener(document,"keydown",sML.preventDefault),sML.removeEventListener(document,"mousewheel",sML.preventDefault),sML.removeEventListener(document,"DOMMouseScroll",sML.preventDefault)}},sML.scrollTo=function(){var a,b,c,d;return arguments[0]==window||arguments[0].tagName?(a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3]):(a=window,b=arguments[0],c=arguments[1],d=arguments[2]),"object"==typeof b&&("number"==typeof b.x||"number"==typeof b.y)||"object"==typeof c&&("number"==typeof c.p||"number"==typeof c.t)?sML.Scroller.scrollTo_Legacy.apply(sML.Scroller,arguments):sML.Scroller.scrollTo.apply(sML.Scroller,[a,b,c,d])},sML.Ajax=sML.A={open:function(a){try{var b=new XMLHttpRequest}catch(c){try{var b=new ActiveXObject("Msxml2.XMLHTTP")}catch(c){try{var b=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){}}}if(!b)return sML.log("sML.ShipBuilder could not find XHR.");if("object"!=typeof a||"string"!=typeof a.URI||"function"!=typeof a.onsuccess)return!1;a.Query||(a.Query=null),a.Auth||(a.Auth=["",""]),a.MimeType||(a.MimeType=null),a.onsuccess||(a.onsuccess=function(){}),a.onfailed||(a.onfailed=function(){sML.each(arguments,function(){sML.log(this+"")})}),a.ontimeout||(a.ontimeout=a.onfailed),a.Async!==!1&&(a.Async=!0),a.Method=a.Method&&/^POST$/i.test(a.Method)?"POST":"GET";var d="";if(a.Query)for(var e in a.Query)d+="&"+e+"="+encodeURIComponent(a.Query[e]);return d&&("GET"==a.method?(a.URI=a.URI+(a.URI.indexOf("?")>0?d:d.replace(/^&/,"?")),d=null):"POST"==a.Method&&(d=d.replace(/^&/,""))),b.sMLAjaxTimeout=0,b.sMLAjaxTimeoutTimer=setTimeout(function(){b.sMLAjaxTimeout=1,a.ontimeout("sML.AJAX.get Timeout: "+a.URI)},1e4),a.onstate4=function(c,d){b.sMLAjaxTimeout||(clearTimeout(b.sMLAjaxTimeoutTimer),200==b.status||0==b.status?a.onsuccess(c,d):a.onfailed("sML.AJAX.get Failed: ("+b.status+") "+URL),delete b)},b.onreadystatechange=function(){switch(this.readyState){case 4:return a.onstate4.call(this,this.responseText,this.responseXML)}},a.MimeType&&b.overrideMimeType(a.MimeType),b.open(a.Method,a.URI,a.Async,a.Auth[0],a.Auth[1]),"POST"==a.Method&&b.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),b.send(d),b}},sML.ajax=function(){var a={};if("object"==typeof arguments[0]){if(a=arguments[0],"string"!=typeof a.URI)return!1}else{if("string"!=typeof arguments[0])return!1;"object"==typeof arguments[1]&&(a=arguments[1]),a.URI=arguments[0]}if("function"!=typeof a.onsuccess){if("function"!=typeof arguments[1])return!1;a.onsuccess=arguments[1],"function"==typeof arguments[2]&&(a.onfailed=arguments[2]),"function"==typeof arguments[3]&&(a.ontimeout=arguments[3])}return sML.Ajax.open(a)},sML.Location=sML.Loc={RE:new RegExp("^((([a-z]+)://([^/\\?#]+))(/[^\\?#]*))(\\?[^\\?#]*)?(#[^#]*)?$"),getFile:function(a){return(a?a:location.href).replace(this.RE,"$1")},getOrigin:function(a){return(a?a:location.href).replace(this.RE,"$2")},getProtocol:function(a){return(a?a:location.href).replace(this.RE,"$3")},getHost:function(a){return(a?a:location.href).replace(this.RE,"$4")},getPathname:function(a){return(a?a:location.href).replace(this.RE,"$5")},getSearch:function(a){return(a?a:location.href).replace(this.RE,"$6")},getHash:function(a){return(a?a:location.href).replace(this.RE,"$7")},getDirectory:function(a){return this.getFile(a).replace(/\/[^\/]*$/,"")},getId:function(a){return this.getHash(a).replace("#","")},getQueries:function(a){var b=(a?a:location.href).split("?");if(2!=b.length)return{};for(var c={},d=b[1].replace(/#.*$/,"").split("&"),e=0,f=d.length;f>e;e++)if(d[e]){var g=d[e].split("=");g.length<2?g[1]=null:g.length>2&&(g[1]=d[e].replace(g[0]+"=","")),c[g[0]]=g[1]}return c},isIndexFile:function(a){return/index\.(x?html?|php|cgi|[ja]spx?)$/.test(this.getPathname(a))},isSameFile:function(a,b){return this.getFile(a)==(b?this.getOrigin(b):location.protocol+"//"+location.host+location.pathname)},isSameOrigin:function(a,b){return this.getOrigin(a)==(b?this.getOrigin(b):location.protocol+"//"+location.host)},isSameProtocol:function(a,b){return this.getProtocol(a)==(b?this.getProtocol(b):location.protocol)},isSameHost:function(a,b){return this.getHost(a)==(b?this.getHost(b):location.host)},isSameHash:function(a,b){return this.getHash(a)==(b?this.getHash(b):location.hash)},isSameDirectory:function(a,b){return this.getDirectory(a)==(b?this.getDirectory(b):(location.protocol+"//"+location.host+location.pathname).replace(/\/[^\/]*$/,""))},isSameId:function(a,b){return this.getId(a)==(b?this.getId(b):location.hash.replace("#",""))}},sML.getQueries=sML.Location.getQueries,sML.Cookies=sML.cookies={put:function(a,b,c){if(!c)var c=1;var d=new Date;return document.cookie=a+"="+b+"; path=/; expires="+d.toGMTString(d.setTime(d.getTime()+864e5*c)),document.cookie},del:function(a){var b=new Date;return document.cookie=a+"=%00; path=/; expires="+b.toGMTString(b.setTime(b.getTime()-864e5)),document.cookie},get:function(a){for(var b=document.cookie.split("; "),c="",d=0,e=b.length;e>d;d++)if(b[d].substr(0,a.length+1)==a+"="){c=b[d].substr(a.length+1,b[d].length);break}return c}},sML.CookieMonster={Cookies:{},set:function(a,b,c){return this.Cookies[a]||(this.Cookies[a]=this.get(a)),null==c?"undefined"!=typeof this.Cookies[a][b]&&delete this.Cookies[a][b]:this.Cookies[a][b]=c,this.Cookies[a]},put:function(a,b){if(!sML.getLength(this.Cookies[a]))return sML.Cookies.del(a),this.del(a);var c="";for(var d in this.Cookies[a])c+='"'+d+'":"'+this.Cookies[a][d]+'",';return c=encodeURIComponent("{"+c.replace(/\,$/,"")+"}"),sML.Cookies.put(a,c,b),this.Cookies},del:function(a){return this.Cookies[a]&&(sML.Cookies.del(a),delete this.Cookies[a]),this.Cookies},get:function(N,K){if(!this.Cookies[N]){var V="";try{V=eval("("+decodeURIComponent(sML.Cookies.get(N))+")")}catch(e){}this.Cookies[N]="object"==typeof V?V:{}}return K?"undefined"==typeof this.Cookies[N][K]?"":this.Cookies[N][K]:this.Cookies[N]}},sML.map=function(a,b){return Array.prototype.map.call(a,b)},sML.filter=function(a,b){return Array.prototype.filter.call(a,b)},sML.forEach=function(a,b){return Array.prototype.forEach.call(a,b)},sML.foreach=function(a,b,c){for(var d=0,e=a.length;e>d&&b.call(c,a[d],d,a)!==!1;d++);return a},sML.each=function(a,b,c,d){for(var e=c?c:0,f=d?d+1:a.length;f>e&&b.call(a[e],e,a)!==!1;e++);return a},sML.toArray=function(){for(var a=[],b=0,c=arguments.length;c>b;b++)if("undefined"==typeof arguments[b].length||"string"==typeof arguments[b])a.push(arguments[b]);else for(var d=0,e=arguments[b].length;e>d;d++)a.push(arguments[b][d]);return a},sML.firstOf=function(a){return a.length?a[0]:null},sML.lastOf=function(a){return a.length?a[a.length-1]:null},sML.Math={sum:function(){for(var a=0,b=0,c=arguments.length;c>b;b++){var d=0;"number"==typeof arguments[b]?d=arguments[b]:"string"==typeof arguments[b]&&(d=arguments[b].length),a+=d}return a},random:function(a,b){isNaN(a)&&isNaN(b)?(a=0,b=1):isNaN(a)?a=0:isNaN(b)&&(b=0);var c=Math.min(a,b),d=Math.max(a,b);return Math.floor(Math.random()*(d-c+1))+c}},sML.String={pad:function(a,b,c){if(a+="",a.length>=b)return a;"string"!=typeof c&&(c="0");for(var d="";d.length<b;)d+=c;return(d+a).slice(-b)},insertZeroWidthSpace:function(a){return a.replace(/(?=\w)/g,"&#x200B;")},replace:function(a,b){if(b.length%2)return this;for(var c=0,d=b.length/2;d>c;c++)a=a.replace(b[2*c],b[2*c+1]);return a}},sML.getLength=function(a){if("object"==typeof a){if(a instanceof Array)return a.length;var b=0;for(var c in a)b++;return b}return"string"==typeof a?a.length:"number"==typeof a?(""+a).length:null},sML.padZero=sML.zeroPadding=sML.String.padZero=sML.String.pad,sML.insertZeroWidthSpace=sML.String.insertZeroWidthSpace,sML.Range={getRange:function(a,b){if(!a)return null;b||(b=a.Start.Node.ownerDocument);var c=b.createRange();return c.setStart(a.Start.Node,"number"==typeof a.Start.Index?a.Start.Index:a.Start.Node.textContent.indexOf(a.Start.Text)),c.setEnd(a.End.Node,"number"==typeof a.End.Index?a.End.Index:a.End.Node.textContent.indexOf(a.End.Text)+a.End.Text.length),c},flat:function(a){return a.replace(/[\r\n]/g,"")},escape:function(a){return this.flat(a).replace(/([\(\)\{\}\[\]\,\.\-\+\*\?\!\:\^\$\/\\])/g,"\\$1")},distill:function(a,b,c){for(var d="",e=b;c>=e;e++)d+=a[e];return d},find:function(a,b){if(b||(b=document.body),"string"!=typeof a||!a||this.flat(b.textContent).indexOf(a)<0)return null;if(3==b.nodeType)return{Start:{Node:b,Text:a},End:{Node:b,Text:a}};for(var c=[],d=0,e=b.childNodes.length-1,f="",g={},h=0;e>=h;h++){if(this.flat(b.childNodes[h].textContent).indexOf(a)>=0)return this.find(a,b.childNodes[h]);c.push(b.childNodes[h].textContent)}for(f=this.distill(c,d+1,e);f&&this.flat(f).indexOf(a)>=0;)d++,f=this.distill(c,d+1,e);var i=b.childNodes[d],j=0,k=i.textContent.length-1,l="";for(f=this.distill(i.textContent,j,k);this.flat(f)&&!new RegExp("^"+this.escape(f)).test(a);)j++,f=this.distill(i.textContent,j,k);for(l=this.flat(f);3!=i.nodeType;)g=this.find(l,i),i=g.Start.Node,l=g.Start.Text;for(f=this.distill(c,d,e-1);f&&this.flat(f).indexOf(a)>=0;)e--,f=this.distill(c,d,e-1);var m=b.childNodes[e],n=0,o=m.textContent.length-1,p="";for(f=this.distill(m.textContent,n,o);this.flat(f)&&!new RegExp(this.escape(f)+"$").test(a);)o--,f=this.distill(m.textContent,n,o);for(p=this.flat(f);3!=m.nodeType;)g=this.find(p,m),m=g.End.Node,p=g.End.Text;return{Start:{Node:i,Text:l},End:{Node:m,Text:p}}}},sML.Selection={selectRange:function(a){if(!a)return null;var b=window.getSelection();return b.removeAllRanges(),b.addRange(a),a},getSelectedText:sML.UA.IE<9?function(){var a=""+document.selection.createRange().text;return a?a:""}:function(){var a=""+window.getSelection();return a?a:""}},sML.getSelection=function(){return sML.Selection.getSelectedText()},sML.select=function(a,b){return sML.Selection.selectRange(sML.Range.getRange(a,b))},sML.find=function(a,b){return sML.Selection.selectRange(sML.Range.getRange(sML.Range.find(a,b)))},sML.Fullscreen={request:function(a){var b=function(b){return function(c){return c||(c=a),c[b]()}};return a.requestFullscreen?b("requestFullscreen"):a.requestFullScreen?b("requestFullScreen"):a.webkitRequestFullscreen?b("webkitRequestFullscreen"):a.webkitRequestFullScreen?b("webkitRequestFullScreen"):a.mozRequestFullscreen?b("mozRequestFullscreen"):a.mozRequestFullScreen?b("mozRequestFullScreen"):a.msRequestFullscreen?b("msRequestFullscreen"):function(){return!1}}(document.documentElement),exit:function(a){var b=function(b){return function(c){return c||(c=a),c[b]()}};return a.exitFullscreen?b("exitFullscreen"):a.cencelFullScreen?b("cencelFullScreen"):a.webkitExitFullscreen?b("webkitExitFullscreen"):a.webkitCancelFullScreen?b("webkitCancelFullScreen"):a.mozExitFullscreen?b("mozExitFullscreen"):a.mozRequestFullScreen?b("mozRequestFullScreen"):a.msExitFullscreen?b("msExitFullscreen"):function(){return!1}}(document),getElement:function(a){var b=function(b){return function(c){return c||(c=a),c[b]}};return"undefined"!=typeof a.fullscreenElement?b("fullscreenElement"):"undefined"!=typeof a.fullScreenElement?b("fullScreenElement"):"undefined"!=typeof a.webkitFullscreenElement?b("webkitFullscreenElement"):"undefined"!=typeof a.webkitFullScreenElement?b("webkitFullScreenElement"):"undefined"!=typeof a.mozFullscreenElement?b("mozFullscreenElement"):"undefined"!=typeof a.mozFullScreenElement?b("mozFullScreenElement"):"undefined"!=typeof a.msFullscreenElement?b("msFullscreenElement"):function(){return null}}(document)},sML.requestFullscreen=sML.Fullscreen.request,sML.exitFullscreen=sML.Fullscreen.exit,sML.getFullscreenElement=sML.Fullscreen.getElement,sML.SML={each:function(a){return sML.each(this,a),this},set:function(a,b){return this.each(function(){var c=this;sML.set(c,a,b)})},style:function(a){return this.each(function(){var b=this;sML.style(b,a)})},appendChild:function(a){return this.each(function(){var b=this;sML.each(a,function(){b.appendChild(this)})})},preppendChild:function(){return this.each(function(){var a=this;sML.each(Es,function(){a.insertBefore(this,S.firstChild)})})},insertBefore:function(a,b){return this.each(function(){var a=this;sML.each(Es,function(){a.insertBefore(this,b)})})},insertAfter:function(a,b){return this.each(function(){var a=this;sML.each(Es,function(){a.insertBefore(this,b.nextSibling)})})},addClass:function(a){return this.each(function(){var b=this;sML.addClass(b,a)})},removeClass:function(a){return this.each(function(){var b=this;sML.removeClass(b,a)})},replaceClass:function(a,b){return this.each(function(){var c=this;sML.replaceClass(c,a,b)})}},window.addEventListener("unload",function(){window.sML=null,delete window.sML}),sML}(),/*!
 *
 * # BiB/i (core)
 *
 * - "EPUB Reader on Your Web Site."
 * - Copyright (c) Satoru MATSUSHIMA - http://bibi.epub.link/ or https://github.com/satorumurmur/bibi
 * - Licensed under the MIT license. - http://www.opensource.org/licenses/mit-license.php
 *
 * - Fri June 26 17:47:00 2015 +0900
 */
Bibi={version:"0.999.0",build:20150626},B={},C={},E={},L={},M={},N={},O={},P={},R={},S={},U={},X={},Bibi.welcome=function(){if(O.log(1,"Welcome to BiB/i v"+Bibi.Version+" - http://bibi.epub.link/"),O.HTML=document.getElementsByTagName("html")[0],O.HTML.className="preparing "+sML.Environments.join(" "),O.Head=document.getElementsByTagName("head")[0],O.Body=document.getElementsByTagName("body")[0],O.Title=document.getElementsByTagName("title")[0],(sML.OS.iOS||sML.OS.Android)&&(O.SmartPhone=!0,O.HTML.className=O.HTML.className+" Touch",O.setOrientation=function(){sML.removeClass(O.HTML,"orientation-"+(0==window.orientation?"landscape":"portrait")),sML.addClass(O.HTML,"orientation-"+(0==window.orientation?"portrait":"landscape"))},window.addEventListener("orientationchange",O.setOrientation),O.setOrientation(),sML.OS.iOS&&(O.Head.appendChild(sML.create("meta",{name:"apple-mobile-web-app-capable",content:"yes"})),O.Head.appendChild(sML.create("meta",{name:"apple-mobile-web-app-status-bar-style",content:"white"})))),parent==window)O.WindowEmbedded=!1,O.HTML.className=O.HTML.className+" window-not-embedded";else{O.WindowEmbedded=1,O.HTML.className=O.HTML.className+" window-embedded";try{location.host==parent.location.host&&(O.HTML.className=O.HTML.className+" window-embedded-sameorigin")}catch(a){O.WindowEmbedded=-1,O.HTML.className=O.HTML.className+" window-embedded-crossorigin"}}(function(){return document.body.requestFullscreen||document.body.requestFullScreen?!0:document.body.webkitRequestFullscreen||document.body.webkitRequestFullScreen?!0:document.body.mozRequestFullscreen||document.body.mozRequestFullScreen?!0:document.body.msRequestFullscreen?!0:!1})()?(O.FullscreenEnabled=!0,O.HTML.className=O.HTML.className+" fullscreen-enabled"):(O.FullscreenEnabled=!1,O.HTML.className=O.HTML.className+" fullscreen-not-enabled");var b=getComputedStyle(O.HTML);O.WritingModeProperty=function(){return/^(vertical|horizontal)-/.test(b["-webkit-writing-mode"])?"-webkit-writing-mode":/^(vertical|horizontal)-/.test(b["writing-mode"])||sML.UA.InternetExplorer>=11?"writing-mode":void 0}();var c=document.body.appendChild(sML.create("div",{id:"checker"}));c.Child=c.appendChild(sML.create("p",{innerHTML:"aA"})),c.Child.offsetWidth<c.Child.offsetHeight?(O.HTML.className=O.HTML.className+" vertical-text-enabled",O.VerticalTextEnabled=!0):(O.HTML.className=O.HTML.className+" vertical-text-not-enabled",O.VerticalTextEnabled=!1),O.DefaultFontSize=Math.min(c.Child.offsetWidth,c.Child.offsetHeight),document.body.removeChild(c),delete c,"function"!=typeof window.CustomEvent&&-1===this.CustomEvent.toString().indexOf("CustomEventConstructor")&&(window.CustomEvent=function(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c},window.CustomEvent.prototype=window.Event.prototype),R.Content=O.Body.insertBefore(sML.create("div",{id:"epub-content"}),C.Veil),R.Content.Main=R.Content.appendChild(sML.create("div",{id:"epub-content-main"})),R.Content.Complementary=R.Content.appendChild(sML.create("div",{id:"epub-content-complementary"})),R.Frame=sML.OS.iOS||sML.OS.Android?R.Content:window,U.initialize(),S.initialize(),S.poster&&(sML.addClass(O.HTML,"with-poster"),O.Body.style.backgroundImage="url("+S.poster+")");var d=[];for(var e in X)X[e]&&"object"==typeof X[e]&&X[e].name&&d.push(X[e].name);d.length&&O.log(2,"Extention"+(d.length>=2?"s":"")+": "+d.join(", ")),C.createVeil(),C.createCartain(),E.add("bibi:command:move",function(a){R.move(a)}),E.add("bibi:command:focus",function(a){R.focus(a)}),E.add("bibi:command:changeView",function(a){R.changeView(a)}),E.add("bibi:command:toggleCartain",function(){C.Cartain.toggle()}),window.addEventListener(O.SmartPhone?"orientationchange":"resize",R.onresize),window.addEventListener("scroll",R.onscroll),E.dispatch("bibi:welcome"),window.addEventListener("message",M.gate,!1),M.post("bibi:welcome"),setTimeout(function(){U.book?(B.initialize({Name:U.book}),S.autostart||!B.Zipped?B.load():(E.dispatch("bibi:wait"),C.Veil.Message.note(""))):O.ZippedEPUBEnabled&&window.File&&!O.SmartPhone?B.dropOrClick():C.Veil.Message.note(O.WindowEmbedded?"Tell me EPUB name via embedding tag.":"Tell me EPUB name via URI.")},sML.OS.iOS||sML.OS.Android?1e3:1)},B.initialize=function(a){if(delete B.name,delete B.Path,delete B.PathDelimiter,delete B.Zipped,delete B.Local,delete B.File,delete B.Files,O.apply({Title:"",Creator:"",Publisher:"",Language:"",WritingMode:"",Container:{Path:"META-INF/container.xml"},Package:{Path:"",Dir:"",Metadata:{titles:[],creators:[],publishers:[],languages:[]},Manifest:{items:{},nav:{},"toc-ncx":{},"cover-image":{}},Spine:{itemrefs:[]}},FileDigit:3},B),"string"==typeof a.Name)B.name=a.Name,B.Path=P.bookshelf+B.name,/\.epub$/i.test(a.Name)&&(B.Zipped=!0);else{if("object"!=typeof a.File||!a.File)return!1;if(!a.File.size||"string"!=typeof a.File.name||!/\.epub$/i.test(a.File.name))return C.Veil.Message.note('Give me <span style="color:rgb(128,128,128);">EPUB</span>.'),!1;B.name=B.Path=a.File.name,B.Zipped=!0,B.Local=!0,B.File=a.File}B.PathDelimiter=B.Zipped?" > ":"/"},B.load=function(){O.startLoading(),R.initialize(),B.Zipped?O.ZippedEPUBEnabled&&B.loadZippedEPUB():(O.log(2,"EPUB: "+B.Path+" (Online Folder)","Show"),B.open())},B.open=function(){E.dispatch("bibi:open"),O.openDocument(B.Container.Path,{then:L.readContainer})},L.readContainer=function(a){O.log(2,"Reading Container XML...","Show"),O.log(3,B.Path+B.PathDelimiter+B.Container.Path),B.Package.Path=a.getElementsByTagName("rootfile")[0].getAttribute("full-path"),B.Package.Dir=B.Package.Path.replace(/\/?[^\/]+$/,""),E.dispatch("bibi:readContainer"),O.log(2,"Container XML Read.","Show"),O.openDocument(B.Package.Path,{then:L.readPackageDocument})},L.readPackageDocument=function(a){O.log(2,"Reading Package Document...","Show"),O.log(3,B.Path+B.PathDelimiter+B.Package.Path);var b=a.getElementsByTagName("metadata")[0],c=a.getElementsByTagName("manifest")[0],d=a.getElementsByTagName("spine")[0],e=c.getElementsByTagName("item"),f=d.getElementsByTagName("itemref");if(e.length<=0)return O.log(0,'"'+B.Package.Path+'" has no <item> in <manifest>.');if(f.length<=0)return O.log(0,'"'+B.Package.Path+'" has no <itemref> in <spine>.');sML.each(b.getElementsByTagName("meta"),function(){if(!this.getAttribute("refines")){if(this.getAttribute("property")){var a=this.getAttribute("property").replace(/^dcterms:/,"");/^(title|creator|publisher|language)$/.test(a)?B.Package.Metadata[a+"s"].push(this.textContent):B.Package.Metadata[a]||(B.Package.Metadata[a]=this.textContent)}this.getAttribute("name")&&this.getAttribute("content")&&(B.Package.Metadata[this.getAttribute("name")]=this.getAttribute("content"))}}),B.Package.Metadata.titles.length||sML.each(a.getElementsByTagName("dc:title"),function(){return B.Package.Metadata.titles.push(this.textContent),!1}),B.Package.Metadata.creators.length||sML.each(a.getElementsByTagName("dc:creator"),function(){B.Package.Metadata.creators.push(this.textContent)}),B.Package.Metadata.publishers.length||sML.each(a.getElementsByTagName("dc:publisher"),function(){B.Package.Metadata.publishers.push(this.textContent)}),B.Package.Metadata.languages.length||sML.each(a.getElementsByTagName("dc:language"),function(){B.Package.Metadata.languages.push(this.textContent)}),B.Package.Metadata.languages.length||(B.Package.Metadata.languages[0]="en"),B.Package.Metadata["rendition:layout"]||(B.Package.Metadata["rendition:layout"]="reflowable"),B.Package.Metadata["rendition:orientation"]||(B.Package.Metadata["rendition:orientation"]="auto"),B.Package.Metadata["rendition:spread"]||(B.Package.Metadata["rendition:spread"]="auto"),B.Package.Metadata.cover||(B.Package.Metadata.cover=""),delete a;var g=d.getAttribute("toc");sML.each(e,function(){var a={id:this.getAttribute("id")||"",href:this.getAttribute("href")||"","media-type":this.getAttribute("media-type")||"",properties:this.getAttribute("properties")||"",fallback:this.getAttribute("fallback")||""};a.id&&a.href&&(B.Package.Manifest.items[a.id]=a,function(b){/ nav /.test(b)&&(B.Package.Manifest.nav.Path=O.getPath(B.Package.Dir,a.href)),/ cover-image /.test(b)&&(B.Package.Manifest["cover-image"].Path=O.getPath(B.Package.Dir,a.href))}(" "+a.properties+" "),g&&a.id==g&&(B.Package.Manifest["toc-ncx"].Path=O.getPath(B.Package.Dir,a.href)))}),B.Package.Spine["page-progression-direction"]=d.getAttribute("page-progression-direction"),B.Package.Spine["page-progression-direction"]&&/^(ltr|rtl)$/.test(B.Package.Spine["page-progression-direction"])||(B.Package.Spine["page-progression-direction"]="default");var h=[/(rendition:layout)-(.+)/,/(rendition:orientation)-(.+)/,/(rendition:spread)-(.+)/,/(rendition:page-spread)-(.+)/,/(page-spread)-(.+)/];sML.each(f,function(){var a={idref:this.getAttribute("idref")||"",linear:this.getAttribute("linear")||"",properties:this.getAttribute("properties")||"","page-spread":"","rendition:layout":B.Package.Metadata["rendition:layout"],"rendition:orientation":B.Package.Metadata["rendition:orientation"],"rendition:spread":B.Package.Metadata["rendition:spread"]};a.properties=a.properties.replace(/^\s+/,"").replace(/\s+$/,"").replace(/\s+/g," ").split(" "),h.forEach(function(b){a.properties.forEach(function(c){return b.test(c)?(a[c.replace(b,"$1")]=c.replace(b,"$2").replace("rendition:",""),!1):void 0})}),a["rendition:page-spread"]&&(a["page-spread"]=a["rendition:page-spread"]),a["rendition:page-spread"]=a["page-spread"],a.viewport={content:null,width:null,height:null},a.viewBox={content:null,width:null,height:null},B.Package.Spine.itemrefs.push(a)}),B.Title=B.Package.Metadata.titles.join(", "),B.Creator=B.Package.Metadata.creators.join(", "),B.Publisher=B.Package.Metadata.publishers.join(", "),B.Language=B.Package.Metadata.languages[0].split("-")[0],B.WritingMode=/^(zho?|chi|kor?|ja|jpn)$/.test(B.Language)?"rtl"==B.Package.Spine["page-progression-direction"]?"tb-rl":"lr-tb":/^(aze?|ara?|ui?g|urd?|kk|kaz|ka?s|ky|kir|kur?|sn?d|ta?t|pu?s|bal|pan?|fas?|per|ber|msa?|may|yid?|heb?|arc|syr|di?v)$/.test(B.Language)?"rl-tb":/^(mo?n)$/.test(B.Language)?"tb-lr":"lr-tb";var i=[];B.Title&&(i.push(B.Title),O.log(3,"title: "+B.Title)),B.Creator&&(i.push(B.Creator),O.log(3,"creator: "+B.Creator)),B.Publisher&&(i.push(B.Publisher),O.log(3,"publisher: "+B.Publisher)),i.length&&(O.Title.innerHTML="",O.Title.appendChild(document.createTextNode("BiB/i | "+i.join(" - ").replace(/&amp;?/gi,"&").replace(/&lt;?/gi,"<").replace(/&gt;?/gi,">")))),S.update(),E.dispatch("bibi:readPackageDocument"),O.log(2,"Package Document Read.","Show"),L.prepareSpine()},L.prepareSpine=function(){if(O.log(2,"Preparing Spine...","Show"),"rtl"==S.PPD)var a="right",b="left";else var a="left",b="right";sML.each(B.Package.Spine.itemrefs,function(c){var d=this,e=sML.create("iframe",{className:"item",scrolling:"no",allowtransparency:"true"});if(e.ItemRef=d,e.Path=O.getPath(B.Package.Dir,B.Package.Manifest.items[d.idref].href),e.Dir=e.Path.replace(/\/?[^\/]+$/,""),"pre-paginated"==d["rendition:layout"]&&c){var f=R.Items[c-1];"pre-paginated"==f.ItemRef["rendition:layout"]&&f.ItemRef["page-spread"]==a&&d["page-spread"]==b&&(e.Pair=f,f.Pair=e)}if(e.Pair)var g=e.Pair.Spread;else{var h=R.Content.Main.appendChild(sML.create("div",{className:"spread-box"})),g=h.appendChild(sML.create("div",{className:"spread"}));"pre-paginated"==d["rendition:layout"]&&sML.addClass(h,"pre-paginated"),g.SpreadBox=h,g.Items=[],g.Pages=[],g.SpreadIndex=R.Spreads.length,g.id="spread-"+sML.String.padZero(g.SpreadIndex,B.FileDigit),R.Spreads.push(g)}var i=g.appendChild(sML.create("div",{className:"item-box"}));d["page-spread"]&&sML.addClass(i,"page-spread-"+d["page-spread"]),e.Spread=g,e.ItemBox=i,e.Pages=[],e.ItemIndexInSpread=g.Items.length,e.ItemIndex=R.Items.length,e.id="item-"+sML.String.padZero(e.ItemIndex,B.FileDigit),g.Items.push(e),R.Items.push(e)}),O.log(3,sML.String.padZero(R.Items.length,B.FileDigit)+" Items"),E.dispatch("bibi:prepareSpine"),O.log(2,"Spine Prepared.","Show"),L.createCover()},L.createCover=function(){O.log(2,"Creating Cover...","Show"),B.Package.Manifest["cover-image"].Path&&(R.CoverImage.Path=B.Package.Manifest["cover-image"].Path),C.Veil.Cover.Info=C.Veil.Cover.appendChild(sML.create("p",{id:"bibi-veil-cover-info",innerHTML:function(){var a=[];return B.Title&&a.push("<strong>"+B.Title+"</strong>"),B.Creator&&a.push("<em>"+B.Creator+"</em>"),B.Publisher&&a.push("<span>"+B.Publisher+"</span>"),a.join(" ")}()})),R.CoverImage.Path?(O.log(3,B.Path+B.PathDelimiter+R.CoverImage.Path),C.Veil.Cover.className=[C.Veil.Cover.className,"with-cover-image"].join(" "),sML.create("img",{onload:function(){sML.style(C.Veil.Cover,{backgroundImage:"url("+this.src+")",opacity:1}),E.dispatch("bibi:createCover",R.CoverImage.Path),O.log(2,"Cover Created.","Show"),L.createNavigation()}}).src=function(){return B.Zipped?B.getDataURI(R.CoverImage.Path):B.Path+"/"+R.CoverImage.Path}()):(O.log(3,"No Cover Image."),C.Veil.Cover.className=[C.Veil.Cover.className,"without-cover-image"].join(" "),E.dispatch("bibi:createCover",""),O.log(2,"Cover Created.","Show"),L.createNavigation())},L.createNavigation=function(a){if(!a){if(O.log(2,"Creating Navigation...","Show"),B.Package.Manifest.nav.Path)C.Cartain.Navigation.Item.Path=B.Package.Manifest.nav.Path,C.Cartain.Navigation.Item.Type="NavigationDocument";else{if(O.log(2,"No Navigation Document."),!B.Package.Manifest["toc-ncx"].Path)return O.log(2,"No TOC-NCX."),E.dispatch("bibi:createNavigation",""),O.log(2,"Navigation Made Nothing.","Show"),L.loadSpreads();C.Cartain.Navigation.Item.Path=B.Package.Manifest["toc-ncx"].Path,C.Cartain.Navigation.Item.Type="TOC-NCX"}return O.log(3,B.Path+B.PathDelimiter+C.Cartain.Navigation.Item.Path),O.openDocument(C.Cartain.Navigation.Item.Path,{then:L.createNavigation})}C.Cartain.Navigation.Item.innerHTML="";var b=document.createDocumentFragment();if("NavigationDocument"==C.Cartain.Navigation.Item.Type)sML.each(a.querySelectorAll("nav"),function(){switch(this.getAttribute("epub:type")){case"toc":sML.addClass(this,"bibi-nav-toc");break;case"landmarks":sML.addClass(this,"bibi-nav-landmarks");break;case"page-list":sML.addClass(this,"bibi-nav-page-list")}sML.each(this.querySelectorAll("*"),function(){this.removeAttribute("style")}),b.appendChild(this)});else{var c=a.getElementsByTagName("navMap")[0];sML.each(c.getElementsByTagName("navPoint"),function(){sML.insertBefore(sML.create("a",{href:this.getElementsByTagName("content")[0].getAttribute("src"),innerHTML:this.getElementsByTagName("text")[0].innerHTML}),this.getElementsByTagName("navLabel")[0]),sML.removeElement(this.getElementsByTagName("navLabel")[0]),sML.removeElement(this.getElementsByTagName("content")[0]);var a=sML.create("li");a.setAttribute("id",this.getAttribute("id")),a.setAttribute("playorder",this.getAttribute("playorder")),sML.insertBefore(a,this).appendChild(this),a.previousSibling&&a.previousSibling.tagName&&!/^a$/i.test(a.previousSibling.tagName)?a.previousSibling.appendChild(a):sML.insertBefore(sML.create("ul"),a).appendChild(a)}),b.appendChild(document.createElement("nav")).innerHTML=c.innerHTML.replace(/<(bibi_)?navPoint( [^>]+)?>/gi,"").replace(/<\/(bibi_)?navPoint>/gi,"")}C.Cartain.Navigation.Item.appendChild(b),C.Cartain.Navigation.Item.Body=C.Cartain.Navigation.Item,delete b,delete a,L.postprocessItem.coordinateLinkages(C.Cartain.Navigation.Item,"InNav"),R.resetNavigation(),E.dispatch("bibi:createNavigation",C.Cartain.Navigation.Item.Path),O.log(2,"Navigation Created.","Show"),S.autostart||B.Local||B.Zipped?L.loadSpreads():(O.stopLoading(),E.dispatch("bibi:wait"),C.Veil.Message.note(""))},L.play=function(){O.startLoading(),B.name?L.loadSpreads():B.load({Name:U.book}),E.dispatch("bibi:play")},L.loadSpreads=function(){O.log(2,"Loading "+R.Items.length+" Items in "+R.Spreads.length+" Spreads...","Show"),O.Body.style.backgroundImage="none",sML.removeClass(O.HTML,"with-poster"),R.resetStage(),R.LoadedItems=0,R.LoadedSpreads=0,R.ToRelayout=!1,L.listenResizingWhileLoading=function(){R.ToRelayout=!0},window.addEventListener("resize",L.listenResizingWhileLoading),E.remove("bibi:postprocessItem",L.onloadItem),E.add("bibi:postprocessItem",L.onloadItem),R.Spreads.forEach(function(a){a.Loaded=!1,a.LoadedItems=0,a.Items.forEach(function(a){a.Loaded=!1,O.log(3,"Item: "+sML.String.padZero(a.ItemIndex+1,B.FileDigit)+"/"+sML.String.padZero(B.Package.Spine.itemrefs.length,B.FileDigit)+" - "+(a.Path?B.Path+B.PathDelimiter+a.Path:"... Not Found.")),L.loadItem(a)})})},L.onloadItem=function(a){a.Loaded=!0,R.LoadedItems++,E.dispatch("bibi:loadItem",a);var b=a.Spread;b.LoadedItems++,b.LoadedItems==b.Items.length&&(R.LoadedSpreads++,E.dispatch("bibi:loadSpread",b),R.ToRelayout||R.resetSpread(b),R.LoadedSpreads==R.Spreads.length&&(delete B.Files,document.body.style.display="",R.resetPages(),E.dispatch("bibi:loadSpreads"),O.log(2,"Spreads Loaded.","Show"),L.start(),E.remove("bibi:postprocessItem",L.onloadItem))),O.updateStatus("Loading... ("+R.LoadedItems+"/"+R.Items.length+" Items Loaded.)")},L.loadItem=function(a){var b=a.Path;if(/\.(x?html?)$/i.test(b))B.Zipped?(L.writeItemHTML(a,B.Files[b]),setTimeout(L.postprocessItem,10,a)):(a.src=B.Path+"/"+b,a.onload=function(){setTimeout(L.postprocessItem,10,a)},a.ItemBox.appendChild(a));else if(/\.(svg)$/i.test(b))if(a.IsSVG=!0,B.Zipped)L.writeItemHTML(a,!1,"",B.Files[b].replace(/<\?xml-stylesheet (.+?)[ \t]?\?>/g,'<link rel="stylesheet" $1 />'));else{var c=B.Path+"/"+b;O.download(c).then(function(b){L.writeItemHTML(a,!1,'<base href="'+c+'" />',b.responseText.replace(/<\?xml-stylesheet (.+?)[ \t]?\?>/g,'<link rel="stylesheet" $1 />'))})}else/\.(gif|jpe?g|png)$/i.test(b)?(a.IsBitmap=!0,L.writeItemHTML(a,!1,"",'<img alt="" src="'+(B.Zipped?B.getDataURI(b):B.Path+"/"+b)+'" />')):/\.(pdf)$/i.test(b)&&(a.IsPDF=!0,L.writeItemHTML(a,!1,"",'<iframe     src="'+(B.Zipped?B.getDataURI(b):B.Path+"/"+b)+'" />'))},L.writeItemHTML=function(a,b,c,d){a.ItemBox.appendChild(a),a.contentDocument.open(),a.contentDocument.write(b?b:["<html>","<head>"+c+"</head>",'<body onload="parent.L.postprocessItem(parent.R.Items['+a.ItemIndex+"]); document.body.removeAttribute('onload'); return false;\">"+d+"</body>","</html>"].join("")),a.contentDocument.close()},L.postprocessItem=function(a){a.HTML=sML.edit(a.contentDocument.getElementsByTagName("html")[0],{Item:a}),a.Head=sML.edit(a.contentDocument.getElementsByTagName("head")[0],{Item:a}),a.Body=sML.edit(a.contentDocument.getElementsByTagName("body")[0],{Item:a}),sML.each(a.Body.querySelectorAll("link"),function(){a.Head.appendChild(this)}),S["epub-additional-stylesheet"]&&a.Head.appendChild(sML.create("link",{rel:"stylesheet",href:S["epub-additional-stylesheet"]})),S["epub-additional-script"]&&a.Head.appendChild(sML.create("script",{src:S["epub-additional-script"]})),a.StyleSheets=[],sML.CSS.add({html:"-webkit-text-size-adjust: 100%;"},a.contentDocument),sML.each(a.HTML.querySelectorAll("link, style"),function(){if(/^link$/i.test(this.tagName)){if(!/^(alternate )?stylesheet$/.test(this.rel))return;if((sML.UA.Safari||sML.OS.iOS)&&"alternate stylesheet"==this.rel)return}a.StyleSheets.push(this)}),1==a.contentDocument.querySelectorAll("body>*").length&&(/^svg$/i.test(a.Body.firstElementChild.tagName)?a.IsSingleSVGOnlyItem=!0:/^img$/i.test(a.Body.firstElementChild.tagName)&&(a.IsSingleIMGOnlyItem=!0),O.getElementInnerText(a.Body)||(a.Outsourcing=!0,a.Body.querySelectorAll("img, svg, video, audio").length-a.Body.querySelectorAll("svg img, video img, audio img").length==1?a.IsImageItem=!0:1==a.Body.getElementsByTagName("iframe").length?a.IsFrameItem=!0:a.IsOutSourcing=!1)),L.postprocessItem.processImages(a),L.postprocessItem.defineViewport(a),L.postprocessItem.coordinateLinkages(a),a.PrePaginated="pre-paginated"==a.ItemRef["rendition:layout"]&&a.ItemRef.viewport.width&&a.ItemRef.viewport.height,setTimeout(function(){return a.contentDocument.styleSheets.length<a.StyleSheets.length?setTimeout(arguments.callee,100):(L.postprocessItem.patchWritingModeStyle(a),L.postprocessItem.forRubys(a),L.postprocessItem.applyBackgroundStyle(a),void E.dispatch("bibi:postprocessItem",a))},100)},L.postprocessItem.processImages=function(a){sML.each(a.Body.getElementsByTagName("img"),function(){this.Bibi={DefaultStyle:{margin:this.style.margin?this.style.margin:"",width:this.style.width?this.style.width:"",height:this.style.height?this.style.height:"","vertical-align":this.style.verticalAlign?this.style.verticalAlign:"","page-break-before":this.style.pageBreakBefore?this.style.pageBreakBefore:"","page-break-after":this.style.pageBreakAfter?this.style.pageBreakAfter:""}}}),sML.UA.InternetExplorer&&sML.each(a.Body.getElementsByTagName("svg"),function(){var a=this.getElementsByTagName("image");if(1==a.length){var b=a[0];b.getAttribute("width")&&b.getAttribute("height")&&(this.setAttribute("width",b.getAttribute("width")),this.setAttribute("height",b.getAttribute("height")))}})},L.postprocessItem.defineViewport=function(a){var b=a.ItemRef;if(sML.each(a.Head.getElementsByTagName("meta"),function(){if("viewport"==this.name&&(b.viewport.content=this.getAttribute("content"),b.viewport.content)){var a=1*b.viewport.content.replace(/^.*?width=([^\, ]+).*$/,"$1"),c=1*b.viewport.content.replace(/^.*?height=([^\, ]+).*$/,"$1");isNaN(a)||isNaN(c)||(b.viewport.width=a,b.viewport.height=c)}}),"pre-paginated"==b["rendition:layout"]&&!(b.viewport.width*b.viewport.height)){var c=a.Body.firstElementChild;if(a.IsSingleSVGOnlyItem){if(c.getAttribute("viewBox")){b.viewBox.content=c.getAttribute("viewBox");var d=b.viewBox.content.split(" ");if(4==d.length){var e=1*d[2]-1*d[0],f=1*d[3]-1*d[1];e&&f&&("100%"!=c.getAttribute("width")&&c.setAttribute("width","100%"),"100%"!=c.getAttribute("height")&&c.setAttribute("height","100%"),b.viewport.width=b.viewBox.width=e,b.viewport.height=b.viewBox.height=f)}}}else a.IsSingleIMGOnlyItem&&(b.viewport.width=parseInt(getComputedStyle(c).width),b.viewport.height=parseInt(getComputedStyle(c).height))}},L.postprocessItem.coordinateLinkages=function(a,b){var c=a.Path,d=a.Body;sML.each(d.getElementsByTagName("a"),function(a){var d=this;d.NavANumber=a+1;var e=d.getAttribute("href");if(!e)return void(b&&(d.addEventListener("click",function(a){return a.preventDefault(),a.stopPropagation(),!1}),sML.addClass(d,"bibi-navigation-inactive-link")));if(/^[a-zA-Z]+:/.test(e))return d.setAttribute("target","_blank");var f=O.getPath(c.replace(/\/?([^\/]+)$/,""),(/^\.*\/+/.test(e)?"":"./")+(/^#/.test(e)?c.replace(/^.+?([^\/]+)$/,"$1"):"")+e),g=f.split("#"),h=g[0]?g[0]:c,i=g[1]?g[1]:"";R.Items.forEach(function(a){return h==a.Path?(d.setAttribute("data-bibi-original-href",e),d.setAttribute("href","bibi://"+B.Path.replace(/^\w+:\/\//,"")+"/"+e),d.InNav=b,d.Target={Item:a,ElementSelector:i?"#"+i:void 0},void d.addEventListener("click",L.postprocessItem.coordinateLinkages.jump)):void 0}),i&&/^epubcfi\(.+\)$/.test(i)&&(d.setAttribute("data-bibi-original-href",e),d.setAttribute("href","bibi://"+B.Path.replace(/^\w+:\/\//,"")+"/#"+i),d.InNav=b,d.Target=U.getEPUBCFITarget(i),d.addEventListener("click",L.postprocessItem.coordinateLinkages.jump)),b&&typeof S.nav==a+1&&d.Target&&(S.to=d.Target)})},L.postprocessItem.coordinateLinkages.jump=function(a){if(a.preventDefault(),a.stopPropagation(),this.Target){var b=this,c=R.Started?function(){R.focus(b.Target)}:function(){if(O.SmartPhone){var a=location.href;return"number"==typeof b.NavANumber&&(a+=(/#/.test(a)?",":"#")+"pipi(nav:"+b.NavANumber+")"),window.open(a)}S.to=b.Target,L.play()};b.InNav?C.Cartain.toggle(c):c()}return!1},L.postprocessItem.patchWritingModeStyle=function(a){(sML.UA.Gecko||sML.UA.InternetExplorer<12)&&sML.each(a.contentDocument.styleSheets,function(){for(var a=this,b=a.cssRules.length,c=0;b>c;c++){var d=this.cssRules[c];d.cssRules?arguments.callee.call(d):d.styleSheet?arguments.callee.call(d.styleSheet):O.translateWritingMode(d)}}),sML.style(a.HTML,{"writing-mode":getComputedStyle(a.Body)[O.WritingModeProperty]}),a.HTML.WritingMode=O.getWritingMode(a.HTML),sML.addClass(a.HTML,"writing-mode-"+a.HTML.WritingMode);var b=getComputedStyle(a.Body);/-rl$/.test(a.HTML.WritingMode)&&(b.marginLeft!=b.marginRight?a.Body.style.marginLeft=b.marginRight:/-lr$/.test(a.HTML.WritingMode)&&(b.marginRight!=b.marginLeft?a.Body.style.marginRight=b.marginLeft:b.marginBottom!=b.marginTop&&(a.Body.style.marginBottom=b.marginTop)))},L.postprocessItem.forRubys=function(a){a.RubyParents=[],sML.each(a.Body.querySelectorAll("ruby"),function(){var b=this.parentNode;a.RubyParents[a.RubyParents.length-1]!=b&&(a.RubyParents.push(b),b.WritingMode=O.getWritingMode(b),b.LiningLength=/^tb/.test(b.WritingMode)?"Width":"Height",b.LiningBefore=/tb$/.test(b.WritingMode)?"Top":/rl$/.test(b.WritingMode)?"Right":"Left",b.DefaultFontSize=parseFloat(getComputedStyle(b).fontSize),b.OriginalCSSText=b.style.cssText)})},L.postprocessItem.applyBackgroundStyle=function(a){a.HTML.style&&(a.ItemBox.style.background=a.contentDocument.defaultView.getComputedStyle(a.HTML).background,a.HTML.style.background=""),a.Body.style&&(a.style.background=a.contentDocument.defaultView.getComputedStyle(a.Body).background,a.Body.style.background="")},L.start=function(){O.stopLoading(),R.layout({Target:S.to?S.to:"head"}),window.removeEventListener("resize",L.listenResizingWhileLoading),delete L.listenResizingWhileLoading,sML.style(R.Content.Main,{transition:"opacity 0.5s ease-in-out",opacity:1}),setTimeout(function(){C.Veil.close(function(){sML.removeClass(O.HTML,"preparing"),setTimeout(function(){document.body.click()},500)}),R.Started=!0,E.dispatch("bibi:start"),M.post("bibi:start"),O.log(1,"Enjoy Readings!")},1)},R.initialize=function(){R.Content.Main.style.opacity=0,R.Content.Main.innerHTML=R.Content.Complementary.innerHTML="",R.Spreads=[],R.Items=[],R.Pages=[],R.CoverImage={Path:""}},R.resetStage=function(){R.StageSize={},R.StageSize.Width=O.HTML.clientWidth,R.StageSize.Height=O.HTML.clientHeight,R.StageSize.Breadth=R.StageSize[S.SIZE.B]-S["spread-margin-start"]-S["spread-margin-end"],R.StageSize.Length=R.StageSize[S.SIZE.L]-2*S["spread-gap"],R.Content.Main.style.padding=R.Content.Main.style.width=R.Content.Main.style.height="",R.Content.Main.style["padding"+S.BASE.S]=R.Content.Main.style["padding"+S.BASE.E]=S["spread-margin-start"]+"px",R.Content.Main.style.background=S["book-background"],R.Columned=!1},R.DefaultPageRatio={X:103,Y:148},R.resetItem=function(a){a.Reset=!1,a.Pages=[],a.scrolling="no",a.HalfPaged=!1,a.HTML.style[S.SIZE.b]="",a.HTML.style[S.SIZE.l]="",sML.style(a.HTML,{"transform-origin":"",transformOrigin:"",transform:"","column-width":"","column-gap":"","column-rule":""}),a.Columned=!1,a.ColumnBreadth=0,a.ColumnLength=0,a.ColumnGap=0,a.PrePaginated?R.resetItem.asPrePagenatedItem(a):a.Outsourcing?R.resetItem.asReflowableOutsourcingItem(a):R.resetItem.asReflowableItem(a),a.Reset=!0},R.resetItem.asReflowableItem=function(a){var b=(a.ItemIndex,a.ItemRef,a.ItemBox),c=a.Spread,d=S["item-padding-"+S.BASE.a]+S["spread-gap"]+S["item-padding-"+S.BASE.b],e=R.StageSize.Breadth-(S["item-padding-"+S.BASE.s]+S["item-padding-"+S.BASE.e]),f=R.StageSize.Length-(S["item-padding-"+S.BASE.b]+S["item-padding-"+S.BASE.a]),g=e,h=f,i=Math.floor((f-d)/2),j=Math.floor(g*R.DefaultPageRatio[S.AXIS.L]/R.DefaultPageRatio[S.AXIS.B]);if(i>j&&(a.HalfPaged=!0,h=i),a.style["padding-"+S.BASE.b]=S["item-padding-"+S.BASE.b]+"px",a.style["padding-"+S.BASE.a]=S["item-padding-"+S.BASE.a]+"px",a.style["padding-"+S.BASE.s]=S["item-padding-"+S.BASE.s]+"px",a.style["padding-"+S.BASE.e]=S["item-padding-"+S.BASE.e]+"px",a.style[S.SIZE.b]=g+"px",a.style[S.SIZE.l]=h+"px",sML.UA.Safari||sML.UA.Chrome){var k=[];a.RubyParents.forEach(function(a){a.style.cssText=a.OriginalCSSText,k.push(a["offset"+a.LiningLength])});var l=sML.CSS.addRule("rt","display: none !important;",a.contentDocument);a.RubyParents.forEach(function(a,b){var c=k[b]-a["offset"+a.LiningLength];if(c>0&&c<a.DefaultFontSize){var d=getComputedStyle(a);a.style["margin"+a.LiningBefore]=parseFloat(d["margin"+a.LiningBefore])-c+"px"}}),sML.CSS.removeRule(l,a.contentDocument)}var m=sML.CSS.addRule("*","word-wrap: break-word;",a.contentDocument);if(sML.each(a.Body.getElementsByTagName("img"),function(){this.style.display=this.Bibi.DefaultStyle.display,this.style.verticalAlign=this.Bibi.DefaultStyle["vertical-align"],this.style.width=this.Bibi.DefaultStyle.width,this.style.height=this.Bibi.DefaultStyle.height;var b=Math.floor(Math.min(parseInt(getComputedStyle(a.Body)[S.SIZE.b]),g)),c=Math.floor(Math.min(parseInt(getComputedStyle(a.Body)[S.SIZE.l]),h));(parseInt(getComputedStyle(this)[S.SIZE.b])>=b||parseInt(getComputedStyle(this)[S.SIZE.l])>=c)&&("inline"==getComputedStyle(this).display&&(this.style.display="inline-block"),this.style.verticalAlign="top",parseInt(getComputedStyle(this)[S.SIZE.b])>=b&&(this.style[S.SIZE.b]=b+"px",this.style[S.SIZE.l]="auto"),parseInt(getComputedStyle(this)[S.SIZE.l])>=c&&(this.style[S.SIZE.l]=c+"px",this.style[S.SIZE.b]="auto"))}),("paged"==S.RVM||a.Body["scroll"+S.SIZE.B]>g)&&(R.Columned=a.Columned=!0,a.ColumnBreadth=g,a.ColumnLength=h,a.ColumnGap=d,a.HTML.style[S.SIZE.b]=g+"px",a.HTML.style[S.SIZE.l]=h+"px",sML.style(a.HTML,{"column-width":a.ColumnLength+"px","column-gap":a.ColumnGap+"px","column-rule":""})),S["page-breaking"]){var n;n=a.Body["offset"+S.SIZE.B]<=g?["vertical"==S.SLA?"Top":"Left",window["inner"+S.SIZE.L],S.SIZE.L,S.SIZE.l,S.BASE.a]:["vertical"==S.SLA?"Left":"Top",g,S.SIZE.B,S.SIZE.b,S.BASE.e],sML.each(a.contentDocument.querySelectorAll("html>body *"),function(){var a=getComputedStyle(this);if("always"==a.pageBreakBefore||"always"==a.pageBreakAfter){this.BibiPageBreakerBefore&&(this.BibiPageBreakerBefore.style[n[3]]=""),this.BibiPageBreakerAfter&&(this.BibiPageBreakerAfter.style[n[3]]="");for(var b=this,c=b["offset"+n[0]],d=0;b.offsetParent;)b=b.offsetParent,c+=b["offset"+n[0]];"rtl"==S.SLD&&(c=window.innerWidth+-1*c-this["offset"+n[2]]),"always"==a.pageBreakBefore&&(this.BibiPageBreakerBefore||(this.BibiPageBreakerBefore=sML.insertBefore(sML.create("span",{className:"bibi-page-breaker-before"},{display:"block"}),this)),d=n[1]-c%n[1],d==n[1]&&(d=0),this.BibiPageBreakerBefore.style[n[3]]=d+"px"),"always"==a.pageBreakAfter&&(c+=d+this["offset"+n[2]],this.style["margin-"+n[4]]=0,this.BibiPageBreakerAfter||(this.BibiPageBreakerAfter=sML.insertAfter(sML.create("span",{className:"bibi-page-breaker-after"},{display:"block"}),this)),d=n[1]-c%n[1],d==n[1]&&(d=0),this.BibiPageBreakerAfter.style[n[3]]=d+"px")}})}sML.CSS.removeRule(m,a.contentDocument);var o=sML.UA.InternetExplorer>=10?a.Body["client"+S.SIZE.L]:a.HTML["scroll"+S.SIZE.L],p=Math.ceil((o+d)/(h+d));o=(h+d)*p-d,a.style[S.SIZE.l]=o+"px",b.style[S.SIZE.b]=g+(S["item-padding-"+S.BASE.s]+S["item-padding-"+S.BASE.e])+"px",b.style[S.SIZE.l]=o+(S["item-padding-"+S.BASE.b]+S["item-padding-"+S.BASE.a])+("paged"==S.RVM&&a.HalfPaged&&p%2?d+h:0)+"px";for(var q=0;p>q;q++){var r=b.appendChild(sML.create("span",{className:"page"}));r.style["padding"+S.BASE.B]=S["item-padding-"+S.BASE.b]+"px",r.style["padding"+S.BASE.A]=S["item-padding-"+S.BASE.a]+"px",r.style["padding"+S.BASE.S]=S["item-padding-"+S.BASE.s]+"px",r.style["padding"+S.BASE.E]=S["item-padding-"+S.BASE.e]+"px",r.style[S.SIZE.b]=g+"px",r.style[S.SIZE.l]=h+"px",r.style[S.BASE.b]=(h+d)*q+"px",r.Item=a,r.Spread=c,r.PageIndexInItem=a.Pages.length,a.Pages.push(r)}return a},R.resetItem.asReflowableOutsourcingItem=function(a){var b=(a.ItemIndex,a.ItemRef,a.ItemBox),c=a.Spread;a.style.padding=0;var d=R.StageSize.Breadth,e=R.StageSize.Length,f=d,g=e;if("paged"!=S.RVM){var h=Math.floor((e-S["spread-gap"])/2),i=Math.floor(f*R.DefaultPageRatio[S.AXIS.L]/R.DefaultPageRatio[S.AXIS.B]);h>i&&(a.HalfPaged=!0,g=h)}if(a.style[S.SIZE.b]=b.style[S.SIZE.b]=f+"px",a.style[S.SIZE.l]=b.style[S.SIZE.l]=g+"px",a.IsImageItem)if(a.Body["scroll"+S.SIZE.B]>f||a.Body["scroll"+S.SIZE.L]>g){var j;"ttb"==S.SLD||"horizontal"==S.SLA&&a.Body["scroll"+S.SIZE.B]>f?j="50% 0":"ltr"==S.SLD?j="0 0":"rtl"==S.SLD&&(j="100% 0");

var k=Math.floor(100*Math.min(f/a.Body["scroll"+S.SIZE.B],g/a.Body["scroll"+S.SIZE.L]))/100;sML.style(a.HTML,{"transform-origin":j,transform:"scale("+k+")"})}else{var l=getComputedStyle(a.Body);a.style.width=a.Body.offsetWidth+parseFloat(l.marginLeft)+parseFloat(l.marginRight)+"px"}else if(a.IsFrameItem){var m=a.Body.getElementsByTagName("iframe")[0];m.style[S.SIZE.b]=m.style[S.SIZE.l]="100%"}var n=b.appendChild(sML.create("span",{className:"page"}));return n.style[S.SIZE.b]=f+"px",n.style[S.SIZE.l]=g+"px",n.style[S.BASE.b]=0,n.Item=a,n.Spread=c,n.PageIndexInItem=a.Pages.length,a.Pages.push(n),a},R.resetItem.asPrePagenatedItem=function(a){var b=(a.ItemIndex,a.ItemRef),c=a.ItemBox,d=a.Spread;a.HTML.style.margin=a.HTML.style.padding=a.Body.style.margin=a.Body.style.padding=0;var e=R.StageSize.Breadth,f=R.StageSize.Length,g=e,h=f;if(a.style.padding=0,a.Scale){var i=a.Scale;delete a.Scale}else{var j={width:b.viewport.width,height:b.viewport.height};a.Pair?j.width+=a.Pair.ItemRef.viewport.width:("right"==b["page-spread"]||"left"==b["page-spread"])&&(j.width+=j.width);var i=Math.min(g/j[S.SIZE.b],h/j[S.SIZE.l]);a.Pair&&(a.Pair.Scale=i)}h=Math.floor(b.viewport[S.SIZE.l]*i),g=Math.floor(b.viewport[S.SIZE.b]*(h/b.viewport[S.SIZE.l])),c.style[S.SIZE.l]=a.style[S.SIZE.l]=h+"px",c.style[S.SIZE.b]=a.style[S.SIZE.b]=g+"px",sML.style(a.HTML,{width:b.viewport.width+"px",height:b.viewport.height+"px","transform-origin":"0 0",transformOrigin:"0 0",transform:"scale("+i+")"});var k=c.appendChild(sML.create("span",{className:"page"}));return"right"==b["page-spread"]?k.style.right=0:k.style.left=0,k.style[S.SIZE.b]=g+"px",k.style[S.SIZE.l]=h+"px",1!=d.Items.length||"left"!=b["page-spread"]&&"right"!=b["page-spread"]||(k.style.width=2*parseFloat(k.style.width)+"px"),k.Item=a,k.Spread=d,k.PageIndexInItem=a.Pages.length,a.Pages.push(k),a},R.resetSpread=function(a){a.Items.forEach(function(a){R.resetItem(a)});var b=a.SpreadBox;b.style["margin"+S.BASE.B]=b.style["margin"+S.BASE.A]="",b.style["margin"+S.BASE.E]=b.style["margin"+S.BASE.S]="auto",b.style.padding="","reflowable"==S["book-rendition-layout"]?(b.style.width=a.Items[0].ItemBox.style.width,b.style.height=a.Items[0].ItemBox.style.height):2==a.Items.length?(b.style.width=Math.ceil(a.Items[0].ItemBox.offsetWidth+a.Items[1].ItemBox.offsetWidth)+"px",b.style.height=Math.ceil(Math.max(a.Items[0].ItemBox.offsetHeight,a.Items[1].ItemBox.style.offsetHeight))+"px"):(b.style.width=Math.ceil(parseFloat(a.Items[0].ItemBox.style.width)*("left"==a.Items[0].ItemRef["page-spread"]||"right"==a.Items[0].ItemRef["page-spread"]?2:1))+"px",b.style.height=a.Items[0].ItemBox.style.height),a.style["border-radius"]=S["spread-border-radius"],a.style["box-shadow"]=S["spread-box-shadow"]},R.resetPages=function(){return R.Pages.forEach(function(a){a.parentNode.removeChild(a),delete a}),R.Pages=[],R.Spreads.forEach(function(a){a.Pages=[],a.Items.forEach(function(b){b.Pages.forEach(function(b){b.PageIndexInSpread=a.Pages.length,a.Pages.push(b),b.PageIndex=R.Pages.length,R.Pages.push(b),b.id="page-"+sML.String.padZero(b.PageIndex,B.FileDigit)})})}),R.Pages},R.resetNavigation=function(){if(sML.style(C.Cartain.Navigation.Item,{"float":""}),"rtl"==S.PPD){{C.Cartain.Navigation.Item.scrollWidth-window.innerWidth}C.Cartain.Navigation.Item.scrollWidth<window.innerWidth&&sML.style(C.Cartain.Navigation.Item,{"float":"right"}),C.Cartain.Navigation.ItemBox.scrollLeft=C.Cartain.Navigation.ItemBox.scrollWidth-window.innerWidth}},R.layoutSpread=function(a){var b=a.SpreadBox;b.style.padding="";var c=0,d=0;"horizontal"==S.SLA&&b.offsetHeight<R.StageSize.Breadth&&(SpreadBoxPaddingTop=Math.floor((R.StageSize.Breadth-b.offsetHeight)/2),SpreadBoxPaddingBottom=R.StageSize.Breadth-(SpreadBoxPaddingTop+b.offsetHeight),b.style.paddingTop=SpreadBoxPaddingTop+"px",b.style.paddingBottom=SpreadBoxPaddingBottom+"px"),c=0==a.SpreadIndex?Math.floor((window["inner"+S.SIZE.L]-b["offset"+S.SIZE.L])/2):"reflowable"==S.BRL?S["spread-gap"]:Math.floor(R.StageSize.Length/4),c<S["spread-gap"]&&(c=S["spread-gap"]),a.SpreadIndex==R.Spreads.length-1&&(d+=Math.ceil((R.StageSize.Length-b["offset"+S.SIZE.L])/2),d<S["spread-gap"]&&(d=S["spread-gap"])),c&&(b.style["padding"+S.BASE.B]=c+"px"),d&&(b.style["padding"+S.BASE.A]=d+"px");var e=0;R.Spreads.forEach(function(a){e+=a.SpreadBox["offset"+S.SIZE.L]}),R.Content.Main.style[S.SIZE.b]="",R.Content.Main.style[S.SIZE.l]=e+"px"},R.layout=function(a){if(R.Layouted&&R.ToRelayout||O.log(2,"Laying Out..."),R.Layouted=!0,window.removeEventListener("scroll",R.onscroll),window.removeEventListener(O.SmartPhone?"orientationchange":"resize",R.onresize),a||(a={}),!a.Target){var b=R.getCurrentPages().StartPage;a.Target={ItemIndex:b.Item.ItemIndex,PageProgressInItem:b.PageIndexInItem/b.Item.Pages.length}}a.Setting&&S.update(a.Setting),a.Reset||R.ToRelayout?(R.ToRelayout=!1,R.resetStage(),R.Spreads.forEach(function(a,b){O.updateStatus("Rendering... ( "+(b+1)+"/"+R.Spreads.length+" Spreads )"),R.resetSpread(a),R.layoutSpread(a)}),R.resetPages(),R.resetNavigation()):R.Spreads.forEach(function(a){R.layoutSpread(a)}),R.Columned=!1;for(var c=0,d=R.Items.length;d>c;c++){var e=R.Items[c].HTML.style;if(e["-webkit-column-width"]||e["-moz-column-width"]||e["-ms-column-width"]||e["column-width"]){R.Columned=!0;break}}return R.focus(a.Target,{Duration:0,Easing:0}),O.log(3,"rendition:layout: "+S.BRL),O.log(3,"page-progression-direction: "+S.PPD),O.log(3,"reader-view-mode: "+S.RVM),"function"==typeof doAfter&&doAfter(),window.addEventListener(O.SmartPhone?"orientationchange":"resize",R.onresize),window.addEventListener("scroll",R.onscroll),E.dispatch("bibi:layout"),O.log(2,"Laid Out."),S},R.Relayouting=0,R.relayout=function(a){if(!R.Relayouting){R.Relayouting++;var b=R.getCurrentPages(),c=b.StartPage?{ItemIndex:b.StartPage.Item.ItemIndex,PageProgressInItem:b.StartPage.PageIndexInItem/b.StartPage.Item.Pages.length}:{ItemIndex:0,PageProgressInItem:0};setTimeout(function(){sML.style(R.Content.Main,{transition:"opacity 0.4s ease",opacity:0}),window.removeEventListener("scroll",R.onscroll),window.removeEventListener(O.SmartPhone?"orientationchange":"resize",R.onresize),sML.addClass(O.HTML,"preparing"),setTimeout(function(){R.layout({Target:c,Reset:!0,Setting:a&&a.Setting?a.Setting:void 0}),R.Relayouting--,R.Relayouting||setTimeout(function(){sML.removeClass(O.HTML,"preparing"),window.addEventListener(O.SmartPhone?"orientationchange":"resize",R.onresize),window.addEventListener("scroll",R.onscroll),sML.style(R.Content.Main,{transition:"opacity 0.4s ease",opacity:1}),a&&"function"==typeof a.callback&&a.callback()},100)},100)},222)}},R.onscroll=function(){!R.Started},R.onresize=function(){R.Started&&(R.Timer_onresize&&clearTimeout(R.Timer_onresize),R.Timer_onresize=setTimeout(function(){R.relayout()},888))},R.changeView=function(a){return"string"!=typeof a||S.RVM==a?!1:("paged"!=a&&R.Spreads.forEach(function(a){a.style.opacity=1}),R.Started?void R.relayout({Setting:{"reader-view-mode":a},callback:function(){E.dispatch("bibi:changeView",a)}}):(S.update({"reader-view-mode":a}),L.play()))},R.getCurrentPages=function(){var a=sML.Coord.getScrollCoord(R.Frame),b=sML.Coord.getClientSize(R.Frame);a={Left:a.X,Right:a.X+b.Width,Top:a.Y,Bottom:a.Y+b.Height};for(var c=a[S.BASE.B]/R.Scale*S.AXIS.PM,d=a[S.BASE.A]/R.Scale*S.AXIS.PM,e=[],f=[],g=[],h=0,i=0,j=R.Pages.length;j>i;i++){var k=sML.getCoord(R.Pages[i]),l=k[S.BASE.B]*S.AXIS.PM,m=k[S.BASE.A]*S.AXIS.PM,n=Math.min(d,m)-Math.max(c,l),o=0>=n||!k[S.SIZE.L]||isNaN(n)?0:Math.round(n/k[S.SIZE.L]*100);if(0>=o){if(e.length)break}else o>h?(e[0]=R.Pages[i],f[0]=o,g[0]=R.getCurrentPages.getStatus(o,c,l),h=o):o==h&&(e.push(R.Pages[i]),f.push(o),g.push(R.getCurrentPages.getStatus(o,c,l)))}return{Pages:e,Ratio:f,Status:g,StartPage:e[0],StartPageRatio:f[0],StartPageStatus:g[0],EndPage:e[e.length-1],EndPageRatio:f[f.length-1],EndPageStatus:g[g.length-1]}},R.getCurrentPages.getStatus=function(a,b,c){return 100==a?"shown":c>b?"yet":b>c?"over":"shown"},R.focus=function(a,b){if(a=R.focus.hatchTarget(a),!a)return!1;if(0==a.Page.PageIndex)var c="rtl"!=S.SLD?0:R.Content.Main["offset"+[S.SIZE.L]]-sML.Coord.getClientSize(R.Frame)[S.SIZE.L];else if(a.Page.PageIndex==R.Pages.length-1)var c="rtl"==S.SLD?0:R.Content.Main["offset"+[S.SIZE.L]]-sML.Coord.getClientSize(R.Frame)[S.SIZE.L];else{if("pre-paginated"==S["book-rendition-layout"])if(window["inner"+S.SIZE.L]>a.Page.Spread["offset"+S.SIZE.L]){var c=O.getElementCoord(a.Page.Spread)[S.AXIS.L];c-=Math.floor((window["inner"+S.SIZE.L]-a.Page.Spread["offset"+S.SIZE.L])/2)}else{var c=O.getElementCoord(a.Page)[S.AXIS.L];window["inner"+S.SIZE.L]>a.Page["offset"+S.SIZE.L]&&(c-=Math.floor((window["inner"+S.SIZE.L]-a.Page["offset"+S.SIZE.L])/2))}else{var c=O.getElementCoord(a.Page)[S.AXIS.L];c-=S["spread-gap"]/2*S.AXIS.PM,"rtl"==S.SLD&&(c+=a.Page.offsetWidth-window.innerWidth)}"number"==typeof a.TextNodeIndex&&R.selectTextLocation(a)}var d={X:0,Y:0};if(d[S.AXIS.L]=c*R.Scale,"paged"==S.RVM){sML.style(R.Content,{transition:"ease-out 0.05s"});var e=R.Frame==window?window["scroll"+S.AXIS.L]:R.Frame["scroll"+("horizontal"==S.SLA?"Left":"Top")];sML.addClass(O.HTML,"flipping-"+(c>e?"ahead":"astern")),setTimeout(function(){sML.style(R.Content,{transition:"none"}),sML.scrollTo(R.Frame,d,{Duration:1},{end:function(){"paged"==S.RVM&&(R.Spreads.forEach(function(b){b==a.Item.Spread&&(b.style.opacity=1)}),sML.removeClass(O.HTML,"flipping-ahead"),sML.removeClass(O.HTML,"flipping-astern")),E.dispatch("bibi:focus",a)}})},50)}else sML.scrollTo(R.Frame,d,b);return!1},R.focus.hatchTarget=function(a){return a?("number"==typeof a||"string"==typeof a&&/^\d+$/.test(a)?a=U.getBibiToTarget(a):"string"==typeof a?a="head"==a||"foot"==a?{Edge:a}:U.getEPUBCFITarget(a):a.tagName&&(a="number"==typeof a.PageIndex?{Page:a}:"number"==typeof a.ItemIndex?{Item:a}:"number"==typeof a.SpreadIndex?{Spread:a}:{Element:a}),a.Page&&!a.Page.parentElement&&delete a.Page,a.Item&&!a.Item.parentElement&&delete a.Item,a.Spread&&!a.Spread.parentElement&&delete a.Spread,a.Element&&!a.Element.parentElement&&delete a.Element,"string"==typeof a.Edge?"head"==a.Edge?a.Page=R.Pages[0]:(a.Page=R.Pages[R.Pages.length-1],a.Edge="foot"):(a.Element||(a.Item||("number"==typeof a.ItemIndex?a.Item=R.Items[a.ItemIndex]:(a.Spread||"number"!=typeof a.SpreadIndex||(a.Spread=R.Spreads[a.SpreadIndex]),a.Spread&&("number"==typeof a.PageIndexInSpread?a.Page=a.Spread.Pages[a.PageIndexInSpread]:a.Item="number"==typeof a.ItemIndexInSpread?a.Spread.Items[a.ItemIndexInSpread]:a.Spread.Items[0]))),a.Item&&"string"==typeof a.ElementSelector&&(a.Element=a.Item.contentDocument.querySelector(a.ElementSelector))),a.Element?a.Page=R.focus.getNearestPageOfElement(a.Element):a.Page||(a.Page="number"==typeof a.PageIndexInItem?a.Item.Pages[a.PageIndex]:"number"==typeof a.PageProgressInItem?a.Item.Pages[Math.floor(a.Item.Pages.length*a.PageProgressInItem)]:a.Item.Pages[0])),a.Page?(a.Item=a.Page.Item,a.Spread=a.Page.Spread,a):null):null},R.focus.getNearestPageOfElement=function(a){var b=a.ownerDocument.body.Item;if(!b)return R.Pages[0];if(b.Columned){var c=O.getElementCoord(a)[S.AXIS.B];if("rtl"==S.PPD&&"vertical"==S.SLA){var d=b.Body["offset"+S.SIZE.B];if(b.Body.offsetParent){var e=getComputedStyle(b.HTML),f=Math.ceil(parseFloat(e["padding"+S.BASE.B])+parseFloat(e["padding"+S.BASE.A]));d+=f}c=d-c+a["offset"+S.SIZE.B]}var g=b.Pages[Math.floor(c/b.ColumnBreadth)]}else{var c=O.getElementCoord(a)[S.AXIS.L];"rtl"==S.SLD&&"horizontal"==S.SLA&&(c=b.HTML.offsetWidth-c-a.offsetWidth);for(var g=b.Pages[0],h=0,i=b.Pages.length;i>h;h++)if(c-=b.Pages[h]["offset"+S.SIZE.L],0>=c){g=b.Pages[h];break}}return g},R.selectTextLocation=function(a){if("number"==typeof a.TextNodeIndex){var b=a.Element.childNodes[a.TextNodeIndex];if(b&&b.textContent){var c={Start:{Node:b,Index:0},End:{Node:b,Index:b.textContent.length}};if(a.TermStep)if(a.TermStep.Preceding||a.TermStep.Following){if(c.Start.Index=a.TermStep.Index,c.End.Index=a.TermStep.Index,a.TermStep.Preceding&&(c.Start.Index-=a.TermStep.Preceding.length),a.TermStep.Following&&(c.End.Index+=a.TermStep.Following.length),c.Start.Index<0||b.textContent.length<c.End.Index)return;if(b.textContent.substr(c.Start.Index,c.End.Index-c.Start.Index)!=a.TermStep.Preceding+a.TermStep.Following)return}else if(a.TermStep.Side&&"a"==a.TermStep.Side){for(c.Start.Node=b.parentNode.firstChild;c.Start.Node.childNodes.length;)c.Start.Node=c.Start.Node.firstChild;c.End.Index=a.TermStep.Index-1}else{for(c.Start.Index=a.TermStep.Index,c.End.Node=b.parentNode.lastChild;c.End.Node.childNodes.length;)c.End.Node=c.End.Node.lastChild;c.End.Index=c.End.Node.textContent.length}return sML.select(c)}}},R.page=function(a){-1!=a&&(a=1);var b=0>a?"StartPage":"EndPage",c=R.getCurrentPages(),d=function(){return 0>a&&"over"==c[b+"Status"]?c[b].PageIndex:a>0&&"yet"==c[b+"Status"]?c[b].PageIndex:c[b].PageIndex+a}();0>d&&(d=0),d>R.Pages.length-1&&(d=R.Pages.length-1);var e=R.Pages[d];"pre-paginated"==S.BRL&&e.Item.Pair&&"horizontal"==S.SLA&&window["inner"+S.SIZE.L]>e.Spread["offset"+S.SIZE.L]&&(0>a&&0==e.PageIndexInSpread&&(e=e.Spread.Pages[1]),a>0&&1==e.PageIndexInSpread&&(e=e.Spread.Pages[0])),R.focus({Page:e})},R.scroll=function(a){return-1!=a&&(a=1),sML.scrollTo(R.Frame,function(b){switch(S.SLD){case"ttb":return{Y:b.Y+(R.StageSize.Length+S["spread-gap"])*a};case"ltr":return{X:b.X+(R.StageSize.Length+S["spread-gap"])*a};case"rtl":return{X:b.X+(R.StageSize.Length+S["spread-gap"])*a*-1}}}(sML.Coord.getScrollCoord(R.Frame)))},R.move=function(a){R.Started&&("number"==typeof a||"string"==typeof a&&/^\d+$/.test(a))&&((R.Columned||"pre-paginated"==S.BRL?R.page:R.scroll)(a),E.dispatch("bibi:move",a))},R.to=function(a){return R.focus(U.getBibiToTarget(a))},R.Scale=1,R.zoom=function(a){("number"!=typeof a||0>=a)&&(a=1);var b=R.getCurrentPages().StartPage;sML.style(R.Content.Main,{"transform-origin":"rtl"==S.SLD?"100% 0":"0 0"}),1==a?(O.HTML.style.overflow="",sML.style(R.Content.Main,{transform:""})):(sML.style(R.Content.Main,{transform:"scale("+a+")"}),O.HTML.style.overflow="auto"),setTimeout(function(){R.focus({Page:b},{Duration:0,Easing:0})},0),R.Scale=a},N.found=function(){},C.createVeil=function(){C.Veil=document.getElementById("bibi-veil"),sML.edit(C.Veil,{State:1,open:function(a){return 1==this.State?"function"==typeof a?a():this.State:(this.State=1,this.style.display="block",this.style.zIndex=100,sML.style(this,{transition:"0.5s ease-out",transform:"",opacity:.75},function(){"function"==typeof a&&a()}),this.State)},close:function(a){if(0==this.State)return"function"==typeof a?a():this.State;this.State=0,this.Message.style.opacity=0;var b=function(a){if("vertical"!=S.RVM)var b="X",c="ltr"==S.PPD?-1:1;else var b="Y",c=-1;return"translate"+b+"("+a*c+"%)"};return sML.style(this,{transition:"0.5s ease-in",transform:b(240),opacity:0},function(){sML.style(this,{transition:"none",transform:b(-240)}),this.style.zIndex=1,this.style.display="none","function"==typeof a&&a()}),this.State},toggle:function(a){return 0==this.State?this.open(a):this.close(a)}}),C.Veil.Cover=C.Veil.appendChild(sML.create("div",{id:"bibi-veil-cover"})),C.Veil.Mark=C.Veil.appendChild(sML.create("div",{className:"animate",id:"bibi-veil-mark"})),C.Veil.Message=C.Veil.appendChild(sML.create("p",{className:"animate",id:"bibi-veil-message",note:function(a){return C.Veil.Message.innerHTML=a,a}})),C.Veil.Powered=C.Veil.appendChild(sML.create("p",{id:"bibi-veil-powered",innerHTML:O.getLogo({Color:"white",Linkify:!0})}));for(var a=1;8>=a;a++)C.Veil.Mark.appendChild(sML.create("span",{className:"dot dot-"+(a%2?"odd":"even")+" dot-"+a}));E.add("bibi:startLoading",function(){sML.addClass(C.Veil,"animate"),C.Veil.Message.note("Loading...")}),E.add("bibi:stopLoading",function(){sML.removeClass(C.Veil,"animate"),C.Veil.Message.note("")}),E.add("bibi:updateStatus",function(a){"string"==typeof a&&C.Veil.Message.note(a)}),E.add("bibi:wait",function(){var a=(sML.OS.iOS||sML.OS.Android?"Tap":"Click")+" to Open";C.Veil.PlayButton=C.Veil.appendChild(sML.create("p",{id:"bibi-veil-playbutton",title:a,innerHTML:'<span class="non-visual">'+a+"</span>",hide:function(){this.removeEventListener("click"),sML.style(this,{opacity:0,cursor:"default"})}})),C.Veil.PlayButton.addEventListener("click",function(a){a.stopPropagation(),L.play()}),E.add("bibi:play",function(){C.Veil.PlayButton.hide()})}),E.dispatch("bibi:createVeil")},C.createCartain=function(){C.Cartain=O.Body.appendChild(sML.create("div",{id:"bibi-cartain",State:0,open:function(a){return 1==this.State?"function"==typeof a?a():this.State:(this.State=1,sML.addClass(O.HTML,"cartain-opened"),setTimeout(a,250),this.State)},close:function(a){return 0==this.State?"function"==typeof a?a():this.State:(this.State=0,sML.removeClass(O.HTML,"cartain-opened"),setTimeout(a,250),this.State)},toggle:function(a){var b=0==this.State?this.open(a):this.close(a);return E.dispatch("bibi:toggleCartain",b),b}})),C.Cartain.Misc=C.Cartain.appendChild(sML.create("div",{id:"bibi-cartain-misc",innerHTML:O.getLogo({Color:"black",Linkify:!0})})),C.Cartain.Navigation=C.Cartain.appendChild(sML.create("div",{id:"bibi-cartain-navigation"})),C.Cartain.Navigation.ItemBox=C.Cartain.Navigation.appendChild(sML.create("div",{id:"bibi-cartain-navigation-item-box"})),C.Cartain.Navigation.Item=C.Cartain.Navigation.ItemBox.appendChild(sML.create("div",{id:"bibi-cartain-navigation-item",ItemBox:C.Cartain.Navigation.ItemBox})),C.Cartain.Navigation.ItemBox.addEventListener("click",function(){C.Cartain.toggle()}),C.menu=C.Cartain.appendChild(sML.create("div",{id:"bibi-menus"})),C["switch"]=O.Body.appendChild(sML.create("div",{id:"bibi-switches"},{transition:"opacity 0.75s linear"})),C["switch"].Cartain=C.addButton({id:"bibi-switch-cartain",Category:"switch",Group:"cartain",Labels:[{ja:"",en:"Open Menu"},{ja:"",en:"Close Menu"}],IconHTML:'<span class="bibi-icon bibi-switch bibi-switch-cartain"></span>'},function(){C.Cartain.toggle(),C.setLabel(C["switch"].Cartain,C.Cartain.State)}),E.add("bibi:start",function(){sML.style(C["switch"].Cartain,{display:"block"})}),E.dispatch("bibi:createCartain")},C.setLabel=function(a,b){"number"!=typeof b&&(b=0);var c="ja"==B.Package.Metadata.languages[0].split("-")[0],d=a.Labels[a.Labels.length>1?b:0];return a.title=a.Label.innerHTML=(c?d.ja+" / ":"")+d.en,b},C.addButton=function(a,b){if("string"!=typeof a.Category||"string"!=typeof a.Group)return!1;C[a.Category][a.Group]||(C[a.Category][a.Group]=C[a.Category].appendChild(sML.create("ul")));var c=C[a.Category][a.Group].appendChild(sML.create("li",{className:"bibi-button",innerHTML:("string"==typeof a.IconHTML?a.IconHTML:'<span class="bibi-icon"></span>')+'<span class="bibi-button-label non-visual"></span>',Category:a.Category,Group:a.Group,Labels:a.Labels}));("string"==typeof a.id||/^[a-zA-Z_][a-zA-Z0-9_\-]*$/.test(a.id))&&(c.id=a.id),c.Label=c.querySelector(".bibi-icon").appendChild(sML.create("span",{className:"non-visual"})),sML.addTouchEventObserver(c).addTouchEventListener("tap",function(){b()}),C[a.Category][a.Group].style.display="block";try{C.setLabel(c,0)}catch(d){E.add("bibi:readPackageDocument",function(){C.setLabel(c,0)})}return c},C.removeButton=function(a){if("string"==typeof a&&(a=document.getElementById(a)),!a)return!1;var b=a.parentNode;return b.removeChild(a),b.getElementsByTagName("li").length||(b.style.display="none"),!0},P.initialize=function(a){O.apply(a,P),/^(horizontal|vertical|paged)$/.test(P["reader-view-mode"])||(P["reader-view-mode"]="horizontal"),["spread-gap","spread-margin-start","spread-margin-end","item-padding-left","item-padding-right","item-padding-top","item-padding-bottom"].forEach(function(a){P[a]="number"!=typeof P[a]||P[a]<0?0:Math.round(P[a])}),P["spread-gap"]%2&&P["spread-gap"]++,/^(https?:)?\/\//.test(P.bookshelf)||(P.bookshelf=O.getPath(location.href.split("?")[0].replace(/[^\/]*$/,"")+P.bookshelf)),P["trustworthy-origins"]instanceof Array||(P["trustworthy-origins"]=[]),P["trustworthy-origins"][0]!=location.origin&&P["trustworthy-origins"].unshift(location.origin)},U.initialize=function(){var a=U.parseQuery(location.search),b=U.parseFileName(location.pathname),c=U.parseHash(location.hash);U.book=a.book?a.book:b.book?b.book:"",c.epubcfi&&(U.epubcfi=c.epubcfi,U.to=U.getEPUBCFITarget(c.epubcfi));var d=function(a){return"string"!=typeof a?{}:void a.replace(" ","").split(",").forEach(function(a){if(a=a.split(":"),a[0]){if(a[1])switch(a[0]){case"parent-origin":a[1]=U.decode(a[1]);break;case"poster":a[1]=U.decode(a[1]);break;case"autostart":a[1]=/^(undefined|autostart|yes|true)?$/.test(a[1]);break;case"reader-view-mode":a[1]=/^(horizontal|vertical|paged)$/.test(a[1])?a[1]:void 0;break;case"to":a[1]=U.getBibiToTarget(a[1]);break;case"nav":a[1]=/^[1-9]\d*$/.test(a[1])?1*a[1]:void 0;break;case"view":a[1]=/^fixed$/.test(a[1])?a[1]:void 0;break;case"arrows":a[1]=/^hidden$/.test(a[1])?a[1]:void 0;break;case"preset":break;default:a[0]=void 0}else switch(a[0]){case"horizontal":case"vertical":case"paged":a[1]=a[0],a[0]="reader-view-mode";break;case"autostart":a[1]=!0;break;default:a[0]=void 0}a[0]&&"undefined"!=typeof a[1]&&(U[a[0]]=a[1])}})};c.bibi&&d(c.bibi),c.pipi&&(d(c.pipi),U["parent-origin"]&&P["trustworthy-origins"].push(U["parent-origin"]),history.replaceState&&history.replaceState(null,null,location.href.replace(/[\,#]pipi\([^\)]*\)$/g,"")))},U.decode=function(a){return decodeURIComponent(a.replace("_BibiKakkoClose_",")").replace("_BibiKakkoOpen_","("))},U.distillBookName=function(a){return"string"==typeof a&&a?/^([\w\d]+:)?\/\//.test(a)?"":a:""},U.parseQuery=function(a){if("string"!=typeof a)return{};a=a.replace(/^\?/,"");var b={};return a.split("&").forEach(function(a){if(a=a.split("="),/^[a-z]+$/.test(a[0])){if("book"==a[0]&&(a[1]=U.distillBookName(a[1]),!a[1]))return;b[a[0]]=a[1]}}),b},U.parseFileName=function(a){if("string"!=typeof a)return{};var b=U.distillBookName(a.replace(/^.*([^\/]*)$/,"$1").replace(/\.(x?html?|php|cgi|aspx?)$/,"").replace(/^index$/,""));return b?{book:b}:{}},U.parseHash=function(a){if("string"!=typeof a)return{};a=a.replace(/^#/,"");var b={},c=0,d=function(){for(var d=c,e="";/[a-z_]/.test(a.charAt(c));)c++;if("("!=a.charAt(c))return{};for(e=a.substr(d,c-1-d+1),c++;")"!=a.charAt(c);)c++;e&&(b[e]=a.substr(d,c-d+1).replace(/^[a-z_]+\(/,"").replace(/\)$/,"")),c++};for(d();","==a.charAt(c);)c++,d();return b},U.getBibiToTarget=function(a){if("number"==typeof a&&(a=""+a),"string"!=typeof a||!/^[1-9][0-9]*(-[1-9][0-9]*(\.[1-9][0-9]*)*)?$/.test(a))return null;var b="",c=a.split("-"),d=parseInt(c[0]),e=c[1]?c[1]:null;return e&&e.split(".").forEach(function(a){b+=">*:nth-child("+a+")"}),{BibitoString:a,ItemIndex:d-1,ElementSelector:b?"body"+b:void 0}},U.getEPUBCFITarget=function(a){if(!X.EPUBCFI)return null;var b=X.EPUBCFI.parse(a);if(!b||b.Path.Steps.length<2||!b.Path.Steps[1].Index||b.Path.Steps[1].Index%2==1)return null;var c=b.Path.Steps[1].Index/2-1,d=null,e=null,f=null,g=null;return b.Path.Steps[2]&&b.Path.Steps[2].Steps&&(d="",b.Path.Steps[2].Steps.forEach(function(a,c){return"IndirectPath"==a.Type?(g=a,!1):"TermStep"==a.Type?(f=a,!1):a.Index%2==1&&(e=a.Index-1,c!=b.Path.Steps[2].Steps.length-2)?!1:void(null===e&&(d=a.ID?"#"+a.ID:d+">*:nth-child("+a.Index/2+")"))}),d&&/^>/.test(d)&&(d="html"+d),d||(d=null)),{CFI:b,CFIString:a,ItemIndex:c,ElementSelector:d,TextNodeIndex:e,TermStep:f,IndirectPath:g}},S.initialize=function(){S.reset(),"undefined"==typeof S.autostart&&(S.autostart=!O.WindowEmbedded)},S.reset=function(){for(var a in S)"function"!=typeof S[a]&&delete S[a];O.apply(P,S),O.apply(U,S),delete S.book,delete S.bookshelf},S.update=function(a){var b=S.RVM,c=S.PPD,d=S.SLA,e=S.SLD;if("object"==typeof a){a.Reset&&(alert("[dev] S.update(Settings) receives Settings.Reset!!"),S.reset(),delete a.Reset);for(var f in a)"function"!=typeof S[f]&&(S[f]=a[f])}S.BRL=S["book-rendition-layout"]=B.Package.Metadata["rendition:layout"],S.BWM=S["book-writing-mode"]=/^tb/.test(B.WritingMode)&&!O.VerticalTextEnabled?"lr-tb":B.WritingMode,S.RVM=S["reader-view-mode"],"reflowable"==S.BRL?"tb-rl"==S.BWM?(S.PPD=S["page-progression-direction"]="rtl",S.SLA=S["spread-layout-axis"]="paged"==S.RVM?"vertical":S.RVM):"tb-lr"==S.BWM?(S.PPD=S["page-progression-direction"]="ltr",S.SLA=S["spread-layout-axis"]="paged"==S.RVM?"vertical":S.RVM):"rl-tb"==S.BWM?(S.PPD=S["page-progression-direction"]="rtl",S.SLA=S["spread-layout-axis"]="paged"==S.RVM?"horizontal":S.RVM):(S.PPD=S["page-progression-direction"]="ltr",S.SLA=S["spread-layout-axis"]="paged"==S.RVM?"horizontal":S.RVM):(S.PPD=S["page-progression-direction"]="rtl"==B.Package.Spine["page-progression-direction"]?"rtl":"ltr",S.SLA=S["spread-layout-axis"]="paged"==S.RVM?"horizontal":S.RVM),S.SLD=S["spread-layout-direction"]="vertical"==S["spread-layout-axis"]?"ttb":S["page-progression-direction"],"horizontal"==S.SLA?(S.SIZE={b:"height",B:"Height",l:"width",L:"Width",w:"length",W:"Length",h:"breadth",H:"Breadth"},"ltr"==S.PPD?(S.AXIS={B:"Y",L:"X",PM:1},S.BASE={b:"left",B:"Left",a:"right",A:"Right",s:"top",S:"Top",e:"bottom",E:"Bottom",c:"middle",m:"center"}):(S.AXIS={B:"Y",L:"X",PM:-1},S.BASE={b:"right",B:"Right",a:"left",A:"Left",s:"top",S:"Top",e:"bottom",E:"Bottom",c:"middle",m:"center"})):(S.SIZE={b:"width",B:"Width",l:"height",L:"Height",w:"breadth",W:"Breadth",h:"length",H:"Length"},S.AXIS={B:"X",L:"Y",PM:1},S.BASE="ltr"==S.PPD?{b:"top",B:"Top",a:"bottom",A:"Bottom",s:"left",S:"Left",e:"right",E:"Right",c:"center",m:"middle"}:{b:"top",B:"Top",a:"bottom",A:"Bottom",s:"right",S:"Right",e:"left",E:"Left",c:"center",m:"middle"}),b!=S.RVM&&sML.replaceClass(O.HTML,"view-"+b,"view-"+S.RVM),c!=S.PPD&&sML.replaceClass(O.HTML,"page-"+c,"page-"+S.PPD),d!=S.SLA&&sML.replaceClass(O.HTML,"spread-"+d,"spread-"+S.SLA),e!=S.SLD&&sML.replaceClass(O.HTML,"spread-"+e,"spread-"+S.SLD)},O.Log=(!parent||parent==window)&&console&&console.log,O.log=function(a,b,c){if(O.Log&&b&&"string"==typeof b&&(c&&O.updateStatus(b),!O.SmartPhone)){switch(a){case 0:b="[ERROR] "+b;break;case 1:b="-------- "+b+" --------";break;case 2:b=b;break;case 3:b=" - "+b;break;case 4:b="   . "+b}console.log("BiB/i: "+b)}},O.updateStatus=function(a){O.SmartPhone||(O.statusClearer&&clearTimeout(O.statusClearer),window.status="BiB/i: "+a,O.statusClearer=setTimeout(function(){window.status=""},3210)),E.dispatch("bibi:updateStatus",a)},O.startLoading=function(){sML.addClass(O.HTML,"wait-please"),E.dispatch("bibi:startLoading")},O.stopLoading=function(){sML.removeClass(O.HTML,"wait-please"),E.dispatch("bibi:stopLoading")},O.error=function(a){O.stopLoading(),O.log(0,a),E.dispatch("bibi:error",a)},O.apply=function(a,b){for(var c in a)"function"!=typeof b[c]&&"function"!=typeof a[c]&&(b[c]=a[c])},O.download=function(a,b){return new Promise(function(c,d){var e=new XMLHttpRequest;b&&e.overrideMimeType(b),e.open("GET",a,!0),e.onloadend=function(){if(200!==e.status){var b="XHR HTTP status: "+e.status+' "'+a+'"';return O.error(b),void d(new Error(b))}c(e)},e.send(null)})},O.requestDocument=function(a){var b,c,d=/\.(xml|opf|ncx)$/i.test(a);return(B.Zipped?Promise.resolve(c):O.download(B.Path+"/"+a).then(function(a){return b=a,d||(c=b.responseXML),c})).then(function(c){if(c)return c;var e=B.Zipped?B.Files[a]:b.responseText;return c=sML.create("object",{innerHTML:d?O.toBibiXML(e):e}),d&&sML.each([c].concat(sML.toArray(c.getElementsByTagName("*"))),function(){this.getElementsByTagName=function(a){return this.querySelectorAll("bibi_"+a.replace(/:/g,"_"))}}),c&&c.childNodes&&c.childNodes.length?c:O.error('Invalid Content. - "'+a+'"')})},O.openDocument=function(a,b){b&&"object"==typeof b&&"function"==typeof b.then||(b={then:function(){return!1}}),O.requestDocument(a).then(b.then)},O.translateWritingMode=function(a){sML.UA.Gecko?/ (-(webkit|epub)-)?writing-mode: vertical-rl; /.test(a.cssText)?a.style.writingMode="vertical-rl":/ (-(webkit|epub)-)?writing-mode: vertical-lr; /.test(a.cssText)?a.style.writingMode="vertical-lr":/ (-(webkit|epub)-)?writing-mode: horizontal-tb; /.test(a.cssText)&&(a.style.writingMode="horizontal-tb"):sML.UA.InternetExplorer<12&&(/ (-(webkit|epub)-)?writing-mode: vertical-rl; /.test(a.cssText)?a.style.writingMode=/ direction: rtl; /.test(a.cssText)?"bt-rl":"tb-rl":/ (-(webkit|epub)-)?writing-mode: vertical-lr; /.test(a.cssText)?a.style.writingMode=/ direction: rtl; /.test(a.cssText)?"bt-lr":"tb-lr":/ (-(webkit|epub)-)?writing-mode: horizontal-tb; /.test(a.cssText)&&(a.style.writingMode=/ direction: rtl; /.test(a.cssText)?"rl-tb":"lr-tb"))},O.getWritingMode=function(a){var b=getComputedStyle(a);return O.WritingModeProperty?/^vertical-/.test(b[O.WritingModeProperty])?("rtl"==b.direction?"bt":"tb")+"-"+(/-lr$/.test(b[O.WritingModeProperty])?"lr":"rl"):/^horizontal-/.test(b[O.WritingModeProperty])?("rtl"==b.direction?"rl":"lr")+"-"+(/-bt$/.test(b[O.WritingModeProperty])?"bt":"tb"):/^(lr|rl|tb|bt)-/.test(b[O.WritingModeProperty])?b[O.WritingModeProperty]:void 0:"rtl"==b.direction?"rl-tb":"lr-tb"},O.getElementInnerText=function(a){var b="InnerText";return"undefined"!=typeof a.innerText?b=a.innerText:"undefined"!=typeof a.textContent&&(b=a.textContent),b.replace(/[\r\n\s\t ]/g,"")},O.getElementCoord=function(a){for(var b={X:a.offsetLeft,Y:a.offsetTop};a.offsetParent;)a=a.offsetParent,b.X+=a.offsetLeft,b.Y+=a.offsetTop;return b},O.getLogo=function(a){var b=sML.UA.InternetExplorer<9?['<span class="bibi-type-B">B</span>','<span class="bibi-type-i">i</span>','<span class="bibi-type-B">B</span>','<span class="bibi-type-slash">/</span>','<span class="bibi-type-i">i</span>'].join(""):'<img alt="BiB/i" src="../../bib/i/res/images/bibi-logo_'+a.Color+'.png" />';return["<",a.Linkify?"a":"span",' class="bibi-logo"',a.Linkify?' href="http://bibi.epub.link/" target="_blank" title="BiB/i | Web Site"':"",">",b,"</",a.Linkify?"a":"span",">"].join("")},O.getPath=function(a){for(var b=1;b<arguments.length;b++)arguments[0]+="/"+arguments[b];for(arguments[0].replace(/^([a-zA-Z]+:\/\/[^\/]+)?\/*(.*)$/,function(){a=[arguments[1],arguments[2]]});/([^:\/])\/{2,}/.test(a[1]);)a[1]=a[1].replace(/([^:\/])\/{2,}/g,"$1/");for(;/\/\.\//.test(a[1]);)a[1]=a[1].replace(/\/\.\//g,"/");for(;/[^\/]+\/\.\.\//.test(a[1]);)a[1]=a[1].replace(/[^\/]+\/\.\.\//g,"");return a[1]=a[1].replace(/^(\.*\/)+/g,""),a[0]?a.join("/"):a[1]},O.toBibiXML=function(a){return a.replace(/<\?[^>]*?\?>/g,"").replace(/<(\/?)([\w\d]+):/g,"<$1$2_").replace(/<(\/?)(opf_)?([^!\?\/ >]+)/g,"<$1bibi_$3").replace(/<([\w\d_]+) ([^>]+?)\/>/g,"<$1 $2></$1>")},E.Binded={},E.add=function(a,b,c){return"string"==typeof a&&/^bibi:/.test(a)&&"function"==typeof b?(b.bibiEventListener||(b.bibiEventListener=function(a){return b.call(document,a.detail)}),document.addEventListener(a,b.bibiEventListener,c),b):!1},E.remove=function(a,b){return"string"==typeof a&&/^bibi:/.test(a)&&"function"==typeof b&&"function"==typeof b.bibiEventListener?(document.removeEventListener(a,b.bibiEventListener),!0):!1},E.bind=function(a,b){return"string"!=typeof a||"function"!=typeof b?!1:(E.Binded[a]instanceof Array||(E.Binded[a]=[]),E.Binded[a].push(b),{Name:a,Index:E.Binded[a].length-1,Function:b})},E.unbind=function(a){if(!a)return!1;if("string"==typeof arguments[0]&&"function"==typeof arguments[1]&&(a={Name:arguments[0],Function:arguments[1]}),"object"!=typeof a||"string"!=typeof a.Name||!(E.Binded[a.Name]instanceof Array))return!1;if("number"==typeof a.Index)return"function"!=typeof E.Binded[a.Name][a.Index]?!1:(E.Binded[a.Name][a.Index]=void 0,!0);if("function"==typeof a.Function){for(var b=!1,c=0,d=E.Binded[a.Name].length;d>c;c++)E.Binded[a.Name][c]==a.Function&&(E.Binded[a.Name][c]=void 0,b=!0);return b}return delete E.Binded[a.Name]},E.dispatch=function(a,b){if(E.Binded[a]instanceof Array)for(var c=0,d=E.Binded[a].length;d>c;c++)"function"==typeof E.Binded[a][c]&&E.Binded[a][c].call(bibi,b);return document.dispatchEvent(new CustomEvent(a,{detail:b}))},M.post=function(a,b){return O.WindowEmbedded&&"string"==typeof a&&a?("string"==typeof b&&b||(b="*"),window.parent.postMessage(a,b)):!1},M.receive=function(a){
if(a=JSON.parse(a),"object"!=typeof a||!a)return!1;for(var b in a)E.dispatch((/^bibi:command:[\w\d]+$/.test(b)?"":"bibi:command:")+b,a[b]);return!0},M.gate=function(a){for(var b=0,c=S["trustworthy-origins"].length;c>b;b++)if(S["trustworthy-origins"][b]==a.origin)return M.receive(a.data)},X.add=function(a){return a&&"object"==typeof a?"string"!=typeof a.name?function(){E.bind("bibi:welcome",function(){O.error("Extention name is invalid.")})}:X[a.name]?function(){E.bind("bibi:welcome",function(){O.error('Extention name "'+a.name+'" is reserved or already taken.')})}:("string"!=typeof a.description&&(a.decription=""),"string"!=typeof a.author&&(a.author=""),"string"!=typeof a.version&&(a.version=""),"string"!=typeof a.build&&(a.build=""),X[a.name]=a,function(b){E.bind("bibi:welcome",function(){b.call(a)})}):function(){return!1}},Bibi.x=X.add,sML.ready(Bibi.welcome);