/*!
 *
 * # BiB/i
 *
 * - "EPUB Reader on Your Web Site."
 * - http://bibi.epub.link/ or https://github.com/satorumurmur/bibi
 * - Copyright (c) Satoru MATSUSHIMA
 * - Licensed under the MIT license. - http://www.opensource.org/licenses/mit-license.php
 *
 * ## Components:
 * 1. Native Promise Only - https://github.com/getify/native-promise-only | Copyright (c) Kyle Simpson - Licensed under the MIT license.
 * 2. Hammer.JS - http://hammerjs.github.io/ | Copyright (c) Jorik Tangelder - Licensed under the MIT license.
 * 3. easing.js - https://github.com/danro/easing-js | Copyright (c) Dan Rogers - Licensed under the MIT license.
 * 4. sML - https://github.com/satorumurmur/sML | Copyright (c) Satoru MATSUSHIMA - Licensed under the MIT license.
 * 5. BiB/i (core)
 * 6. BiB/i Extensions: C+
 *     1. BiB/i Extension: C+Mover
 *     2. BiB/i Extension: C+Indicators
 *     3. BiB/i Extension: C+WindowUtilities
 *     4. BiB/i Extension: C+ViewChanger
 */
/*! Native Promise Only
    v0.8.0-a (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
!function(e,t,n){t[e]=t[e]||n(),"undefined"!=typeof module&&module.exports?module.exports=t[e]:"function"==typeof define&&define.amd&&define(function(){return t[e]})}("Promise","undefined"!=typeof global?global:this,function(){"use strict";function e(e,t){p.add(e,t),u||(u=g(p.drain))}function t(e){var t,n=typeof e;return null==e||"object"!=n&&"function"!=n||(t=e.then),"function"==typeof t?t:!1}function n(){for(var e=0;e<this.chain.length;e++)i(this,1===this.state?this.chain[e].success:this.chain[e].failure,this.chain[e]);this.chain.length=0}function i(e,n,i){var o,r;try{n===!1?i.reject(e.msg):(o=n===!0?e.msg:n.call(void 0,e.msg),o===i.promise?i.reject(TypeError("Promise-chain cycle")):(r=t(o))?r.call(o,i.resolve,i.reject):i.resolve(o))}catch(a){i.reject(a)}}function o(i){var a,l=this;if(!l.triggered){l.triggered=!0,l.def&&(l=l.def);try{(a=t(i))?e(function(){var e=new s(l);try{a.call(i,function(){o.apply(e,arguments)},function(){r.apply(e,arguments)})}catch(t){r.call(e,t)}}):(l.msg=i,l.state=1,l.chain.length>0&&e(n,l))}catch(c){r.call(new s(l),c)}}}function r(t){var i=this;i.triggered||(i.triggered=!0,i.def&&(i=i.def),i.msg=t,i.state=2,i.chain.length>0&&e(n,i))}function a(e,t,n,i){for(var o=0;o<t.length;o++)!function(o){e.resolve(t[o]).then(function(e){n(o,e)},i)}(o)}function s(e){this.def=e,this.triggered=!1}function l(e){this.promise=e,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function c(t){if("function"!=typeof t)throw TypeError("Not a function");if(0!==this.__NPO__)throw TypeError("Not a promise");this.__NPO__=1;var i=new l(this);this.then=function(t,o){var r={success:"function"==typeof t?t:!0,failure:"function"==typeof o?o:!1};return r.promise=new this.constructor(function(e,t){if("function"!=typeof e||"function"!=typeof t)throw TypeError("Not a function");r.resolve=e,r.reject=t}),i.chain.push(r),0!==i.state&&e(n,i),r.promise},this["catch"]=function(e){return this.then(void 0,e)};try{t.call(void 0,function(e){o.call(i,e)},function(e){r.call(i,e)})}catch(a){r.call(i,a)}}var d,u,p,h=Object.prototype.toString,g="undefined"!=typeof setImmediate?function(e){return setImmediate(e)}:setTimeout;try{Object.defineProperty({},"x",{}),d=function(e,t,n,i){return Object.defineProperty(e,t,{value:n,writable:!0,configurable:i!==!1})}}catch(f){d=function(e,t,n){return e[t]=n,e}}p=function(){function e(e,t){this.fn=e,this.self=t,this.next=void 0}var t,n,i;return{add:function(o,r){i=new e(o,r),n?n.next=i:t=i,n=i,i=void 0},drain:function(){var e=t;for(t=n=u=void 0;e;)e.fn.call(e.self),e=e.next}}}();var m=d({},"constructor",c,!1);return c.prototype=m,d(m,"__NPO__",0,!1),d(c,"resolve",function(e){var t=this;return e&&"object"==typeof e&&1===e.__NPO__?e:new t(function(t,n){if("function"!=typeof t||"function"!=typeof n)throw TypeError("Not a function");t(e)})}),d(c,"reject",function(e){return new this(function(t,n){if("function"!=typeof t||"function"!=typeof n)throw TypeError("Not a function");n(e)})}),d(c,"all",function(e){var t=this;return"[object Array]"!=h.call(e)?t.reject(TypeError("Not an array")):0===e.length?t.resolve([]):new t(function(n,i){if("function"!=typeof n||"function"!=typeof i)throw TypeError("Not a function");var o=e.length,r=Array(o),s=0;a(t,e,function(e,t){r[e]=t,++s===o&&n(r)},i)})}),d(c,"race",function(e){var t=this;return"[object Array]"!=h.call(e)?t.reject(TypeError("Not an array")):new t(function(n,i){if("function"!=typeof n||"function"!=typeof i)throw TypeError("Not a function");a(t,e,function(e,t){n(t)},i)})}),c}),/*! Hammer.JS - v2.0.6 - 2015-12-23
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2015 Jorik Tangelder;
 * Licensed under the  license */
function(e,t,n,i){"use strict";function o(e,t,n){return setTimeout(c(e,n),t)}function r(e,t,n){return Array.isArray(e)?(a(e,n[t],n),!0):!1}function a(e,t,n){var o;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==i)for(o=0;o<e.length;)t.call(n,e[o],o,e),o++;else for(o in e)e.hasOwnProperty(o)&&t.call(n,e[o],o,e)}function s(t,n,i){var o="DEPRECATED METHOD: "+n+"\n"+i+" AT \n";return function(){var n=new Error("get-stack-trace"),i=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",r=e.console&&(e.console.warn||e.console.log);return r&&r.call(e.console,o,i),t.apply(this,arguments)}}function l(e,t,n){var i,o=t.prototype;i=e.prototype=Object.create(o),i.constructor=e,i._super=o,n&&se(i,n)}function c(e,t){return function(){return e.apply(t,arguments)}}function d(e,t){return typeof e==de?e.apply(t?t[0]||i:i,t):e}function u(e,t){return e===i?t:e}function p(e,t,n){a(m(t),function(t){e.addEventListener(t,n,!1)})}function h(e,t,n){a(m(t),function(t){e.removeEventListener(t,n,!1)})}function g(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function f(e,t){return e.indexOf(t)>-1}function m(e){return e.trim().split(/\s+/g)}function S(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var i=0;i<e.length;){if(n&&e[i][n]==t||!n&&e[i]===t)return i;i++}return-1}function v(e){return Array.prototype.slice.call(e,0)}function b(e,t,n){for(var i=[],o=[],r=0;r<e.length;){var a=t?e[r][t]:e[r];S(o,a)<0&&i.push(e[r]),o[r]=a,r++}return n&&(i=t?i.sort(function(e,n){return e[t]>n[t]}):i.sort()),i}function L(e,t){for(var n,o,r=t[0].toUpperCase()+t.slice(1),a=0;a<le.length;){if(n=le[a],o=n?n+r:t,o in e)return o;a++}return i}function y(){return me++}function M(t){var n=t.ownerDocument||t;return n.defaultView||n.parentWindow||e}function E(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){d(e.options.enable,[e])&&n.handler(t)},this.init()}function C(e){var t,n=e.options.inputClass;return new(t=n?n:be?F:Le?W:ve?V:D)(e,I)}function I(e,t,n){var i=n.pointers.length,o=n.changedPointers.length,r=t&Pe&&i-o===0,a=t&(we|Te)&&i-o===0;n.isFirst=!!r,n.isFinal=!!a,r&&(e.session={}),n.eventType=t,P(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function P(e,t){var n=e.session,i=t.pointers,o=i.length;n.firstInput||(n.firstInput=T(t)),o>1&&!n.firstMultiple?n.firstMultiple=T(t):1===o&&(n.firstMultiple=!1);var r=n.firstInput,a=n.firstMultiple,s=a?a.center:r.center,l=t.center=R(i);t.timeStamp=he(),t.deltaTime=t.timeStamp-r.timeStamp,t.angle=k(s,l),t.distance=x(s,l),B(n,t),t.offsetDirection=O(t.deltaX,t.deltaY);var c=A(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=c.x,t.overallVelocityY=c.y,t.overallVelocity=pe(c.x)>pe(c.y)?c.x:c.y,t.scale=a?H(a.pointers,i):1,t.rotation=a?N(a.pointers,i):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,w(n,t);var d=e.element;g(t.srcEvent.target,d)&&(d=t.srcEvent.target),t.target=d}function B(e,t){var n=t.center,i=e.offsetDelta||{},o=e.prevDelta||{},r=e.prevInput||{};(t.eventType===Pe||r.eventType===we)&&(o=e.prevDelta={x:r.deltaX||0,y:r.deltaY||0},i=e.offsetDelta={x:n.x,y:n.y}),t.deltaX=o.x+(n.x-i.x),t.deltaY=o.y+(n.y-i.y)}function w(e,t){var n,o,r,a,s=e.lastInterval||t,l=t.timeStamp-s.timeStamp;if(t.eventType!=Te&&(l>Ie||s.velocity===i)){var c=t.deltaX-s.deltaX,d=t.deltaY-s.deltaY,u=A(l,c,d);o=u.x,r=u.y,n=pe(u.x)>pe(u.y)?u.x:u.y,a=O(c,d),e.lastInterval=t}else n=s.velocity,o=s.velocityX,r=s.velocityY,a=s.direction;t.velocity=n,t.velocityX=o,t.velocityY=r,t.direction=a}function T(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:ue(e.pointers[n].clientX),clientY:ue(e.pointers[n].clientY)},n++;return{timeStamp:he(),pointers:t,center:R(t),deltaX:e.deltaX,deltaY:e.deltaY}}function R(e){var t=e.length;if(1===t)return{x:ue(e[0].clientX),y:ue(e[0].clientY)};for(var n=0,i=0,o=0;t>o;)n+=e[o].clientX,i+=e[o].clientY,o++;return{x:ue(n/t),y:ue(i/t)}}function A(e,t,n){return{x:t/e||0,y:n/e||0}}function O(e,t){return e===t?Re:pe(e)>=pe(t)?0>e?Ae:Oe:0>t?xe:ke}function x(e,t,n){n||(n=Fe);var i=t[n[0]]-e[n[0]],o=t[n[1]]-e[n[1]];return Math.sqrt(i*i+o*o)}function k(e,t,n){n||(n=Fe);var i=t[n[0]]-e[n[0]],o=t[n[1]]-e[n[1]];return 180*Math.atan2(o,i)/Math.PI}function N(e,t){return k(t[1],t[0],ze)+k(e[1],e[0],ze)}function H(e,t){return x(t[0],t[1],ze)/x(e[0],e[1],ze)}function D(){this.evEl=We,this.evWin=Ue,this.allow=!0,this.pressed=!1,E.apply(this,arguments)}function F(){this.evEl=je,this.evWin=Ye,E.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function z(){this.evTarget=$e,this.evWin=qe,this.started=!1,E.apply(this,arguments)}function X(e,t){var n=v(e.touches),i=v(e.changedTouches);return t&(we|Te)&&(n=b(n.concat(i),"identifier",!0)),[n,i]}function W(){this.evTarget=Qe,this.targetIds={},E.apply(this,arguments)}function U(e,t){var n=v(e.touches),i=this.targetIds;if(t&(Pe|Be)&&1===n.length)return i[n[0].identifier]=!0,[n,n];var o,r,a=v(e.changedTouches),s=[],l=this.target;if(r=n.filter(function(e){return g(e.target,l)}),t===Pe)for(o=0;o<r.length;)i[r[o].identifier]=!0,o++;for(o=0;o<a.length;)i[a[o].identifier]&&s.push(a[o]),t&(we|Te)&&delete i[a[o].identifier],o++;return s.length?[b(r.concat(s),"identifier",!0),s]:void 0}function V(){E.apply(this,arguments);var e=c(this.handler,this);this.touch=new W(this.manager,e),this.mouse=new D(this.manager,e)}function Z(e,t){this.manager=e,this.set(t)}function j(e){if(f(e,it))return it;var t=f(e,ot),n=f(e,rt);return t&&n?it:t||n?t?ot:rt:f(e,nt)?nt:tt}function Y(e){this.options=se({},this.defaults,e||{}),this.id=y(),this.manager=null,this.options.enable=u(this.options.enable,!0),this.state=at,this.simultaneous={},this.requireFail=[]}function _(e){return e&ut?"cancel":e&ct?"end":e&lt?"move":e&st?"start":""}function $(e){return e==ke?"down":e==xe?"up":e==Ae?"left":e==Oe?"right":""}function q(e,t){var n=t.manager;return n?n.get(e):e}function G(){Y.apply(this,arguments)}function Q(){G.apply(this,arguments),this.pX=null,this.pY=null}function K(){G.apply(this,arguments)}function J(){Y.apply(this,arguments),this._timer=null,this._input=null}function ee(){G.apply(this,arguments)}function te(){G.apply(this,arguments)}function ne(){Y.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ie(e,t){return t=t||{},t.recognizers=u(t.recognizers,ie.defaults.preset),new oe(e,t)}function oe(e,t){this.options=se({},ie.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.element=e,this.input=C(this),this.touchAction=new Z(this,this.options.touchAction),re(this,!0),a(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function re(e,t){var n=e.element;n.style&&a(e.options.cssProps,function(e,i){n.style[L(n.style,i)]=t?e:""})}function ae(e,n){var i=t.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=n,n.target.dispatchEvent(i)}var se,le=["","webkit","Moz","MS","ms","o"],ce=t.createElement("div"),de="function",ue=Math.round,pe=Math.abs,he=Date.now;se="function"!=typeof Object.assign?function(e){if(e===i||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(o!==i&&null!==o)for(var r in o)o.hasOwnProperty(r)&&(t[r]=o[r])}return t}:Object.assign;var ge=s(function(e,t,n){for(var o=Object.keys(t),r=0;r<o.length;)(!n||n&&e[o[r]]===i)&&(e[o[r]]=t[o[r]]),r++;return e},"extend","Use `assign`."),fe=s(function(e,t){return ge(e,t,!0)},"merge","Use `assign`."),me=1,Se=/mobile|tablet|ip(ad|hone|od)|android/i,ve="ontouchstart"in e,be=L(e,"PointerEvent")!==i,Le=ve&&Se.test(navigator.userAgent),ye="touch",Me="pen",Ee="mouse",Ce="kinect",Ie=25,Pe=1,Be=2,we=4,Te=8,Re=1,Ae=2,Oe=4,xe=8,ke=16,Ne=Ae|Oe,He=xe|ke,De=Ne|He,Fe=["x","y"],ze=["clientX","clientY"];E.prototype={handler:function(){},init:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(M(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&h(this.element,this.evEl,this.domHandler),this.evTarget&&h(this.target,this.evTarget,this.domHandler),this.evWin&&h(M(this.element),this.evWin,this.domHandler)}};var Xe={mousedown:Pe,mousemove:Be,mouseup:we},We="mousedown",Ue="mousemove mouseup";l(D,E,{handler:function(e){var t=Xe[e.type];t&Pe&&0===e.button&&(this.pressed=!0),t&Be&&1!==e.which&&(t=we),this.pressed&&this.allow&&(t&we&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:Ee,srcEvent:e}))}});var Ve={pointerdown:Pe,pointermove:Be,pointerup:we,pointercancel:Te,pointerout:Te},Ze={2:ye,3:Me,4:Ee,5:Ce},je="pointerdown",Ye="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(je="MSPointerDown",Ye="MSPointerMove MSPointerUp MSPointerCancel"),l(F,E,{handler:function(e){var t=this.store,n=!1,i=e.type.toLowerCase().replace("ms",""),o=Ve[i],r=Ze[e.pointerType]||e.pointerType,a=r==ye,s=S(t,e.pointerId,"pointerId");o&Pe&&(0===e.button||a)?0>s&&(t.push(e),s=t.length-1):o&(we|Te)&&(n=!0),0>s||(t[s]=e,this.callback(this.manager,o,{pointers:t,changedPointers:[e],pointerType:r,srcEvent:e}),n&&t.splice(s,1))}});var _e={touchstart:Pe,touchmove:Be,touchend:we,touchcancel:Te},$e="touchstart",qe="touchstart touchmove touchend touchcancel";l(z,E,{handler:function(e){var t=_e[e.type];if(t===Pe&&(this.started=!0),this.started){var n=X.call(this,e,t);t&(we|Te)&&n[0].length-n[1].length===0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:ye,srcEvent:e})}}});var Ge={touchstart:Pe,touchmove:Be,touchend:we,touchcancel:Te},Qe="touchstart touchmove touchend touchcancel";l(W,E,{handler:function(e){var t=Ge[e.type],n=U.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:ye,srcEvent:e})}}),l(V,E,{handler:function(e,t,n){var i=n.pointerType==ye,o=n.pointerType==Ee;if(i)this.mouse.allow=!1;else if(o&&!this.mouse.allow)return;t&(we|Te)&&(this.mouse.allow=!0),this.callback(e,t,n)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Ke=L(ce.style,"touchAction"),Je=Ke!==i,et="compute",tt="auto",nt="manipulation",it="none",ot="pan-x",rt="pan-y";Z.prototype={set:function(e){e==et&&(e=this.compute()),Je&&this.manager.element.style&&(this.manager.element.style[Ke]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return a(this.manager.recognizers,function(t){d(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),j(e.join(" "))},preventDefaults:function(e){if(!Je){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)return void t.preventDefault();var i=this.actions,o=f(i,it),r=f(i,rt),a=f(i,ot);if(o){var s=1===e.pointers.length,l=e.distance<2,c=e.deltaTime<250;if(s&&l&&c)return}if(!a||!r)return o||r&&n&Ne||a&&n&He?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var at=1,st=2,lt=4,ct=8,dt=ct,ut=16,pt=32;Y.prototype={defaults:{},set:function(e){return se(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(r(e,"recognizeWith",this))return this;var t=this.simultaneous;return e=q(e,this),t[e.id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return r(e,"dropRecognizeWith",this)?this:(e=q(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(r(e,"requireFailure",this))return this;var t=this.requireFail;return e=q(e,this),-1===S(t,e)&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(r(e,"dropRequireFailure",this))return this;e=q(e,this);var t=S(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){n.manager.emit(t,e)}var n=this,i=this.state;ct>i&&t(n.options.event+_(i)),t(n.options.event),e.additionalEvent&&t(e.additionalEvent),i>=ct&&t(n.options.event+_(i))},tryEmit:function(e){return this.canEmit()?this.emit(e):void(this.state=pt)},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(pt|at)))return!1;e++}return!0},recognize:function(e){var t=se({},e);return d(this.options.enable,[this,t])?(this.state&(dt|ut|pt)&&(this.state=at),this.state=this.process(t),void(this.state&(st|lt|ct|ut)&&this.tryEmit(t))):(this.reset(),void(this.state=pt))},process:function(e){},getTouchAction:function(){},reset:function(){}},l(G,Y,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,i=t&(st|lt),o=this.attrTest(e);return i&&(n&Te||!o)?t|ut:i||o?n&we?t|ct:t&st?t|lt:st:pt}}),l(Q,G,{defaults:{event:"pan",threshold:10,pointers:1,direction:De},getTouchAction:function(){var e=this.options.direction,t=[];return e&Ne&&t.push(rt),e&He&&t.push(ot),t},directionTest:function(e){var t=this.options,n=!0,i=e.distance,o=e.direction,r=e.deltaX,a=e.deltaY;return o&t.direction||(t.direction&Ne?(o=0===r?Re:0>r?Ae:Oe,n=r!=this.pX,i=Math.abs(e.deltaX)):(o=0===a?Re:0>a?xe:ke,n=a!=this.pY,i=Math.abs(e.deltaY))),e.direction=o,n&&i>t.threshold&&o&t.direction},attrTest:function(e){return G.prototype.attrTest.call(this,e)&&(this.state&st||!(this.state&st)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=$(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),l(K,G,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[it]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&st)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),l(J,Y,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[tt]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime>t.time;if(this._input=e,!i||!n||e.eventType&(we|Te)&&!r)this.reset();else if(e.eventType&Pe)this.reset(),this._timer=o(function(){this.state=dt,this.tryEmit()},t.time,this);else if(e.eventType&we)return dt;return pt},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===dt&&(e&&e.eventType&we?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=he(),this.manager.emit(this.options.event,this._input)))}}),l(ee,G,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[it]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&st)}}),l(te,G,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ne|He,pointers:1},getTouchAction:function(){return Q.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return n&(Ne|He)?t=e.overallVelocity:n&Ne?t=e.overallVelocityX:n&He&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&pe(t)>this.options.velocity&&e.eventType&we},emit:function(e){var t=$(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),l(ne,Y,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[nt]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime<t.time;if(this.reset(),e.eventType&Pe&&0===this.count)return this.failTimeout();if(i&&r&&n){if(e.eventType!=we)return this.failTimeout();var a=this.pTime?e.timeStamp-this.pTime<t.interval:!0,s=!this.pCenter||x(this.pCenter,e.center)<t.posThreshold;this.pTime=e.timeStamp,this.pCenter=e.center,s&&a?this.count+=1:this.count=1,this._input=e;var l=this.count%t.taps;if(0===l)return this.hasRequireFailures()?(this._timer=o(function(){this.state=dt,this.tryEmit()},t.interval,this),st):dt}return pt},failTimeout:function(){return this._timer=o(function(){this.state=pt},this.options.interval,this),pt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==dt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ie.VERSION="2.0.6",ie.defaults={domEvents:!1,touchAction:et,enable:!0,inputTarget:null,inputClass:null,preset:[[ee,{enable:!1}],[K,{enable:!1},["rotate"]],[te,{direction:Ne}],[Q,{direction:Ne},["swipe"]],[ne],[ne,{event:"doubletap",taps:2},["tap"]],[J]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ht=1,gt=2;oe.prototype={set:function(e){return se(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?gt:ht},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var n,i=this.recognizers,o=t.curRecognizer;(!o||o&&o.state&dt)&&(o=t.curRecognizer=null);for(var r=0;r<i.length;)n=i[r],t.stopped===gt||o&&n!=o&&!n.canRecognizeWith(o)?n.reset():n.recognize(e),!o&&n.state&(st|lt|ct)&&(o=t.curRecognizer=n),r++}},get:function(e){if(e instanceof Y)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(r(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(r(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=S(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){var n=this.handlers;return a(m(e),function(e){n[e]=n[e]||[],n[e].push(t)}),this},off:function(e,t){var n=this.handlers;return a(m(e),function(e){t?n[e]&&n[e].splice(S(n[e],t),1):delete n[e]}),this},emit:function(e,t){this.options.domEvents&&ae(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](t),i++}},destroy:function(){this.element&&re(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},se(ie,{INPUT_START:Pe,INPUT_MOVE:Be,INPUT_END:we,INPUT_CANCEL:Te,STATE_POSSIBLE:at,STATE_BEGAN:st,STATE_CHANGED:lt,STATE_ENDED:ct,STATE_RECOGNIZED:dt,STATE_CANCELLED:ut,STATE_FAILED:pt,DIRECTION_NONE:Re,DIRECTION_LEFT:Ae,DIRECTION_RIGHT:Oe,DIRECTION_UP:xe,DIRECTION_DOWN:ke,DIRECTION_HORIZONTAL:Ne,DIRECTION_VERTICAL:He,DIRECTION_ALL:De,Manager:oe,Input:E,TouchAction:Z,TouchInput:W,MouseInput:D,PointerEventInput:F,TouchMouseInput:V,SingleTouchInput:z,Recognizer:Y,AttrRecognizer:G,Tap:ne,Pan:Q,Swipe:te,Pinch:K,Rotate:ee,Press:J,on:p,off:h,each:a,merge:fe,extend:ge,assign:se,inherit:l,bindFn:c,prefixed:L});var ft="undefined"!=typeof e?e:"undefined"!=typeof self?self:{};ft.Hammer=ie,"function"==typeof define&&define.amd?define(function(){return ie}):"undefined"!=typeof module&&module.exports?module.exports=ie:e[n]=ie}(window,document,"Hammer"),function(e,t){"function"==typeof define?define(t):"undefined"!=typeof module?module.exports=t:this[e]=t}("easing",{easeInQuad:function(e){return Math.pow(e,2)},easeOutQuad:function(e){return-(Math.pow(e-1,2)-1)},easeInOutQuad:function(e){return(e/=.5)<1?.5*Math.pow(e,2):-.5*((e-=2)*e-2)},easeInCubic:function(e){return Math.pow(e,3)},easeOutCubic:function(e){return Math.pow(e-1,3)+1},easeInOutCubic:function(e){return(e/=.5)<1?.5*Math.pow(e,3):.5*(Math.pow(e-2,3)+2)},easeInQuart:function(e){return Math.pow(e,4)},easeOutQuart:function(e){return-(Math.pow(e-1,4)-1)},easeInOutQuart:function(e){return(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2)},easeInQuint:function(e){return Math.pow(e,5)},easeOutQuint:function(e){return Math.pow(e-1,5)+1},easeInOutQuint:function(e){return(e/=.5)<1?.5*Math.pow(e,5):.5*(Math.pow(e-2,5)+2)},easeInSine:function(e){return-Math.cos(e*(Math.PI/2))+1},easeOutSine:function(e){return Math.sin(e*(Math.PI/2))},easeInOutSine:function(e){return-.5*(Math.cos(Math.PI*e)-1)},easeInExpo:function(e){return 0===e?0:Math.pow(2,10*(e-1))},easeOutExpo:function(e){return 1===e?1:-Math.pow(2,-10*e)+1},easeInOutExpo:function(e){return 0===e?0:1===e?1:(e/=.5)<1?.5*Math.pow(2,10*(e-1)):.5*(-Math.pow(2,-10*--e)+2)},easeInCirc:function(e){return-(Math.sqrt(1-e*e)-1)},easeOutCirc:function(e){return Math.sqrt(1-Math.pow(e-1,2))},easeInOutCirc:function(e){return(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},easeOutBounce:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},easeInBack:function(e){var t=1.70158;return e*e*((t+1)*e-t)},easeOutBack:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},easeInOutBack:function(e){var t=1.70158;return(e/=.5)<1?.5*e*e*(((t*=1.525)+1)*e-t):.5*((e-=2)*e*(((t*=1.525)+1)*e+t)+2)},elastic:function(e){return-1*Math.pow(4,-8*e)*Math.sin(2*(6*e-1)*Math.PI/2)+1},swingFromTo:function(e){var t=1.70158;return(e/=.5)<1?.5*e*e*(((t*=1.525)+1)*e-t):.5*((e-=2)*e*(((t*=1.525)+1)*e+t)+2)},swingFrom:function(e){var t=1.70158;return e*e*((t+1)*e-t)},swingTo:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},bounce:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},bouncePast:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?2-(7.5625*(e-=1.5/2.75)*e+.75):2.5/2.75>e?2-(7.5625*(e-=2.25/2.75)*e+.9375):2-(7.5625*(e-=2.625/2.75)*e+.984375)},easeFromTo:function(e){return(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2)},easeFrom:function(e){return Math.pow(e,4)},easeTo:function(e){return Math.pow(e,.25)}}),/*!
 *
 * # sML JavaScript Library
 *
 * - "I'm a Simple and Middling Library."
 * - Copyright (c) Satoru MATSUSHIMA - https://github.com/satorumurmur/sML
 * - Licensed under the MIT license. - http://www.opensource.org/licenses/mit-license.php
 *
 */
sML=function(){var Version="0.999.27",Build=20160310.0031,sML=function(e){var t="string"==typeof e?[sML.create.apply(this,arguments)]:e.length?e:[e];if(window.__proto__)t.__proto__=sML.SML;else for(var n in sML.SML)t[n]=sML.SML[n];return t};sML.Version=Version,sML.Build=Build;var nUA=navigator.userAgent,getVersion=function(e){var t=parseFloat(nUA.replace(new RegExp("^.*"+e+"[ :\\/]?(\\d+([\\._]\\d+)?).*$"),"$1").replace(/_/g,"."));return isNaN(t)?void 0:t};return sML.OperatingSystem=sML.OS=function(e){return/iPhone OS \d/.test(nUA)?e.iOS=getVersion("iPhone OS"):/OS X 10[\._]\d/.test(nUA)?e.OSX=getVersion("OS X 10[\\._]"):/Windows Phone( OS)? \d/.test(nUA)?e.WindowsPhone=getVersion("Windows Phone OS")||getVersion("Windows Phone"):/Windows( NT)? \d/.test(nUA)?e.Windows=getVersion("Windows NT")||getVersion("Windows"):/Android \d/.test(nUA)?e.Android=getVersion("Android"):/CrOS/.test(nUA)?e.Chrome=!0:/X11;/.test(nUA)?e.Linux=!0:/Firefox/.test(nUA)&&(e.Firefox=!0),e}({}),sML.UserAgent=sML.UA=function(e){/Gecko\/\d/.test(nUA)?(e.Gecko=getVersion("rv"),/Firefox\/\d/.test(nUA)&&(e.Firefox=getVersion("Firefox"))):/Edge\/\d/.test(nUA)?e.Edge=getVersion("Edge"):/Chrome\/\d/.test(nUA)?(e.Blink=getVersion("Chrome")||!0,/OPR\/\d/.test(nUA)?e.Opera=getVersion("OPR"):/Silk\/\d/.test(nUA)?e.Silk=getVersion("Silk"):e.Chrome=e.Blink):/AppleWebKit\/\d/.test(nUA)?(e.WebKit=getVersion("AppleWebKit"),/CriOS \d/.test(nUA)?e.Chrome=getVersion("CriOS"):/FxiOS \d/.test(nUA)?e.Firefox=getVersion("FxiOS"):/Version\/\d/.test(nUA)&&(e.Safari=getVersion("Version"))):/Trident\/\d/.test(nUA)&&(e.Trident=getVersion("Trident"),e.InternetExplorer=getVersion("rv")||getVersion("MSIE"));try{e.Flash=parseFloat(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin.description.replace(/^.+?([\d\.]+).*$/,"$1"))}catch(t){}return e}({}),sML.Environments=sML.Env=function(e){return["OS","UA"].forEach(function(t){for(var n in sML[t])"Flash"!=n&&sML[t][n]&&e.push(n)}),e}([]),sML.log=function(){try{console.log.apply(console,arguments)}catch(e){}},sML.write=function(){document.open();for(var e=0,t=arguments.length;t>e;e++)document.write(arguments[e]);document.close()},sML.Fill={Prefixes:["webkit","moz","MS","ms","o"],carePrefix:function(e,t){if(t in e)return e[t];t=t[0].toUpperCase()+t.slice(1);for(var n="",i=0,o=this.Prefixes.length;o>i;i++)if(n=this.Prefixes[i]+t,n in e)return e[n]}},sML.UA.InternetExplorer<=9&&("undefined"==typeof window.console&&(window.console={}),"function"!=typeof window.console.log&&(window.console.log=function(){})),window.requestAnimationFrame=sML.Fill.carePrefix(window,"requestAnimationFrame")||function(e){setTimeout(e,1e3/60)},(!window.CustomEvent||"function"!=typeof window.CustomEvent&&-1===window.CustomEvent.toString().indexOf("CustomEventConstructor"))&&(window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n},window.CustomEvent.prototype=window.Event.prototype),sML.Event={add:function(e,t){for(var n in t)e.addEventListener(n,t[n],!1);return e},remove:function(e,t){for(var n in t)e.removeEventListener(n,t[n]);return e},observeTouch:function(e,t){/*! Requires Hammer.js - http://hammerjs.github.io/ - Copyright (c) Jorik Tangelder - Licensed under the MIT license. */
if(e.TouchEventObserver)return e;if(!window.Hammer)return sML.edit(e,{addTouchEventListener:function(){return!1},removeTouchEventListener:function(){return!1}});var n=new Hammer.Manager(e);return(!t||t.Pan)&&n.add(new Hammer.Pan({threshold:0,pointers:0})),(!t||t.Swipe)&&n.add(new Hammer.Swipe).recognizeWith(n.get("pan")),(!t||t.Rotate)&&n.add(new Hammer.Rotate({threshold:0})).recognizeWith(n.get("pan")),(!t||t.Pinch)&&n.add(new Hammer.Pinch({threshold:0})).recognizeWith([n.get("pan"),n.get("rotate")]),(!t||t.DoubleTap)&&n.add(new Hammer.Tap({event:"doubletap",taps:2})),(!t||t.Tap)&&n.add(new Hammer.Tap),sML.edit(e,{TouchEventObserver:n,TouchEventHandlers:[],addTouchEventListener:function(t,n){var i=function(t){n.apply(e,[t.srcEvent,t])};return e.TouchEventHandlers.push([n,i]),e.TouchEventObserver.on(t,i),e},removeTouchEventListener:function(t,n){if(n&&"function"==typeof n){for(var i=[],o=0,r=e.TouchEventHandlers.length;r>o;o++)e.TouchEventHandlers[o][0]==n?e.TouchEventObserver.off(t,e.TouchEventHandlers[o][1]):i.push(e.TouchEventHandlers[o]);e.TouchEventHandlers=i}else e.TouchEventObserver.off(t);return e}})},unobserveTouch:function(e){/*! Requires Hammer.js - http://hammerjs.github.io/ - Copyright (c) Jorik Tangelder - Licensed under the MIT license. */
/*! Requires Hammer.js - http://hammerjs.github.io/ - Copyright (c) Jorik Tangelder - Licensed under the MIT license. */
return e.TouchEventObserver?(e.TouchEventObserver.destroy(),delete e.TouchEventObserver,delete e.TouchEventHandlers,delete e.addTouchEventListener,delete e.removeTouchEventListener,e):e},OnResizeFont:{RegularFunctions:[],onZoomInFunctions:[],onZoomOutFunctions:[],addEventListener:function(e,t){t&&t>0?this.onZoomInFunctions.push(e):t&&0>t?this.onZoomOutFunctions.push(e):this.RegularFunctions.push(e)},detect:function(e,t){if(!e)var e=document.body;if(!t)var t=200;this.checker=e,this.timer=setInterval(function(){var e=sML.Coord.getElementSize(sML.onResizeFont.checker).h;if(sML.onResizeFont.prevHeight&&sML.onResizeFont.prevHeight!=e){var t=sML.onResizeFont.RegularFunctions;sML.onResizeFont.prevHeight&&sML.onResizeFont.prevHeight<e?t=t.concat(sML.onResizeFont.onZoomInFunctions):sML.onResizeFont.prevHeight&&sML.onResizeFont.prevHeight>e&&(t=t.concat(sML.onResizeFont.onZoomOutFunctions));for(var n=0,i=t.length;i>n;n++)t[n]()}sML.onResizeFont.prevHeight=e},t)},stopDetect:function(){this.timer&&clearTimeout(this.timer)}}},sML.addEventListener=sML.Event.add,sML.removeEventListener=sML.Event.remove,sML.observeTouch=sML.Event.observeTouch,sML.unobserveTouch=sML.Event.unobserveTouch,sML.Timers={setTimeout:function(){var e=Array.prototype.shift.call(arguments),t=Array.prototype.shift.call(arguments);return Array.prototype.unshift.call(arguments,e),Array.prototype.unshift.call(arguments,t),setTimeout.apply(window,arguments)},setInterval:function(){var e=Array.prototype.shift.call(arguments),t=Array.prototype.shift.call(arguments);return Array.prototype.unshift.call(arguments,e),Array.prototype.unshift.call(arguments,t),setInterval.apply(window,arguments)}},sML.setTimeout=sML.Timers.setTimeout,sML.setInterval=sML.Timers.setInterval,sML.Drawer={draw:function(e,t){e.ToBeDrawn||(requestAnimationFrame(function(){t.apply(e,arguments),e.ToBeDrawn=!1}),e.ToBeDrawn=!0)}},sML.draw=sML.Drawer.draw,sML.set=sML.edit=function(e,t,n){for(var i in t)"on"!=i&&"extraHTML"!=i&&(/^data-/.test(i)?e.setAttribute(i,t[i]):e[i]=t[i]);return t.extraHTML&&(e.innerHTML=e.innerHTML+t.extraHTML),t.on&&sML.Event.add(e,t.on),n&&sML.CSS.set(e,n),e},sML.create=function(e,t,n){return sML.set(document.createElement(e),t,n)},sML.changeClass=sML.changeClassName=function(e,t){return t?e.className=t:e.removeAttribute("class"),e.className},sML.addClass=sML.addClassName=function(e,t){if("string"!=typeof t)return e.className;if(t=t.trim().replace(/ +/g," "),!t)return e.className;if(e.className){if((" "+e.className+" ").indexOf(" "+t+" ")>-1)return e.className;t=e.className+" "+t}return sML.changeClass(e,t)},sML.removeClass=sML.removeClassName=function(e,t){return e.className?"string"!=typeof t?e.className:(t=t.trim().replace(/ +/g," "))?(" "+e.className+" ").indexOf(" "+t+" ")<0?e.className:(t=(" "+e.className+" ").replace(" "+t+" "," ").trim().replace(/ +/g," "),sML.changeClass(e,t)):e.className:""},sML.replaceClass=sML.replaceClassName=function(e,t,n){return sML.removeClass(e,t),sML.addClass(e,n)},sML.appendChildren=function(e,t){t.length||(t=[t]);for(var n=0,i=t.length;i>n;n++)e.appendChild(t[n]);return t},sML.deleteElement=function(e){e.parentNode&&e.parentNode.removeChild(e),e.innerHTML="",e=null,delete e},sML.hatch=function(){for(var e="",t=0,n=arguments.length;n>t;t++)e+=arguments[t];var i=document.createElement("div"),o=document.createDocumentFragment();i.innerHTML=e;for(var t=0,n=i.childNodes.length;n>t;t++)o.appendChild(i.firstChild);return o},sML.cloneObject=function(e){var t=function(){};return t.prototype=e,new t},sML.CSS={Prefix:sML.UA.WebKit||sML.UA.Blink?"Webkit":sML.UA.Gecko?"Moz":sML.UA.Trident?"ms":"",TransitionEnd:sML.UA.WebKit||sML.UA.Blink?"webkitTransitionEnd":sML.UA.Gecko?"transitionend":sML.UA.Trident?"MSTransitionEnd":"",AnimationEnd:sML.UA.WebKit||sML.UA.Blink?"webkitAnimationEnd":sML.UA.Gecko?"animationend":sML.UA.Trident?"MSAnimationEnd":"",Catalogue:[],getSFO:function(e){for(var t=0,n=this.Catalogue.length;n>t;t++)if(this.Catalogue[t].Element==e)return this.Catalogue[t];return this.Catalogue[this.Catalogue.push({Element:e})-1]},getComputedStyle:function(e,t){var n=e.currentStyle||document.defaultView.getComputedStyle(e,t?t:"");return n},StyleSheets:[],getStyleSheet:function(e){for(var t=0,n=this.StyleSheets.length;n>t;t++)if(this.StyleSheets[t].StyleFor==e)return this.StyleSheets[t].StyleSheet;var i=e.createElement("style");return i.appendChild(e.createTextNode("")),e.getElementsByTagName("head")[0].appendChild(i),this.StyleSheets.push({StyleFor:e,StyleSheet:i.sheet}),i.sheet},appendRule:function(e,t,n){if("function"==typeof t.join)t=t.join(" ");else if("object"==typeof t){var i=[];for(var o in t)i.push(o.trim()+": "+t[o].replace(/;?\s*$/,"").trim()+";");t=i.join(" ")}var r=this.getStyleSheet(n?n:document);return r?r.insertRule(e+"{"+t+"}",r.cssRules.length):null},deleteRule:function(e,t){var n=this.getStyleSheet(t?t:document);return n?n.deleteRule(e):void 0},setProperty:function(e,t,n){return e&&t?(/^(animation|background(-s|S)ize|box|break|column|filter|flow|hyphens|region|shape|transform|transition|writing)/.test(t)?e.style[this.Prefix+t.replace(/(-|^)([a-z])/g,function(e,t,n){return n?n.toUpperCase():""})]=n:"float"==t&&(t="cssFloat"),e.style[t]=n,e):e},addTransitionEndListener:function(e,t){"function"==typeof t&&(e.sMLTransitionEndListener=t,e.addEventListener(this.TransitionEnd,e.sMLTransitionEndListener))},removeTransitionEndListener:function(e){"function"==typeof e.sMLTransitionEndListener&&(e.removeEventListener(this.TransitionEnd,e.sMLTransitionEndListener),delete e.sMLTransitionEndListener)},set:function(e,t,n){if(!e||"object"!=typeof t)return e;if(this.removeTransitionEndListener(e),"function"==typeof n&&(this.removeTransitionEndListener(e),this.addTransitionEndListener(e,n)),t instanceof Array)t.forEach(function(t){t=t.split(":");var n=t.shift().trim(),i=t.join("").replace(/;\s*$/,"").trim();this.setProperty(e,n,i)});else{for(var i in t)/^transition/.test(i)&&(this.setProperty(e,i,t[i]),delete t[i]);for(var i in t)this.setProperty(e,i,t[i])}return e},getRGB:function(e){for(var t=e.replace(/rgb\(([\d\., ]+)\)/,"$1").replace(/\s/g,"").split(","),n=0,i=t.length;i>n;n++)t[n]=parseInt(t[n]);return t},getRGBA:function(e){for(var t=e.replace(/rgba?\(([\d\., ]+)\)/,"$1").replace(/\s/g,"").split(","),n=0,i=t.length;i>n;n++)t[n]=parseInt(t[n]);return t[3]||(t[3]=1),t}},sML.style=sML.css=function(e,t,n){return sML.CSS.set(e,t,n)},sML.appendStyleRule=sML.appendCSSRule=function(e,t,n){return sML.CSS.appendRule(e,t,n)},sML.deleteStyleRule=sML.deleteCSSRule=function(e,t){return sML.CSS.deleteRule(e,t)},sML.Easing="object"==typeof window.easing?window.easing:{},sML.Easing.linear=function(e){return e},sML.Easing.getEaser=function(e){return function(t){return t+e/100*(1-t)*t}},sML.Transition={set:function(e,t){return t||(t={}),e.sMLTransition&&clearTimeout(e.sMLTransition.Timer),e.sMLTransition={Element:e,CurrentFrame:0,Frames:t.Frames?t.Frams:10,TimePerFrame:t.TimePerFrame?t.TimePerFrame:10,Easing:t.Easing?t.Easing:void 0,EasingX:t.EasingX?t.EasingX:void 0,before:"function"==typeof t.before?t.before:void 0,among:"function"==typeof t.among?t.among:void 0,after:"function"==typeof t.after?t.after:void 0,callback:"function"==typeof t.callback?t.callback:void 0,getNext:function(e,t,n,i){var o=1,r=this.CurrentFrame/this.Frames;if(!n&&this.Easing)var n=this.Easing;if(!i&&this.EasingX)var i=this.EasingX;return o=n?0==i?r+n/(100*Math.PI)*Math.sin(Math.PI*r):i?(100+i*n)*r/(2*i*n*r+100-i*n):r+n/100*(1-r)*r:r,e+(t-e)*o},getNextColor:function(e,t,n,i){3==e.length&&4==t.length?e[3]=1:4==e.length&&3==t.length&&(t[3]=1);for(var o=[],r=0,a=e.length;a>r;r++)o[r]=Math.round(this.getNext(e[r],t[r]));return o},begin:function(){this.before&&this.before.call(e,e.sMLTransition),function(){this.CurrentFrame++!=this.Frames?(this.among&&this.among.call(e,e.sMLTransition),this.Timer=setTimeout(arguments.callee,this.TimePerFrame)):(this.after&&this.after.call(e,e.sMLTransition),this.callback&&this.callback.call(e,e.sMLTransition))}()}},e.sMLTransition}},sML.transition=function(e,t){sML.Transition.set(e,t).begin()},sML.Coord={getXY:function(e,t){return{X:e,x:e,Y:t,y:t}},getWH:function(e,t){return{Width:e,width:e,W:e,w:e,Height:t,height:t,H:t,h:t}},getXYTRBLCMWH:function(e,t,n,i,o,r,a,s,l,c){return{X:e,x:e,Y:t,y:t,Top:n,top:n,T:n,t:n,Right:i,right:i,R:i,r:i,Bottom:o,bottom:o,B:o,b:o,Left:r,left:r,L:r,l:r,Center:a,center:a,C:a,c:a,Middle:s,middle:s,M:s,m:s,Width:l,width:l,W:l,w:l,Height:c,height:c,H:c,h:c}},getScreenSize:function(){return this.getWH(screen.availWidth,screen.availHeight)},getScrollSize:function(e){return e&&e!=window&&e!=document||(e=document.documentElement),this.getWH(e.scrollWidth,e.scrollHeight)},getOffsetSize:function(e){return e&&e!=window||(e=document.documentElement),e==document?this.getScrollSize(document.documentElement):this.getWH(e.offsetWidth,e.offsetHeight)},getClientSize:function(e){return e&&e!=window||(e=document.documentElement),e==document?this.getScrollSize(document.documentElement):this.getWH(e.clientWidth,e.clientHeight)},getDocumentSize:function(){return this.getScrollSize(document.documentElement)},getWindowSize:function(){return this.getOffsetSize(document.documentElement)},getElementSize:function(e){return this.getOffsetSize(e)},getWindowCoord:function(e){return this.getXY(window.screenLeft||window.screenX,window.screenTop||window.screenY)},getElementCoord:function(e,t){var n=t&&t.RtL,i=e.offsetLeft,o=e.offsetTop;for(n&&(i=i+e.offsetWidth-this.getOffsetSize(document.documentElement).W);e.offsetParent;)e=e.offsetParent,i+=e.offsetLeft,o+=e.offsetTop;return this.getXY(i,o)},getScrollCoord:function(e){return e&&e!=window?this.getXY(e.scrollLeft,e.scrollTop):this.getXY(window.scrollX||window.pageXOffset||document.documentElement.scrollLeft,window.scrollY||window.pageYOffset||document.documentElement.scrollTop)},getScrollLimitCoord:function(e,t){var n=t&&t.RtL;e&&e!=window||(e=document.documentElement);var i=this.getScrollSize(e),o=this.getClientSize(e);return this.getXY((i.W-o.W)*(n?-1:1),i.H-o.H)},getEventCoord:function(e){return e?this.getXY(e.pageX,e.pageY):this.getXY(0,0)},getCoord:function(e,t){if(t&&t.RtL)return this.getCoord_RtL(e);if(e==screen)var n=this.getScreenSize(),i={X:0,Y:0},o={X:n.W,Y:n.H};else if(e==window)var n=this.getOffsetSize(document.documentElement),i=this.getScrollCoord(),o={X:i.X+n.W,Y:i.Y+n.H};else if(e==document)var n=this.getScrollSize(document.documentElement),i={X:0,Y:0},o={X:n.W,Y:n.H};else{if(!e.tagName)return{};var n=this.getOffsetSize(e),i=this.getElementCoord(e),o={X:i.X+n.W,Y:i.Y+n.H}}return this.getXYTRBLCMWH(i.X,i.Y,i.Y,o.X,o.Y,i.X,Math.round((i.X+o.X)/2),Math.round((i.Y+o.Y)/2),n.W,n.H)},getCoord_RtL:function(e){if(e==screen)var t=this.getScreenSize(),n={X:t.W,Y:0},i={X:0,Y:t.H};else if(e==window)var t=this.getOffsetSize(document.documentElement),n=this.getScrollCoord(),i={X:n.X-t.W,Y:n.Y+t.H};else if(e==document)var t=this.getScrollSize(document.documentElement),n={X:0,Y:0},i={X:t.W,Y:t.H};else{if(!e.tagName)return{};var t=this.getElementSize(e),n=this.getElementCoord(e,1),i={X:n.X-t.W,Y:n.Y+t.H}}return this.getXYTRBLCMWH(n.X,n.Y,n.Y,n.X,i.Y,i.X,Math.round((i.X+n.X)/2),Math.round((n.Y+i.Y)/2),t.W,t.H)}},sML.getCoord=function(){return sML.Coord.getCoord.apply(sML.Coord,arguments)},sML.Scroller={scrollTo:function(e,t,n,i){var o=sML.Coord.getScrollCoord(e);sML.Coord.getScrollLimitCoord(e);if("number"==typeof t)t={X:o.X,Y:t};else if("object"!=typeof t||!t)return;"number"!=typeof t.X&&(t.X=o.X),"number"!=typeof t.Y&&(t.Y=o.Y),n||(n={}),("number"!=typeof n.Duration||n.Duration<0)&&(n.Duration=100);var r=sML.Easing.linear;if("function"==typeof n.Easing)var r=n.Easing;else if("string"==typeof n.Easing)var r=sML.Easing[n.Easing]?sML.Easing[n.Easing]:sML.Easing.linear;else if("number"==typeof n.Easing)var r=sML.Easing.getEaser(n.Easing);"function"==typeof i&&(n.callback=i),sML.Scroller.Timer&&clearTimeout(sML.Scroller.Timer),n.ForceScroll?sML.Scroller.preventUserScrolling():sML.Scroller.addScrollCancelation(),"function"==typeof n.before&&n.before();var a=e==window?window.scrollTo:function(t,n){e.scrollLeft=t,e.scrollTop=n};!function(e,t,n){var i=n.Duration?((new Date).getTime()-e.Time)/n.Duration:1;if(1>i){var o=r(i);a(Math.round(e.X+(t.X-e.X)*o),Math.round(e.Y+(t.Y-e.Y)*o)),"function"==typeof n.among&&n.among();var s=arguments.callee;sML.Scroller.Timer=setTimeout(function(){s(e,t,n)},10)}else a(t.X,t.Y),"function"==typeof n.after&&n.after(),"function"==typeof n.callback&&n.callback(),n.ForceScroll&&sML.Scroller.allowUserScrolling()}({X:o.X,Y:o.Y,Time:(new Date).getTime()},t,n)},addScrollCancelation:function(){document.addEventListener("mousedown",sML.Scroller.cancelScrolling),document.addEventListener("keydown",sML.Scroller.cancelScrolling),document.addEventListener("mousewheel",sML.Scroller.cancelScrolling),document.addEventListener("DOMMouseScroll",sML.Scroller.cancelScrolling)},cancelScrolling:function(){document.removeEventListener("mousedown",sML.Scroller.cancelScrolling),document.removeEventListener("keydown",sML.Scroller.cancelScrolling),document.removeEventListener("mousewheel",sML.Scroller.cancelScrolling),document.removeEventListener("DOMMouseScroll",sML.Scroller.cancelScrolling)},preventUserScrolling:function(){document.addEventListener("mousedown",sML.preventDefault),document.addEventListener("keydown",sML.preventDefault),document.addEventListener("mousewheel",sML.preventDefault),document.addEventListener("DOMMouseScroll",sML.preventDefault)},allowUserScrolling:function(){document.removeEventListener("mousedown",sML.preventDefault),document.removeEventListener("keydown",sML.preventDefault),document.removeEventListener("mousewheel",sML.preventDefault),document.removeEventListener("DOMMouseScroll",sML.preventDefault)}},sML.scrollTo=sML.Scroller.scrollTo,sML.Ajax={open:function(e){if(!e||"string"!=typeof e.URI||"function"!=typeof e.onsuccess)return!1;var t=new XMLHttpRequest;e.Query||(e.Query=null),e.Auth||(e.Auth=["",""]),e.MimeType||(e.MimeType=null),e.onsuccess||(e.onsuccess=function(){}),e.onfailed||(e.onfailed=function(){sML.each(arguments,function(){sML.log(this+"")})}),e.ontimeout||(e.ontimeout=e.onfailed),e.Async!==!1&&(e.Async=!0),e.Method=e.Method&&/^POST$/i.test(e.Method)?"POST":"GET";var n="";if(e.Query)for(var i in e.Query)n+="&"+i+"="+encodeURIComponent(e.Query[i]);return n&&("GET"==e.method?(e.URI=e.URI+(e.URI.indexOf("?")>0?n:n.replace(/^&/,"?")),n=null):"POST"==e.Method&&(n=n.replace(/^&/,""))),t.sMLAjaxTimeout=0,t.sMLAjaxTimeoutTimer=setTimeout(function(){t.sMLAjaxTimeout=1,e.ontimeout("sML.AJAX.get Timeout: "+e.URI)},1e4),e.onstate4=function(n,i){t.sMLAjaxTimeout||(clearTimeout(t.sMLAjaxTimeoutTimer),200==t.status||0==t.status?e.onsuccess(n,i):e.onfailed("sML.AJAX.get Failed: ("+t.status+") "+URL),delete t)},t.onreadystatechange=function(){switch(this.readyState){case 4:return e.onstate4.call(this,this.responseText,this.responseXML)}},e.MimeType&&t.overrideMimeType(e.MimeType),t.open(e.Method,e.URI,e.Async,e.Auth[0],e.Auth[1]),"POST"==e.Method&&t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n),t}},sML.ajax=sML.Ajax.open,sML.Location={RE:new RegExp("^((([a-z]+)://([^/\\?#]+))(/[^\\?#]*))(\\?[^\\?#]*)?(#[^#]*)?$"),getFile:function(e){return(e?e:location.href).replace(this.RE,"$1")},getOrigin:function(e){return(e?e:location.href).replace(this.RE,"$2")},getProtocol:function(e){return(e?e:location.href).replace(this.RE,"$3")},getHost:function(e){return(e?e:location.href).replace(this.RE,"$4")},getPathname:function(e){return(e?e:location.href).replace(this.RE,"$5")},getSearch:function(e){return(e?e:location.href).replace(this.RE,"$6")},getHash:function(e){return(e?e:location.href).replace(this.RE,"$7")},getDirectory:function(e){return this.getFile(e).replace(/\/[^\/]*$/,"")},getId:function(e){return this.getHash(e).replace("#","")},getQueries:function(e){var t=(e?e:location.href).split("?");if(2!=t.length)return{};for(var n={},i=t[1].replace(/#.*$/,"").split("&"),o=0,r=i.length;r>o;o++)if(i[o]){var a=i[o].split("=");a.length<2?a[1]=null:a.length>2&&(a[1]=i[o].replace(a[0]+"=","")),n[a[0]]=a[1]}return n},isIndexFile:function(e){return/index\.(x?html?|php|cgi|[ja]spx?)$/.test(this.getPathname(e))},isSameFile:function(e,t){return this.getFile(e)==(t?this.getOrigin(t):location.protocol+"//"+location.host+location.pathname)},isSameOrigin:function(e,t){return this.getOrigin(e)==(t?this.getOrigin(t):location.protocol+"//"+location.host)},isSameProtocol:function(e,t){return this.getProtocol(e)==(t?this.getProtocol(t):location.protocol)},isSameHost:function(e,t){return this.getHost(e)==(t?this.getHost(t):location.host)},isSameHash:function(e,t){return this.getHash(e)==(t?this.getHash(t):location.hash)},isSameDirectory:function(e,t){return this.getDirectory(e)==(t?this.getDirectory(t):(location.protocol+"//"+location.host+location.pathname).replace(/\/[^\/]*$/,""))},isSameId:function(e,t){return this.getId(e)==(t?this.getId(t):location.hash.replace("#",""))}},sML.getQueries=sML.Location.getQueries,sML.Cookies=sML.cookies={put:function(e,t,n){if(!n)var n=1;var i=new Date;return document.cookie=e+"="+t+"; path=/; expires="+i.toGMTString(i.setTime(i.getTime()+864e5*n)),document.cookie},del:function(e){var t=new Date;return document.cookie=e+"=%00; path=/; expires="+t.toGMTString(t.setTime(t.getTime()-864e5)),document.cookie},get:function(e){for(var t=document.cookie.split("; "),n="",i=0,o=t.length;o>i;i++)if(t[i].substr(0,e.length+1)==e+"="){n=t[i].substr(e.length+1,t[i].length);break}return n}},sML.CookieMonster={Cookies:{},set:function(e,t,n){return this.Cookies[e]||(this.Cookies[e]=this.get(e)),null==n?"undefined"!=typeof this.Cookies[e][t]&&delete this.Cookies[e][t]:this.Cookies[e][t]=n,this.Cookies[e]},put:function(e,t){if(!sML.getLength(this.Cookies[e]))return sML.Cookies.del(e),this.del(e);var n="";for(var i in this.Cookies[e])n+='"'+i+'":"'+this.Cookies[e][i]+'",';return n=encodeURIComponent("{"+n.replace(/\,$/,"")+"}"),sML.Cookies.put(e,n,t),this.Cookies},del:function(e){return this.Cookies[e]&&(sML.Cookies.del(e),delete this.Cookies[e]),this.Cookies},get:function(N,K){if(!this.Cookies[N]){var V="";try{V=eval("("+decodeURIComponent(sML.Cookies.get(N))+")")}catch(e){}this.Cookies[N]="object"==typeof V?V:{}}return K?"undefined"==typeof this.Cookies[N][K]?"":this.Cookies[N][K]:this.Cookies[N]}},sML.each=function(e,t,n,i){for(var o=n?n:0,r=i?i+1:e.length;r>o&&t.call(e[o],o,e)!==!1;o++);return e},sML.Math={sum:function(){for(var e=0,t=0,n=arguments.length;n>t;t++){var i=0;"number"==typeof arguments[t]?i=arguments[t]:"string"==typeof arguments[t]&&(i=arguments[t].length),e+=i}return e},random:function(e,t){return isNaN(e)&&isNaN(t)?(e=0,t=1):isNaN(e)?e=0:isNaN(t)&&(t=0),e=Math.min(e,t),t=Math.max(e,t),Math.floor(Math.random()*(t-e+1))+e}},sML.String={pad:function(e,t,n){if(e+="","number"==typeof e&&(e+=""),"number"==typeof t&&(t+=""),"string"!=typeof e||"string"!=typeof t||"number"!=typeof n||1>n||e.length>=n)return e;for(;e.length<n;)e=t+e;return e.slice(-n)},insertZeroWidthSpace:function(e){return e.replace(/(?=\w)/g,"&#x200B;")},replace:function(e,t){return t instanceof Array||(t=[t]),t.forEach(function(t){t instanceof Array&&2==t.length&&("string"==typeof t[0]||t[0]instanceof RegExp)&&"string"==typeof t[1]&&e.replace(t[0],t[1])}),e}},sML.getLength=function(e){if("object"==typeof e){if(e instanceof Array)return e.length;var t=0;for(var n in e)t++;return t}return"string"==typeof e?e.length:"number"==typeof e?(""+e).length:null},sML.Range={getRange:function(e,t){if(!e)return null;t||(t=e.Start.Node.ownerDocument);var n=t.createRange();return n.setStart(e.Start.Node,"number"==typeof e.Start.Index?e.Start.Index:e.Start.Node.textContent.indexOf(e.Start.Text)),n.setEnd(e.End.Node,"number"==typeof e.End.Index?e.End.Index:e.End.Node.textContent.indexOf(e.End.Text)+e.End.Text.length),n},flat:function(e){return e.replace(/[\r\n]/g,"")},escape:function(e){return this.flat(e).replace(/([\(\)\{\}\[\]\,\.\-\+\*\?\!\:\^\$\/\\])/g,"\\$1")},distill:function(e,t,n){for(var i="",o=t;n>=o;o++)i+=e[o];return i},find:function(e,t){if(t||(t=document.body),"string"!=typeof e||!e||this.flat(t.textContent).indexOf(e)<0)return null;if(3==t.nodeType)return{Start:{Node:t,Text:e},End:{Node:t,Text:e}};for(var n=[],i=0,o=t.childNodes.length-1,r="",a={},s=0;o>=s;s++){if(this.flat(t.childNodes[s].textContent).indexOf(e)>=0)return this.find(e,t.childNodes[s]);n.push(t.childNodes[s].textContent)}for(r=this.distill(n,i+1,o);r&&this.flat(r).indexOf(e)>=0;)i++,r=this.distill(n,i+1,o);var l=t.childNodes[i],c=0,d=l.textContent.length-1,u="";for(r=this.distill(l.textContent,c,d);this.flat(r)&&!new RegExp("^"+this.escape(r)).test(e);)c++,r=this.distill(l.textContent,c,d);for(u=this.flat(r);3!=l.nodeType;)a=this.find(u,l),l=a.Start.Node,u=a.Start.Text;for(r=this.distill(n,i,o-1);r&&this.flat(r).indexOf(e)>=0;)o--,r=this.distill(n,i,o-1);var p=t.childNodes[o],h=0,g=p.textContent.length-1,f="";for(r=this.distill(p.textContent,h,g);this.flat(r)&&!new RegExp(this.escape(r)+"$").test(e);)g--,r=this.distill(p.textContent,h,g);for(f=this.flat(r);3!=p.nodeType;)a=this.find(f,p),p=a.End.Node,f=a.End.Text;return{Start:{Node:l,Text:u},End:{Node:p,Text:f}}}},sML.Selection={selectRange:function(e){if(!e)return null;var t=window.getSelection();return t.removeAllRanges(),t.addRange(e),e},getSelectedText:sML.UA.InternetExplorer<9?function(){var e=""+document.selection.createRange().text;return e?e:""}:function(){var e=""+window.getSelection();return e?e:""}},sML.getSelection=function(){return sML.Selection.getSelectedText()},sML.select=function(e,t){return sML.Selection.selectRange(sML.Range.getRange(e,t))},sML.find=function(e,t){return sML.Selection.selectRange(sML.Range.getRange(sML.Range.find(e,t)))},sML.Fullscreen={Enabled:function(e){return e.fullscreenEnabled||e.webkitFullscreenEnabled||e.mozFullScreenEnabled||e.msFullscreenEnabled}(document),request:function(e){var t=function(t){return function(n){return n||(n=e),n[t]()}};return e.requestFullscreen?t("requestFullscreen"):e.webkitRequestFullscreen?t("webkitRequestFullscreen"):e.mozRequestFullScreen?t("mozRequestFullScreen"):e.msRequestFullscreen?t("msRequestFullscreen"):function(){return!1}}(document.documentElement),exit:function(e){var t=function(t){return function(n){return n||(n=e),n[t]()}};return e.exitFullscreen?t("exitFullscreen"):e.webkitExitFullscreen?t("webkitExitFullscreen"):e.mozCancelFullScreen?t("mozCancelFullScreen"):e.msExitFullscreen?t("msExitFullscreen"):function(){return!1}}(document),getElement:function(e){var t=function(t){return function(n){return n||(n=e),n[t]}};return"undefined"!=typeof e.fullscreenElement?t("fullscreenElement"):"undefined"!=typeof e.webkitFullscreenElement?t("webkitFullscreenElement"):"undefined"!=typeof e.mozFullscreenElement?t("mozFullscreenElement"):"undefined"!=typeof e.msFullscreenElement?t("msFullscreenElement"):function(){return null}}(document)},sML.requestFullscreen=sML.Fullscreen.request,sML.exitFullscreen=sML.Fullscreen.exit,sML.getFullscreenElement=sML.Fullscreen.getElement,sML.SML={each:function(e){return sML.each(this,e),this},set:function(e,t){return this.each(function(){var n=this;sML.set(n,e,t)})},style:function(e){return this.each(function(){var t=this;sML.style(t,e)})},appendChild:function(e){return this.each(function(){var t=this;sML.each(e,function(){t.appendChild(this)})})},preppendChild:function(e){return this.each(function(){var e=this;sML.each(Es,function(){e.insertBefore(this,S.firstChild)})})},insertBefore:function(e,t){return this.each(function(){var e=this;sML.each(Es,function(){e.insertBefore(this,t)})})},insertAfter:function(e,t){return this.each(function(){var e=this;sML.each(Es,function(){e.insertBefore(this,t.nextSibling)})})},addClass:function(e){return this.each(function(){var t=this;sML.addClass(t,e)})},removeClass:function(e){return this.each(function(){var t=this;sML.removeClass(t,e)})},replaceClass:function(e,t){return this.each(function(){var n=this;sML.replaceClass(n,e,t)})}},window.addEventListener("unload",function(){window.sML=null,delete window.sML}),sML}(),/*!
 *
 * # BiB/i (core)
 *
 * - "Heart of BiB/i"
 * - Copyright (c) Satoru MATSUSHIMA - http://bibi.epub.link/ or https://github.com/satorumurmur/bibi
 * - Licensed under the MIT license. - http://www.opensource.org/licenses/mit-license.php
 */
Bibi={version:"0.999.0",build:20160309.1453},document.addEventListener("DOMContentLoaded",function(){Bibi.welcome()}),Bibi.welcome=function(){if(O.stamp("Welcome!"),O.log("Welcome to BiB/i v"+Bibi.version+" - (ja) http://bibi.epub.link - (en) https://github.com/satorumurmur/bibi","-0"),O.Language=function(){return"string"!=typeof navigator.language?"en":"ja"==navigator.language.split("-")[0]?"ja":"en"}(),O.HTML=document.documentElement,O.HTML.className="welcome "+sML.Environments.join(" "),O.Head=document.head,O.Body=document.body,O.Info=document.getElementById("bibi-info"),O.Title=document.getElementsByTagName("title")[0],(sML.OS.iOS||sML.OS.Android)&&(O.Mobile=!0,O.HTML.className=O.HTML.className+" Touch",O.setOrientation=function(){sML.removeClass(O.HTML,"orientation-"+(0==window.orientation?"landscape":"portrait")),sML.addClass(O.HTML,"orientation-"+(0==window.orientation?"portrait":"landscape"))},window.addEventListener("orientationchange",O.setOrientation),O.setOrientation(),sML.OS.iOS&&(O.Head.appendChild(sML.create("meta",{name:"apple-mobile-web-app-capable",content:"yes"})),O.Head.appendChild(sML.create("meta",{name:"apple-mobile-web-app-status-bar-style",content:"white"})))),window.parent==window?(O.WindowEmbedded=0,O.WindowEmbeddedDetail="Direct Opened: "+location.origin+location.pathname+location.search,O.HTML.className=O.HTML.className+" window-not-embedded"):(O.HTML.className=O.HTML.className+" window-embedded",location.host==parent.location.host?(O.WindowEmbedded=1,O.WindowEmbeddedDetail="Embedded in: "+parent.location.origin+parent.location.pathname+parent.location.search,O.HTML.className=O.HTML.className+" window-embedded-sameorigin"):(O.WindowEmbedded=-1,O.WindowEmbeddedDetail="Embedded in: Cross-Origin Parent",O.HTML.className=O.HTML.className+" window-embedded-crossorigin")),O.WindowEmbedded)try{O.ParentHolder=window.parent.document.getElementById(U["pipi-id"])}catch(e){}O.WindowEmbedded&&!O.ParentHolder||!(O.Body.requestFullscreen||O.Body.webkitRequestFullscreen||O.Body.mozRequestFullScreen||O.Body.msRequestFullscreen)?O.HTML.className=O.HTML.className+" fullscreen-not-enabled":(O.FullscreenEnabled=!0,O.FullscreenElement=O.ParentHolder?O.ParentHolder.Bibi.Frame:O.HTML,O.FullscreenDocument=O.ParentHolder?window.parent.document:document,O.HTML.className=O.HTML.className+" fullscreen-enabled"),O.WritingModeProperty=function(){var e=getComputedStyle(O.HTML);return/^(vertical|horizontal)-/.test(e["-webkit-writing-mode"])?"-webkit-writing-mode":/^(vertical|horizontal)-/.test(e["writing-mode"])||sML.UA.InternetExplorer?"writing-mode":void 0}();var t=document.body.appendChild(sML.create("div",{id:"checker"}));return t.Child=t.appendChild(sML.create("p",{innerHTML:"aA"})),t.Child.offsetWidth<t.Child.offsetHeight?(O.HTML.className=O.HTML.className+" vertical-text-enabled",O.VerticalTextEnabled=!0):(O.HTML.className=O.HTML.className+" vertical-text-not-enabled",O.VerticalTextEnabled=!1),O.DefaultFontSize=Math.min(t.Child.offsetWidth,t.Child.offsetHeight),document.body.removeChild(t),delete t,O.Scrollbars={Width:window.innerWidth-O.HTML.offsetWidth,Height:window.innerHeight-O.HTML.offsetHeight},U.initialize(),S.initialize(),R.initialize(),C.initialize(),sML.UA.InternetExplorer<11?Bibi.byebye():(C.note("Welcome!"),sML.removeClass(O.HTML,"welcome"),E.dispatch("bibi:welcome"),void(P.Initialized?Bibi.ready():E.add("bibi:initializePreset",Bibi.ready)))},Bibi.byebye=function(){var e={En:"<span>I'm so Sorry....</span> <span>Your Browser Is</span> <span>Not Compatible with BiB/i.</span>",Ja:"<span></span> <span></span><span></span>"};C.Veil.ByeBye=C.Veil.appendChild(sML.create("p",{id:"bibi-veil-byebye",innerHTML:['<span lang="en">',e.En,"</span>",'<span lang="ja">',e.Ja,"</span>"].join("").replace(/(BiB\/i|)/g,'<a href="http://bibi.epub.link/" target="_blank">$1</a>')})),O.log(e.En.replace(/<[^>]*>/g,""),"-*"),E.dispatch("bibi:byebye")},Bibi.ready=function(){var e=[];X.Extensions.forEach(function(t){e.push(t.name)}),e.length&&O.log("Extension"+(e.length>=2?"s":"")+": "+e.join(", "),"-*"),E.add("bibi:scrolled",R.getCurrent),E.add("bibi:command:move",function(e){R.move(e)}),E.add("bibi:command:focus",function(e){R.focus(e)}),E.add("bibi:command:changeView",function(e){R.changeView(e)}),window.addEventListener(O.Mobile?"orientationchange":"resize",R.onresize),R.Main.addEventListener("scroll",R.onscroll),window.addEventListener("message",M.gate,!1),E.dispatch("bibi:ready"),setTimeout(function(){U.book?L.loadBook(U.book):O.ZippedEPUBAvailable&&window.File&&!O.Mobile?B.dropOrClick():O.WindowEmbedded?C.note("Tell me EPUB name via embedding tag.",99999999999):C.note("Tell me EPUB name via URI.",99999999999)},O.Mobile?999:1)},B={},B.initialize=function(e){return O.log("Initializing Book...","*:"),delete B.Online,delete B.Unzipped,delete B.name,delete B.Path,delete B.PathDelimiter,delete B.File,delete B.Files,delete B.initialize.resolve,delete B.initialize.reject,O.apply({Title:"",Creator:"",Publisher:"",Language:"",WritingMode:"",Mimetype:{Path:"mimetype"},Container:{Path:"META-INF/container.xml"},Package:{Path:"",Dir:"",Metadata:{titles:[],creators:[],publishers:[],languages:[]},Manifest:{items:{},nav:{},"toc-ncx":{},"cover-image":{}},Spine:{itemrefs:[]}},FileDigit:0},B),new Promise(function(t,n){B.initialize.resolve=t,B.initialize.reject=n,"string"==typeof e?(B.Online=!0,B.name=e,B.Path=function(){return/^([\w\d]+:)?\/\//.test(B.name)?B.name:/^\//.test(B.name)?location.origin+B.name:P.bookshelf+B.name}(),/\.epub$/i.test(B.name)?B.initialize.asZippedEPUB():(B.Path=B.Path.replace(/\/+$/,""),B.loadMimetype().then(function(){B.initialize.resolve()})["catch"](function(){B.initialize.asZippedEPUB()}))):"object"==typeof e&&e?e.size&&"string"==typeof e.name&&/\.epub$/i.test(e.name)?(B.name=B.Path="[Local] "+e.name,B.File=e,B.initialize.asZippedEPUB()):B.initialize.reject("EPUB File Is Not Valid."):B.initialize.reject("Something Trouble.")}).then(function(){delete B.initialize.resolve,delete B.initialize.reject,B.PathDelimiter=B.Unzipped?"/":" > ",O.log("Book Initialized.","/*"),E.dispatch("bibi:B.initialize")})["catch"](function(e){C.note(e,99999999999),O.error(e)})},B.initialize.asZippedEPUB=function(){return O.ZippedEPUBAvailable?void(S.autostart?B.loadZippedEPUB():L.wait().then(B.loadZippedEPUB)):B.initialize.reject("Zipped EPUB Unavailable.")},B.loadMimetype=function(){return O.download(B.Path+"/"+B.Mimetype.Path).then(function(e){"application/epub+zip"==e.responseText&&(B.Unzipped=!0,O.log("EPUB: "+B.Path+" (Unzipped Online Folder)","-*"))})},L={},L.wait=function(){return new Promise(function(e,t){L.wait.resolve=e,L.wait.reject=t,sML.addClass(O.HTML,"waiting"),O.log("(waiting)","-*")}).then(function(){delete L.wait.resolve,delete L.wait.reject,sML.removeClass(O.HTML,"waiting")})},L.play=function(){return S["play-in-new-window"]?window.open(location.href):(L.Played=!0,L.wait.resolve(),E.dispatch("bibi:startLoading"),void E.dispatch("bibi:play"))},L.loadBook=function(e){O.log("Loading Book...","*:"),B.initialize(e).then(function(){L.loadBookContent()})},L.loadBookContent=function(){O.log("Loading Book Content...","*:"),E.dispatch("bibi:startLoading"),R.reset(),L.loadContainer()},L.loadContainer=function(){O.log("Loading Container XML: "+B.Path+B.PathDelimiter+B.Container.Path+" ...","*:"),O.openDocument(B.Container.Path).then(L.loadContainer.read).then(function(){O.log("Container XML Loaded.","/*"),L.loadPackageDocument()})},L.loadContainer.read=function(e){B.Package.Path=e.getElementsByTagName("rootfile")[0].getAttribute("full-path"),B.Package.Dir=B.Package.Path.replace(/\/?[^\/]+$/,"")},L.loadPackageDocument=function(){O.log("Loading Package Document: "+B.Path+B.PathDelimiter+B.Package.Path+" ...","*:"),O.openDocument(B.Package.Path).then(L.loadPackageDocument.read).then(function(){O.log("Package Document Loaded.","/*"),L.prepareSpine(),L.createCover(),L.loadNavigation()})},L.loadPackageDocument.read=function(e){var t=e.getElementsByTagName("metadata")[0],n=e.getElementsByTagName("manifest")[0],i=e.getElementsByTagName("spine")[0],o=n.getElementsByTagName("item"),r=i.getElementsByTagName("itemref");if(o.length<=0)return O.error('"'+B.Package.Path+'" has no <item> in <manifest>.');if(r.length<=0)return O.error('"'+B.Package.Path+'" has no <itemref> in <spine>.');XMLNS={dc:t.getAttribute("xmlns:dc")},sML.each(t.getElementsByTagName("meta"),function(){if(!this.getAttribute("refines")){if(this.getAttribute("property")){var e=this.getAttribute("property").replace(/^dcterms:/,"");/^(title|creator|publisher|language)$/.test(e)?B.Package.Metadata[e+"s"].push(this.textContent):B.Package.Metadata[e]||(B.Package.Metadata[e]=this.textContent)}this.getAttribute("name")&&this.getAttribute("content")&&(B.Package.Metadata[this.getAttribute("name")]=this.getAttribute("content"))}}),B.Package.Metadata.titles.length||sML.each(e.getElementsByTagNameNS(XMLNS.dc,"title"),function(){return B.Package.Metadata.titles.push(this.textContent),!1}),B.Package.Metadata.creators.length||sML.each(e.getElementsByTagNameNS(XMLNS.dc,"creator"),function(){B.Package.Metadata.creators.push(this.textContent)}),B.Package.Metadata.publishers.length||sML.each(e.getElementsByTagNameNS(XMLNS.dc,"publisher"),function(){B.Package.Metadata.publishers.push(this.textContent)}),B.Package.Metadata.languages.length||sML.each(e.getElementsByTagNameNS(XMLNS.dc,"language"),function(){B.Package.Metadata.languages.push(this.textContent)}),B.Package.Metadata.languages.length||(B.Package.Metadata.languages[0]="en"),B.Package.Metadata.cover||(B.Package.Metadata.cover=""),B.Package.Metadata["rendition:layout"]||(B.Package.Metadata["rendition:layout"]="reflowable"),B.Package.Metadata["rendition:orientation"]||(B.Package.Metadata["rendition:orientation"]="auto"),B.Package.Metadata["rendition:spread"]||(B.Package.Metadata["rendition:spread"]="auto"),"auto"==B.Package.Metadata["rendition:orientation"]&&(B.Package.Metadata["rendition:orientation"]="portrait"),"auto"==B.Package.Metadata["rendition:spread"]&&(B.Package.Metadata["rendition:spread"]="landscape"),delete e;var a=i.getAttribute("toc");sML.each(o,function(){var e={id:this.getAttribute("id")||"",href:this.getAttribute("href")||"","media-type":this.getAttribute("media-type")||"",properties:this.getAttribute("properties")||"",fallback:this.getAttribute("fallback")||""};e.id&&e.href&&(B.Package.Manifest.items[e.id]=e,function(t){/ nav /.test(t)&&(B.Package.Manifest.nav.Path=O.getPath(B.Package.Dir,e.href)),/ cover-image /.test(t)&&(B.Package.Manifest["cover-image"].Path=O.getPath(B.Package.Dir,e.href))}(" "+e.properties+" "),a&&e.id==a&&(B.Package.Manifest["toc-ncx"].Path=O.getPath(B.Package.Dir,e.href)))}),B.Package.Spine["page-progression-direction"]=i.getAttribute("page-progression-direction"),B.Package.Spine["page-progression-direction"]&&/^(ltr|rtl)$/.test(B.Package.Spine["page-progression-direction"])||(B.Package.Spine["page-progression-direction"]="ltr"),B.PPD=B.Package.Spine["page-progression-direction"];var s=[/(page-spread)-(.+)/,/(rendition:layout)-(.+)/,/(rendition:orientation)-(.+)/,/(rendition:spread)-(.+)/,/(rendition:page-spread)-(.+)/,/(bibi:[a-z]+)-(.+)/];sML.each(r,function(e){var t={idref:this.getAttribute("idref")||"",linear:this.getAttribute("linear")||"",properties:this.getAttribute("properties")||"","page-spread":"","rendition:layout":B.Package.Metadata["rendition:layout"],"rendition:orientation":B.Package.Metadata["rendition:orientation"],"rendition:spread":B.Package.Metadata["rendition:spread"]};"no"!=t.linear&&(t.linear="yes"),t.properties=t.properties.replace(/^\s+/,"").replace(/\s+$/,"").replace(/\s+/g," ").split(" "),s.forEach(function(e){t.properties.forEach(function(n){return e.test(n)?(t[n.replace(e,"$1")]=n.replace(e,"$2").replace("rendition:",""),!1):void 0})}),t["rendition:page-spread"]&&(t["page-spread"]=t["rendition:page-spread"]),t["rendition:page-spread"]=t["page-spread"],t.viewport={content:null,width:null,height:null},t.viewBox={content:null,width:null,height:null},B.Package.Spine.itemrefs.push(t)}),B.Title=B.Package.Metadata.titles.join(", "),B.Creator=B.Package.Metadata.creators.join(", "),B.Publisher=B.Package.Metadata.publishers.join(", "),B.Language=B.Package.Metadata.languages[0].split("-")[0],/^(zho?|chi|kor?|ja|jpn)$/.test(B.Language)?B.WritingMode="rtl"==B.PPD?"tb-rl":"lr-tb":/^(aze?|ara?|ui?g|urd?|kk|kaz|ka?s|ky|kir|kur?|sn?d|ta?t|pu?s|bal|pan?|fas?|per|ber|msa?|may|yid?|heb?|arc|syr|di?v)$/.test(B.Language)?B.WritingMode="rl-tb":/^(mo?n)$/.test(B.Language)?B.WritingMode="tb-lr":B.WritingMode="lr-tb";var l=[];B.Title&&l.push(B.Title),B.Creator&&l.push(B.Creator),B.Publisher&&l.push(B.Publisher),l.length&&(O.Title.innerHTML="BiB/i",O.Title.appendChild(document.createTextNode(" | "+l.join(" - ").replace(/&amp;?/gi,"&").replace(/&lt;?/gi,"<").replace(/&gt;?/gi,"*:"))));var c=[];B.Title&&c.push(B.Title),B.Creator&&c.push(B.Creator),B.Publisher&&c.push(B.Publisher),c.push('Language: "'+B.Language+'"'),O.log(c.join(" / "),"-*");var d=[];d.push('rendition:layout: "'+B.Package.Metadata["rendition:layout"]+'"'),d.push('rendition:orientation: "'+B.Package.Metadata["rendition:orientation"]+'"'),d.push('rendition:spread: "'+B.Package.Metadata["rendition:spread"]+'"'),d.push('page-progression-direction: "'+B.Package.Spine["page-progression-direction"]+'"'),O.log(d.join(" / "),"-*"),S.update()},L.prepareSpine=function(){if(O.log("Preparing Spine...","*:"),"rtl"==B.PPD)var e="right",t="left";else var e="left",t="right";sML.each(B.Package.Spine.itemrefs,function(){}),sML.each(B.Package.Spine.itemrefs,function(){var n=this,i=R.Items.length,o=sML.create("iframe",{className:"item",scrolling:"no",allowtransparency:"true"});if(o.ItemRef=n,o.Path=O.getPath(B.Package.Dir,B.Package.Manifest.items[n.idref].href),o.Dir=o.Path.replace(/\/?[^\/]+$/,""),R.AllItems.push(o),"yes"!=n.linear)return R.NonLinearItems.push(o);R.Items.push(o);var r,a;if(n["page-spread"]==t&&i)for(var s=i-1;s>=0;s--)if(R.Items[s].ItemRef["page-spread"]==e){R.Items[s].Pair=o,o.Pair=R.Items[s],r=a.SpreadBox,a=o.Pair.Spread;break}o.Pair||(r=R.Main.Book.appendChild(sML.create("div",{className:"spread-box"})),a=r.appendChild(sML.create("div",{className:"spread"})),a.SpreadBox=r,a.Items=[],a.Pages=[],a.SpreadIndex=R.Spreads.length,R.Spreads.push(a));var l=a.appendChild(sML.create("div",{className:"item-box"}));o.Spread=a,o.ItemBox=l,o.Pages=[],o.ItemIndexInSpread=a.Items.length,o.ItemIndex=i,o.id="item-"+sML.String.pad(o.ItemIndex+1,0,B.FileDigit),a.Items.push(o),[r,a,l,o].forEach(function(e){e.RenditionLayout=n["rendition:layout"],e.PrePaginated="pre-paginated"==e.RenditionLayout,sML.addClass(e,n["rendition:layout"])}),[l,o].forEach(function(e){n["page-spread"]&&sML.addClass(e,"page-spread-"+n["page-spread"]),n["bibi:layout"]&&sML.addClass(e,"layout-"+n["bibi:layout"])})}),B.FileDigit=(R.Items.length+"").length,O.log(R.Items.length+" Item"+(R.Items.length>1?"s":"")+" in "+R.Spreads.length+" Spread"+(R.Spreads.length>1?"s":""),"-*"),O.log("Spine Prepared.","/*"),E.dispatch("bibi:prepareSpine")},L.createCover=function(){O.log("Creating Cover...","*:"),C.Veil.Cover.innerHTML=C.Panel.BookInfo.Cover.innerHTML="",B.Package.Manifest["cover-image"].Path&&(R.CoverImage.Path=B.Package.Manifest["cover-image"].Path);var e=function(){var e=[];return B.Title&&e.push("<strong>"+B.Title+"</strong>"),B.Creator&&e.push("<em>"+B.Creator+"</em>"),B.Publisher&&e.push("<span>"+B.Publisher+"</span>"),e.join(" ")}();C.Veil.Cover.Info=C.Veil.Cover.appendChild(sML.create("p",{id:"bibi-veil-cover-info",innerHTML:e})),C.Panel.BookInfo.Cover.Info=C.Panel.BookInfo.Cover.appendChild(sML.create("p",{id:"bibi-panel-bookinfo-cover-info",innerHTML:e})),function(e){R.CoverImage.Path?(O.log("Cover Image: "+B.Path+B.PathDelimiter+R.CoverImage.Path,"-*"),sML.create("img",{load:function(){var e=this;e.src=B.Unzipped?B.Path+"/"+R.CoverImage.Path:B.getDataURI(R.CoverImage.Path),e.timeout=setTimeout(function(){e.ontimeout()},5e3)},onload:function(){return this.TimedOut?!1:(clearTimeout(this.timeout),sML.style(C.Veil.Cover,{backgroundImage:"url("+this.src+")"}),C.Panel.BookInfo.Cover.insertBefore(this,C.Panel.BookInfo.Cover.Info),void e("with-cover-image"))},ontimeout:function(){this.TimedOut=!0,e("without-cover-image")}}).load()):(O.log("No Cover Image.","-*"),e("without-cover-image"))}(function(e){C.Veil.Cover.className=C.Panel.BookInfo.Cover.className=e}),O.log("Cover Created.","/*"),E.dispatch("bibi:createCover",R.CoverImage.Path)},L.loadNavigation=function(){B.Package.Manifest.nav.Path?(C.Panel.BookInfo.Navigation.Path=B.Package.Manifest.nav.Path,C.Panel.BookInfo.Navigation.Type="Navigation Document"):B.Package.Manifest["toc-ncx"].Path&&(C.Panel.BookInfo.Navigation.Path=B.Package.Manifest["toc-ncx"].Path,C.Panel.BookInfo.Navigation.Type="TOC-NCX"),function(e){return C.Panel.BookInfo.Navigation.Type?(O.log("Loading Navigation: "+B.Path+B.PathDelimiter+C.Panel.BookInfo.Navigation.Path+" ...","*:"),void O.openDocument(C.Panel.BookInfo.Navigation.Path).then(function(t){C.Panel.BookInfo.Navigation.innerHTML="";var n=document.createDocumentFragment();if("Navigation Document"==C.Panel.BookInfo.Navigation.Type)sML.each(t.querySelectorAll("nav"),function(){switch(this.getAttribute("epub:type")){case"toc":sML.addClass(this,"bibi-nav-toc");break;case"landmarks":sML.addClass(this,"bibi-nav-landmarks");break;case"page-list":sML.addClass(this,"bibi-nav-page-list")}sML.each(this.querySelectorAll("*"),function(){this.removeAttribute("style")}),n.appendChild(this)});else{var i=t.getElementsByTagName("navMap")[0];sML.each(i.getElementsByTagName("navPoint"),function(){var e=this.getElementsByTagName("navLabel")[0];e.parentNode.insertBefore(sML.create("a",{href:this.getElementsByTagName("content")[0].getAttribute("src"),innerHTML:this.getElementsByTagName("text")[0].innerHTML}),e),sML.removeElement(this.getElementsByTagName("navLabel")[0]),sML.removeElement(this.getElementsByTagName("content")[0]);var t=sML.create("li",{id:this.getAttribute("id")});t.setAttribute("playorder",this.getAttribute("playorder")),this.parentNode.insertBefore(t,this).appendChild(this),t.previousSibling&&t.previousSibling.tagName&&!/^a$/i.test(t.previousSibling.tagName)?t.previousSibling.appendChild(t):t.parentNode.insertBefore(document.createElement("ul"),t).appendChild(t)}),n.appendChild(document.createElement("nav")).innerHTML=i.innerHTML.replace(/<(bibi_)?navPoint( [^>]+)?>/gi,"").replace(/<\/(bibi_)?navPoint>/gi,"")}C.Panel.BookInfo.Navigation.appendChild(n),C.Panel.BookInfo.Navigation.Body=C.Panel.BookInfo.Navigation,delete n,delete t,L.postprocessItem.coordinateLinkages(C.Panel.BookInfo.Navigation,"InNav"),R.resetNavigation(),O.log("Navigation Loaded.","/*"),e()})):(O.log("No Navigation Document or TOC-NCX.","-*"),e())}(function(){E.dispatch("bibi:loadNavigation",C.Panel.BookInfo.Navigation.Path),S.autostart||L.Played?L.loadItemsInSpreads():(E.dispatch("bibi:stopLoading"),L.wait().then(L.loadItemsInSpreads))})},L.loadItemsInSpreads=function(){O.stamp("Load Items in Spreads"),O.log("Loading "+R.Items.length+" Item"+(R.Items.length>1?"s":"")+" in "+R.Spreads.length+" Spread"+(R.Spreads.length>1?"s":"")+"...","*:"),R.resetStage(),L.LoadedItems=0,L.LoadedSpreads=0,R.ToRelayout=!1,L.listenResizingWhileLoading=function(){R.ToRelayout=!0},window.addEventListener("resize",L.listenResizingWhileLoading),E.remove("bibi:postprocessItem",L.onLoadItem),E.add("bibi:postprocessItem",L.onLoadItem),R.Spreads.forEach(L.loadSpread)},L.loadSpread=function(e){e.Loaded=!1,e.LoadedItems=0,e.Items.forEach(L.loadItem)},L.loadItem=function(e){O.log(sML.String.pad(e.ItemIndex+1,0,B.FileDigit)+"/"+sML.String.pad(B.Package.Spine.itemrefs.length,0,B.FileDigit)+" - "+(e.Path?B.Path+B.PathDelimiter+e.Path:"... Not Found."),"-*"),e.Loaded=!1,e.TimeCard={},e.stamp=function(t){O.stamp(t,e.TimeCard)};var t=e.Path;if(/\.(x?html?)$/i.test(t))B.Unzipped?(e.src=B.Path+"/"+t,e.onload=function(){setTimeout(L.postprocessItem,0,e)},e.ItemBox.appendChild(e)):(L.loadItem.writeItemHTML(e,B.Files[t]),setTimeout(L.postprocessItem,0,e));else if(/\.(svg)$/i.test(t))if(e.IsSVG=!0,B.Unzipped){var n=B.Path+"/"+t;O.download(n).then(function(t){L.loadItem.writeItemHTML(e,!1,'<base href="'+n+'" />',t.responseText.replace(/<\?xml-stylesheet (.+?)[ \t]?\?>/g,'<link rel="stylesheet" $1 />'))})}else L.loadItem.writeItemHTML(e,!1,"",B.Files[t].replace(/<\?xml-stylesheet (.+?)[ \t]?\?>/g,'<link rel="stylesheet" $1 />'));else/\.(gif|jpe?g|png)$/i.test(t)?(e.IsBitmap=!0,L.loadItem.writeItemHTML(e,!1,"",'<img alt="" src="'+(B.Unzipped?B.Path+"/"+t:B.getDataURI(t))+'" />')):/\.(pdf)$/i.test(t)&&(e.IsPDF=!0,L.loadItem.writeItemHTML(e,!1,"",'<iframe     src="'+(B.Unzipped?B.Path+"/"+t:B.getDataURI(t))+'" />'))},L.loadItem.writeItemHTML=function(e,t,n,i){e.ItemBox.appendChild(e),e.contentDocument.open(),e.contentDocument.write(t?t:["<html>","<head>"+n+"</head>",'<body onload="parent.L.postprocessItem(parent.R.Items['+e.ItemIndex+"]); document.body.removeAttribute('onload'); return false;\">"+i+"</body>","</html>"].join("")),e.contentDocument.close()},L.onLoadItem=function(e){e.Loaded=!0,L.LoadedItems++,e.ImageItem&&(sML.addClass(e.ItemBox,"image-item-box"),sML.addClass(e,"image-item")),E.dispatch("bibi:loadItem",e),e.stamp("Loaded");var t=e.Spread;t.LoadedItems++,t.LoadedItems==t.Items.length&&L.onLoadSpread(t),C.note("Loading... ("+L.LoadedItems+"/"+R.Items.length+" Items Loaded.)")},L.onLoadSpread=function(e){L.LoadedSpreads++,e.ImageSpread=!0,e.Items.forEach(function(t){t.ImageItem||(e.ImageSpread=!1)}),e.ImageSpread&&(sML.addClass(e.SpreadBox,"image-spread-box"),sML.addClass(e,"image-spread")),E.dispatch("bibi:loadSpread",e),R.ToRelayout||R.resetSpread(e),L.LoadedSpreads==R.Spreads.length&&L.onLoadItemsInSpreads()},L.onLoadItemsInSpreads=function(){delete B.Files,document.body.style.display="",R.resetPages(),E.remove("bibi:postprocessItem",L.onLoadItem),O.stamp("Items in Spreads Loaded"),O.log(R.Items.length+" Item"+(R.Items.length>1?"s":"")+" in "+R.Spreads.length+" Spread"+(R.Spreads.length>1?"s":"")+" Loaded.","/*"),E.dispatch("bibi:loadItems"),E.dispatch("bibi:loadSpreads"),E.dispatch("bibi:loadItemsInSpreads"),L.onLoadBookContent()},L.onLoadBookContent=function(){O.stamp("Book Content Loaded"),O.log("Book Content Loaded.","/*"),E.dispatch("bibi:loadBookContent"),L.onLoadBook()},L.onLoadBook=function(){L.Loaded=!0,O.stamp("Book Loaded"),O.log("Book Loaded.","/*"),E.dispatch("bibi:loadBook"),L.open()},L.postprocessItem=function(e){e.stamp("Postprocess"),e.HTML=sML.edit(e.contentDocument.getElementsByTagName("html")[0],{Item:e}),e.Head=sML.edit(e.contentDocument.getElementsByTagName("head")[0],{Item:e}),e.Body=sML.edit(e.contentDocument.getElementsByTagName("body")[0],{Item:e}),sML.addClass(e.HTML,sML.Environments.join(" ")),sML.each(e.Body.querySelectorAll("link"),function(){e.Head.appendChild(this)}),S["epub-additional-stylesheet"]&&e.Head.appendChild(sML.create("link",{rel:"stylesheet",href:S["epub-additional-stylesheet"]})),S["epub-additional-script"]&&e.Head.appendChild(sML.create("script",{src:S["epub-additional-script"]})),e.StyleSheets=[],sML.appendStyleRule("html","-webkit-text-size-adjust: 100%;",e.contentDocument),sML.each(e.HTML.querySelectorAll("link, style"),function(){if(/^link$/i.test(this.tagName)){if(!/^(alternate )?stylesheet$/.test(this.rel))return;if((sML.UA.Safari||sML.OS.iOS)&&"alternate stylesheet"==this.rel)return}e.StyleSheets.push(this)}),e.BibiProperties={};var t=e.HTML.getAttribute("data-bibi-properties");t&&t.replace(/[\s\t\r\n]+/g," ").split(" ").forEach(function(t){t&&(e.BibiProperties[t]=!0)});var n=e.contentDocument.querySelectorAll("body>*");if(n&&n.length){for(var i=0,o=0,r=n.length;r>o;o++)/^(script|style)$/i.test(n[o].tagName)||i++;1==i&&(/^svg$/i.test(e.Body.firstElementChild.tagName)?(e.Outsourcing=!0,e.ImageItem=!0,e.SingleSVGOnlyItem=!0):/^img$/i.test(e.Body.firstElementChild.tagName)?(e.Outsourcing=!0,e.ImageItem=!0,e.SingleIMGOnlyItem=!0):/^iframe$/i.test(e.Body.firstElementChild.tagName)?(e.Outsourcing=!0,e.FrameItem=!0,e.SingleFrameOnlyItem=!0):O.getElementInnerText(e.Body)||(e.Body.querySelectorAll("img, svg, video, audio").length-e.Body.querySelectorAll("svg img, video img, audio img").length==1?(e.Outsourcing=!0,e.ImageItem=!0):1==e.Body.getElementsByTagName("iframe").length&&(e.Outsourcing=!0,e.FrameItem=!0)))}E.dispatch("bibi:before:postprocessItemContent",e),L.postprocessItem.processImages(e),L.postprocessItem.defineViewport(e),L.postprocessItem.coordinateLinkages(e),setTimeout(function(){return e.contentDocument.styleSheets.length<e.StyleSheets.length?setTimeout(arguments.callee,100):(L.postprocessItem.patchWritingModeStyle(e),L.postprocessItem.applyBackgroundStyle(e),E.dispatch("bibi:postprocessItemContent",e),void E.dispatch("bibi:postprocessItem",e))},100)},L.postprocessItem.processImages=function(e){sML.each(e.Body.getElementsByTagName("img"),function(){this.Bibi={DefaultStyle:{margin:this.style.margin?this.style.margin:"",width:this.style.width?this.style.width:"",height:this.style.height?this.style.height:"","vertical-align":this.style.verticalAlign?this.style.verticalAlign:"","page-break-before":this.style.pageBreakBefore?this.style.pageBreakBefore:"","page-break-after":this.style.pageBreakAfter?this.style.pageBreakAfter:""}}}),sML.UA.InternetExplorer&&sML.each(e.Body.getElementsByTagName("svg"),function(){var e=this.getElementsByTagName("image");if(1==e.length){var t=e[0];t.getAttribute("width")&&t.getAttribute("height")&&(this.setAttribute("width",t.getAttribute("width")),this.setAttribute("height",t.getAttribute("height")))}})},L.postprocessItem.defineViewport=function(e){var t=e.ItemRef;if(sML.each(e.Head.getElementsByTagName("meta"),function(){if("viewport"==this.name&&(t.viewport.content=this.getAttribute("content"),t.viewport.content)){var e=1*t.viewport.content.replace(/^.*?width=([^\, ]+).*$/,"$1"),n=1*t.viewport.content.replace(/^.*?height=([^\, ]+).*$/,"$1");isNaN(e)||isNaN(n)||(t.viewport.width=e,t.viewport.height=n)}}),"pre-paginated"==t["rendition:layout"]&&!(t.viewport.width*t.viewport.height)){var n=e.Body.firstElementChild;if(e.SingleSVGOnlyItem){if(n.getAttribute("viewBox")){t.viewBox.content=n.getAttribute("viewBox");var i=t.viewBox.content.split(" ");if(4==i.length){var o=1*i[2]-1*i[0],r=1*i[3]-1*i[1];o&&r&&("100%"!=n.getAttribute("width")&&n.setAttribute("width","100%"),"100%"!=n.getAttribute("height")&&n.setAttribute("height","100%"),t.viewport.width=t.viewBox.width=o,t.viewport.height=t.viewBox.height=r)}}}else e.SingleIMGOnlyItem&&(t.viewport.width=parseInt(getComputedStyle(n).width),t.viewport.height=parseInt(getComputedStyle(n).height))}},L.postprocessItem.coordinateLinkages=function(e,t){var n=e.Path,i=e.Body;sML.each(i.getElementsByTagName("a"),function(e){var i=this;t&&(i.NavANumber=e+1,i.addEventListener(S.touchstart,function(e){e.stopPropagation()}),i.addEventListener(S.touchend,function(e){e.stopPropagation()}));var o=i.getAttribute("href");if(!o)return void(t&&(i.addEventListener("click",function(e){return e.preventDefault(),e.stopPropagation(),!1}),sML.addClass(i,"bibi-bookinfo-inactive-link")));if(/^[a-zA-Z]+:/.test(o)){if(o.split("#")[0]!=location.href.split("#")[0])return i.setAttribute("target",i.getAttribute("target")||"_blank");var r=o.split("#")[1];o=r?"#"+r:R.Items[0].Path}var a=O.getPath(n.replace(/\/?([^\/]+)$/,""),(/^\.*\/+/.test(o)?"":"./")+(/^#/.test(o)?n.replace(/^.+?([^\/]+)$/,"$1"):"")+o),s=a.split("#"),l=s[0]?s[0]:n,c=s[1]?s[1]:"";R.Items.forEach(function(e){return l==e.Path?(i.setAttribute("data-bibi-original-href",o),i.setAttribute("href","bibi://"+B.Path.replace(/^\w+:\/\//,"")+B.PathDelimiter+o),i.InNav=t,i.Destination={Item:e,ElementSelector:c?"#"+c:void 0},void i.addEventListener("click",L.postprocessItem.coordinateLinkages.jump)):void 0}),c&&/^epubcfi\(.+\)$/.test(c)&&(i.setAttribute("data-bibi-original-href",o),X.EPUBCFI?(i.setAttribute("href","bibi://"+B.Path.replace(/^\w+:\/\//,"")+B.PathDelimiter+"#"+c),i.InNav=t,i.Destination=R.getEPUBCFIDestination(c),i.addEventListener("click",L.postprocessItem.coordinateLinkages.jump)):(i.removeAttribute("href"),sML.style(i,{color:"rgb(192,192,192)",textDecoration:"none"}),i.addEventListener("click",function(){return!1}),O.Mobile||(i.addEventListener("mouseover",function(){return C.Help.show("EPUBCFI extention is required."),!1}),i.addEventListener("mouseout",function(){return C.Help.hide(),!1})))),t&&typeof S.nav==e+1&&i.Destination&&(S.to=i.Destination)})},L.postprocessItem.coordinateLinkages.jump=function(e){if(e.preventDefault(),e.stopPropagation(),this.Destination){var t=this,n=!t.InNav||L.Opened?function(){R.focus(t.Destination)}:function(){return S["play-in-new-window"]?window.open(location.href+(location.hash?",":"#")+"pipi(nav:"+t.NavANumber+")"):(S.to=t.Destination,void L.play())};t.InNav?C.Panel.toggle(n):n()}return!1},L.postprocessItem.patchWritingModeStyle=function(e){sML.UA.InternetExplorer&&sML.each(e.contentDocument.styleSheets,function(){for(var e=this,t=e.cssRules.length,n=0;t>n;n++){var i=this.cssRules[n];i.cssRules?arguments.callee.call(i):i.styleSheet?arguments.callee.call(i.styleSheet):/ (-(webkit|epub)-)?writing-mode: vertical-rl; /.test(i.cssText)?i.style.writingMode=/ direction: rtl; /.test(i.cssText)?"bt-rl":"tb-rl":/ (-(webkit|epub)-)?writing-mode: vertical-lr; /.test(i.cssText)?i.style.writingMode=/ direction: rtl; /.test(i.cssText)?"bt-lr":"tb-lr":/ (-(webkit|epub)-)?writing-mode: horizontal-tb; /.test(i.cssText)&&(i.style.writingMode=/ direction: rtl; /.test(i.cssText)?"rl-tb":"lr-tb")}});var t=getComputedStyle(e.HTML),n=getComputedStyle(e.Body);t[O.WritingModeProperty]!=n[O.WritingModeProperty]&&sML.style(e.HTML,{"writing-mode":n[O.WritingModeProperty]}),e.HTML.WritingMode=O.getWritingMode(e.HTML),sML.addClass(e.HTML,"writing-mode-"+e.HTML.WritingMode),/-rl$/.test(e.HTML.WritingMode)&&(n.marginLeft!=n.marginRight?e.Body.style.marginLeft=n.marginRight:/-lr$/.test(e.HTML.WritingMode)&&(n.marginRight!=n.marginLeft?e.Body.style.marginRight=n.marginLeft:n.marginBottom!=n.marginTop&&(e.Body.style.marginBottom=n.marginTop)))},L.postprocessItem.applyBackgroundStyle=function(e){e.HTML.style&&(sML.style(e.ItemBox,L.postprocessItem.applyBackgroundStyle.getBackgroundStyle(e.HTML)),e.HTML.style.background="transparent"),e.Body.style&&(sML.style(e,L.postprocessItem.applyBackgroundStyle.getBackgroundStyle(e.Body)),e.Body.style.background="transparent")},L.postprocessItem.applyBackgroundStyle.getBackgroundStyle=function(e){var t=getComputedStyle(e);return{backgroundColor:t.backgroundColor,backgroundImage:t.backgroundImage,backgroundRepeat:t.backgroundRepeat,backgroundPosition:t.backgroundPosition,backgroundSize:t.backgroundSize}},L.open=function(){E.dispatch("bibi:stopLoading"),R.layout({Destination:S.to?S.to:"head"}),window.removeEventListener("resize",L.listenResizingWhileLoading),delete L.listenResizingWhileLoading,setTimeout(function(){C.Veil.close(function(){setTimeout(function(){document.body.click()},500)}),L.Opened=!0,C.note(""),O.stamp("Enjoy"),O.log("Enjoy Readings!","-0"),E.dispatch("bibi:open")},1)},R={},R.initialize=function(){R.Main=O.Body.insertBefore(sML.create("div",{id:"bibi-main"}),O.Body.firstElementChild),R.Sub=O.Body.insertBefore(sML.create("div",{id:"bibi-sub"}),R.Main.nextSibling),R.Main.Book=R.Main.appendChild(sML.create("div",{id:"bibi-main-book"})),E.dispatch("bibi:initializeReader")},R.reset=function(){R.Main.Book.innerHTML=R.Sub.innerHTML="",L.Loaded=!1,R.Started=!1,R.AllItems=[],R.NonLinearItems=[],R.Spreads=[],R.Items=[],R.Pages=[],R.CoverImage={Path:""},R.Current={}},R.resetStage=function(){R.Stage={},R.Columned=!1,R.Main.Book.style.padding=R.Main.Book.style.width=R.Main.Book.style.height="",R.Stage.Width=window.innerWidth,R.Stage.Height=window.innerHeight,"paged"==S.RVM?(C.Indicator&&(R.Stage.Height-=parseFloat(getComputedStyle(C.Indicator.Progress.Bar).height)),R.Stage.PageGap=R.Main.Book.style["padding"+S.BASE.S]=R.Main.Book.style["padding"+S.BASE.E]=0):(R.Stage[S.SIZE.B]-=O.Scrollbars[S.SIZE.B]+2*S["spread-margin"],
R.Stage.PageGap=S["spread-gap"],R.Main.Book.style["padding"+S.BASE.S]=S["spread-margin"]+"px",R.Main.Book.style["padding"+S.BASE.E]=S["spread-margin"]+"px"),R.Stage.Orientation=R.Stage.Width/R.Stage.Height>1.4?"landscape":"portrait",R.Stage.BunkoLength=Math.floor(R.Stage[S.SIZE.B]*R.DefaultPageRatio[S.AXIS.L]/R.DefaultPageRatio[S.AXIS.B]),S["book-background"]&&(O.HTML.style.background=S["book-background"])},R.resetSpread=function(e){O.stamp("Reset Spread "+e.SpreadIndex+" Start"),e.Items.forEach(function(e){R.resetItem(e)});var t=e.SpreadBox;if(t.style["margin"+S.BASE.B]=t.style["margin"+S.BASE.A]="",t.style["margin"+S.BASE.E]=t.style["margin"+S.BASE.S]="auto",t.style.padding=t.style.width=t.style.height="","reflowable"==e.RenditionLayout||"reflowable"==S.BRL&&"vertical"==S.SLA)if(2==e.Items.length)if(R.Stage.Width>e.Items[0].ItemBox.offsetWidth+e.Items[1].ItemBox.offsetWidth)var n=e.Items[0].ItemBox.offsetWidth+e.Items[1].ItemBox.offsetWidth,i=Math.max(e.Items[0].ItemBox.offsetHeight,e.Items[1].ItemBox.style.offsetHeight);else var n=Math.max(e.Items[0].ItemBox.offsetWidth,e.Items[1].ItemBox.offsetWidth),i=e.Items[0].ItemBox.offsetHeight+e.Items[1].ItemBox.offsetHeight;else var n=e.Items[0].ItemBox.offsetWidth,i=e.Items[0].ItemBox.offsetHeight;else if(2==e.Items.length)var n=e.Items[0].ItemBox.offsetWidth+e.Items[1].ItemBox.offsetWidth,i=Math.max(e.Items[0].ItemBox.offsetHeight,e.Items[1].ItemBox.style.offsetHeight);else var n=e.Items[0].ItemBox.offsetWidth*("left"==e.Items[0].ItemRef["page-spread"]||"right"==e.Items[0].ItemRef["page-spread"]?2:1),i=e.Items[0].ItemBox.offsetHeight;t.style.width=Math.ceil(n)+"px",t.style.height=Math.ceil(i)+"px",e.style["border-radius"]=S["spread-border-radius"],e.style["box-shadow"]=S["spread-box-shadow"],O.stamp("Reset Spread "+e.SpreadIndex+" End")},R.DefaultPageRatio={X:103,Y:148},R.resetItem=function(e){O.stamp("Reset Item "+e.ItemIndex+" Start"),O.stamp("Reset Start",e.TimeCard),E.dispatch("bibi:before:resetItem",e),e.Reset=!1,e.Pages=[],e.scrolling="no",e.Spreaded=!1,e.style.margin=e.style.padding=e.style.width=e.style.height="",e.HTML.style[S.SIZE.b]=e.HTML.style[S.SIZE.l]="",sML.style(e.HTML,{"transform-origin":"",transformOrigin:"",transform:"","column-width":"","column-gap":"","column-rule":""}),e.Columned=!1,e.ColumnBreadth=0,e.ColumnLength=0,e.ColumnGap=0,e.PrePaginated?R.resetItem.asPrePaginatedItem(e):e.Outsourcing?R.resetItem.asReflowableOutsourcingItem(e):R.resetItem.asReflowableItem(e),e.Reset=!0,E.dispatch("bibi:resetItem",e),O.stamp("Reset End",e.TimeCard),O.stamp("Reset Item "+e.ItemIndex+" End")},R.resetItem.asReflowableItem=function(e){var t=(e.ItemIndex,e.ItemRef),n=e.ItemBox,i=e.Spread,o=R.Stage[S.SIZE.B],r=R.Stage[S.SIZE.L],a=R.Stage.PageGap;/fill/.test(t["bibi:layout"])||(o-=S["item-padding-"+S.BASE.s]+S["item-padding-"+S.BASE.e],r-=S["item-padding-"+S.BASE.b]+S["item-padding-"+S.BASE.a],a+=S["item-padding-"+S.BASE.b]+S["item-padding-"+S.BASE.a],e.style["padding-"+S.BASE.b]=S["item-padding-"+S.BASE.b]+"px",e.style["padding-"+S.BASE.a]=S["item-padding-"+S.BASE.a]+"px",e.style["padding-"+S.BASE.s]=S["item-padding-"+S.BASE.s]+"px",e.style["padding-"+S.BASE.e]=S["item-padding-"+S.BASE.e]+"px");var s=o,l=r;if("horizontal"==S.SLA&&!/fill-spread/.test(t["bibi:layout"])){var c=Math.floor(s*R.DefaultPageRatio[S.AXIS.L]/R.DefaultPageRatio[S.AXIS.B]),d=Math.floor((r-a)/2);d>=c&&(e.Spreaded=!0,l=d)}e.style[S.SIZE.b]=s+"px",e.style[S.SIZE.l]=l+"px",R.resetItem.asReflowableItem.adjustContent(e,s,l,a);var u=sML.UA.InternetExplorer?e.Body["client"+S.SIZE.L]:e.HTML["scroll"+S.SIZE.L],p=Math.ceil((u+a)/(l+a));u=(l+a)*p-a,e.style[S.SIZE.l]=u+"px";var h=s,g=u+("paged"==S.RVM&&e.Spreaded&&p%2?a+l:0);/fill/.test(t["bibi:layout"])||(h+=S["item-padding-"+S.BASE.s]+S["item-padding-"+S.BASE.e],g+=S["item-padding-"+S.BASE.b]+S["item-padding-"+S.BASE.a]),n.style[S.SIZE.b]=h+"px",n.style[S.SIZE.l]=g+"px";for(var f=0;p>f;f++){var m=n.appendChild(sML.create("span",{className:"page"}));/fill/.test(t["bibi:layout"])||(m.style["padding"+S.BASE.B]=S["item-padding-"+S.BASE.b]+"px",m.style["padding"+S.BASE.A]=S["item-padding-"+S.BASE.a]+"px",m.style["padding"+S.BASE.S]=S["item-padding-"+S.BASE.s]+"px",m.style["padding"+S.BASE.E]=S["item-padding-"+S.BASE.e]+"px"),m.style[S.SIZE.b]=s+"px",m.style[S.SIZE.l]=l+"px",m.style[S.BASE.b]=(l+a)*f+"px",m.Item=e,m.Spread=i,m.PageIndexInItem=e.Pages.length,e.Pages.push(m)}return e},R.resetItem.asReflowableItem.adjustContent=function(e,t,n,i){E.dispatch("bibi:before:resetItem.asReflowableItem.adjustContent",e);var o=sML.appendStyleRule("*","word-wrap: break-word;",e.contentDocument);R.resetItem.asReflowableItem.adjustContent.fitImages(e,t,n),R.resetItem.asReflowableItem.adjustContent.columify(e,t,n,i),S["page-breaking"]&&R.resetItem.asReflowableItem.adjustContent.breakPages(e,t),sML.deleteStyleRule(o,e.contentDocument)},R.resetItem.asReflowableItem.adjustContent.fitImages=function(e,t,n){sML.each(e.Body.getElementsByTagName("img"),function(){if(this.Bibi&&this.Bibi.DefaultStyle){this.style.width=this.Bibi.DefaultStyle.width,this.style.height=this.Bibi.DefaultStyle.height;var i=parseFloat(getComputedStyle(this)[S.SIZE.b]),o=parseFloat(getComputedStyle(this)[S.SIZE.l]),r=Math.floor(Math.min(parseFloat(getComputedStyle(e.Body)[S.SIZE.b]),t)),a=Math.floor(Math.min(parseFloat(getComputedStyle(e.Body)[S.SIZE.l]),n));(i>r||o>a)&&(this.style[S.SIZE.b]=Math.floor(parseFloat(getComputedStyle(this)[S.SIZE.b])*Math.min(r/i,a/o))+"px",this.style[S.SIZE.l]="auto")}})},R.resetItem.asReflowableItem.adjustContent.columify=function(e,t,n,i){("paged"==S.RVM||e.HTML["offset"+S.SIZE.B]>t)&&(R.Columned=e.Columned=!0,e.ColumnBreadth=t,e.ColumnLength=n,e.ColumnGap=i,e.HTML.style[S.SIZE.b]=t+"px",e.HTML.style[S.SIZE.l]=n+"px",sML.style(e.HTML,{"column-fill":"auto","column-width":e.ColumnLength+"px","column-gap":e.ColumnGap+"px","column-rule":""}))},R.resetItem.asReflowableItem.adjustContent.breakPages=function(e,t){var n;n=e.Body["offset"+S.SIZE.B]<=t?["vertical"==S.SLA?"Top":"Left",window["inner"+S.SIZE.L],S.SIZE.L,S.SIZE.l,S.BASE.a]:["vertical"==S.SLA?"Left":"Top",t,S.SIZE.B,S.SIZE.b,S.BASE.e],sML.each(e.contentDocument.querySelectorAll("html>body *"),function(){var e=getComputedStyle(this);if("always"==e.pageBreakBefore||"always"==e.pageBreakAfter){this.BibiPageBreakerBefore&&(this.BibiPageBreakerBefore.style[n[3]]=""),this.BibiPageBreakerAfter&&(this.BibiPageBreakerAfter.style[n[3]]="");for(var t=this,i=t["offset"+n[0]],o=0;t.offsetParent;)t=t.offsetParent,i+=t["offset"+n[0]];"rtl"==S.SLD&&(i=window.innerWidth+-1*i-this["offset"+n[2]]),"always"==e.pageBreakBefore&&(this.BibiPageBreakerBefore||(this.BibiPageBreakerBefore=this.parentNode.insertBefore(sML.create("span",{className:"bibi-page-breaker-before"},{display:"block"}),this)),o=n[1]-i%n[1],o==n[1]&&(o=0),this.BibiPageBreakerBefore.style[n[3]]=o+"px"),"always"==e.pageBreakAfter&&(i+=o+this["offset"+n[2]],this.style["margin-"+n[4]]=0,this.BibiPageBreakerAfter||(this.BibiPageBreakerAfter=this.parentNode.insertBefore(sML.create("span",{className:"bibi-page-breaker-after"},{display:"block"}),this.nextSibling)),o=n[1]-i%n[1],o==n[1]&&(o=0),this.BibiPageBreakerAfter.style[n[3]]=o+"px")}})},R.resetItem.asReflowableOutsourcingItem=function(e,t){var n=(e.ItemIndex,e.ItemRef),i=e.ItemBox,o=e.Spread;e.style.margin="auto",e.style.padding=0;var r=R.Stage[S.SIZE.B],a=R.Stage[S.SIZE.L],s=r,l=a;if("horizontal"==S.SLA&&!/fill-spread/.test(n["bibi:layout"])){var c=Math.floor(s*R.DefaultPageRatio[S.AXIS.L]/R.DefaultPageRatio[S.AXIS.B]),d=Math.floor((a-R.Stage.PageGap)/2);d>c&&(e.Spreaded=!0,l=d)}if(e.style[S.SIZE.b]=i.style[S.SIZE.b]=s+"px",e.style[S.SIZE.l]=i.style[S.SIZE.l]=l+"px",e.ImageItem){if(e.Body["scroll"+S.SIZE.B]<=s&&e.Body["scroll"+S.SIZE.L]<=l){var u=getComputedStyle(e.Body);e.style.width=e.Body.offsetWidth+parseFloat(u.marginLeft)+parseFloat(u.marginRight)+"px"}else{if("ttb"==S.SLD&&e.Body["scroll"+S.SIZE.B]>s||"horizontal"==S.SLA&&e.Body["scroll"+S.SIZE.L]>l)var p=/rl/.test(e.HTML.WritingMode)?"100% 0":"0 0";else var p="50% 0";var h=Math.floor(100*Math.min(s/e.Body["scroll"+S.SIZE.B],l/e.Body["scroll"+S.SIZE.L]))/100;sML.style(e.HTML,{"transform-origin":p,transform:"scale("+h+")"})}sML.each(e.Body.getElementsByTagName("img"),function(){var e=this;e.style.maxWidth="none",setTimeout(function(){e.style.maxWidth=""},0)})}else if(e.FrameItem){var g=e.Body.getElementsByTagName("iframe")[0];g.style[S.SIZE.b]=g.style[S.SIZE.l]="100%"}var f=i.appendChild(sML.create("span",{className:"page"}));return f.style[S.SIZE.b]=s+"px",f.style[S.SIZE.l]=l+"px",f.style[S.BASE.b]=0,f.Item=e,f.Spread=o,f.PageIndexInItem=e.Pages.length,e.Pages.push(f),e},R.resetItem.asPrePaginatedItem=function(e){var t=(e.ItemIndex,e.ItemRef),n=e.ItemBox,i=e.Spread;e.HTML.style.margin=e.HTML.style.padding=e.Body.style.margin=e.Body.style.padding=0;var o=R.Stage[S.SIZE.B],r=R.Stage[S.SIZE.L],a=o,s=r;if(e.style.padding=0,e.Scale){var l=e.Scale;delete e.Scale}else{var l=1;if("pre-paginated"==S.BRL&&"vertical"==S.SLA||R.Stage.Orientation==t["rendition:spread"]||"both"==t["rendition:spread"]){var c={Width:t.viewport.width,Height:t.viewport.height};e.Pair?c.Width+=e.Pair.ItemRef.viewport.width:("right"==t["page-spread"]||"left"==t["page-spread"])&&(c.Width+=c.Width),l=Math.min(a/c[S.SIZE.B],s/c[S.SIZE.L])}else l=Math.min(a/t.viewport[S.SIZE.b],s/t.viewport[S.SIZE.l]);e.Pair&&(e.Pair.Scale=l)}s=Math.floor(t.viewport[S.SIZE.l]*l),a=Math.floor(t.viewport[S.SIZE.b]*(s/t.viewport[S.SIZE.l])),n.style[S.SIZE.l]=e.style[S.SIZE.l]=s+"px",n.style[S.SIZE.b]=e.style[S.SIZE.b]=a+"px";var d=/rl/.test(e.HTML.WritingMode)?"100% 0":"0 0";sML.style(e.HTML,{width:t.viewport.width+"px",height:t.viewport.height+"px","transform-origin":d,transformOrigin:d,transform:"scale("+l+")"});var u=n.appendChild(sML.create("span",{className:"page"}));return"right"==t["page-spread"]?u.style.right=0:u.style.left=0,u.style[S.SIZE.b]=a+"px",u.style[S.SIZE.l]=s+"px",u.Item=e,u.Spread=i,u.PageIndexInItem=e.Pages.length,e.Pages.push(u),e},R.resetPages=function(){return R.Pages.forEach(function(e){e.parentNode.removeChild(e),delete e}),R.Pages=[],R.Spreads.forEach(function(e){e.Pages=[],e.Items.forEach(function(t){t.Pages.forEach(function(t){t.PageIndexInSpread=e.Pages.length,e.Pages.push(t),t.PageIndex=R.Pages.length,R.Pages.push(t),t.id="page-"+sML.String.pad(t.PageIndex+1,0,B.FileDigit)})})}),R.Pages},R.resetNavigation=function(){},R.layoutSpread=function(e){O.stamp("Layout Spread "+e.SpreadIndex+" Start");var t=e.SpreadBox;t.style.padding="";var n=0,i=0;if("horizontal"==S.SLA&&t.offsetHeight<R.Stage[S.SIZE.B]&&(SpreadBoxPaddingTop=Math.floor((R.Stage[S.SIZE.B]-t.offsetHeight)/2),SpreadBoxPaddingBottom=R.Stage[S.SIZE.B]-(SpreadBoxPaddingTop+t.offsetHeight),t.style.paddingTop=SpreadBoxPaddingTop+"px",t.style.paddingBottom=SpreadBoxPaddingBottom+"px"),"pre-paginated"==S.BRL){var o=Math.ceil((R.Stage[S.SIZE.L]-t["offset"+S.SIZE.L])/2);e.Pages.forEach(function(e){var t=Math.ceil((R.Stage[S.SIZE.L]-e["offset"+S.SIZE.L])/4);t>o&&(o=t)}),n=i=o}else"paged"==S.RVM?0!=e.SpreadIndex&&(n=R.Stage.PageGap):(n=0==e.SpreadIndex?Math.floor((R.Stage[S.SIZE.L]-t["offset"+S.SIZE.L])/2):R.Stage.PageGap,e.SpreadIndex==R.Spreads.length-1&&(i=Math.ceil((R.Stage[S.SIZE.L]-t["offset"+S.SIZE.L])/2)));n>0&&(t.style["padding"+S.BASE.B]=n+"px"),i>0&&(t.style["padding"+S.BASE.A]=i+"px");var r=0;R.Spreads.forEach(function(e){r+=e.SpreadBox["offset"+S.SIZE.L]}),R.Main.Book.style[S.SIZE.b]="",R.Main.Book.style[S.SIZE.l]=r+"px",O.stamp("Layout Spread "+e.SpreadIndex+" End")},R.layout=function(e){if(R.OnceLayouted&&R.ToRelayout||O.log("Laying out...","*:"),O.stamp("Layout Start"),R.OnceLayouted=!0,window.removeEventListener(O.Mobile?"orientationchange":"resize",R.onresize),R.Main.removeEventListener("scroll",R.onscroll),e||(e={}),!e.Destination){R.getCurrent();var t=R.Current.Pages.StartPage;e.Destination={SpreadIndex:t.Spread.SpreadIndex,PageProgressInSpread:t.PageIndexInSpread/t.Spread.Pages.length}}e.Setting&&S.update(e.Setting),O.log(['reader-view-mode: "'+S.RVM+'"','spread-layout-direction: "'+S.SLD+'"','apparent-reading-direction: "'+S.ARD+'"'].join(" / "),"-*"),e.Reset||R.ToRelayout?(R.ToRelayout=!1,R.resetStage(),R.Spreads.forEach(function(e){R.resetSpread(e),R.layoutSpread(e)}),R.resetPages(),R.resetNavigation()):R.Spreads.forEach(function(e){R.layoutSpread(e)}),R.Columned=!1;for(var n=0,i=R.Items.length;i>n;n++){var o=R.Items[n].HTML.style;if(o["-webkit-column-width"]||o["-moz-column-width"]||o["-ms-column-width"]||o["column-width"]){R.Columned=!0;break}}return R.focus(e.Destination,{Duration:0}),"function"==typeof doAfter&&doAfter(),window.addEventListener(O.Mobile?"orientationchange":"resize",R.onresize),R.Main.addEventListener("scroll",R.onscroll),O.stamp("Layout End"),O.log("Laid out.","/*"),E.dispatch("bibi:layout"),S},R.Relayouting=0,R.relayout=function(e){if(!R.Relayouting){C.note("Relaying Out..."),O.stamp("Relayout Start"),sML.addClass(O.HTML,"layouting"),R.Relayouting++,R.getCurrent();var t=R.Current.Pages,n=t.StartPage?{SpreadIndex:t.StartPage.Spread.SpreadIndex,PageProgressInSpread:t.StartPage.PageIndexInSpread/t.StartPage.Spread.Pages.length}:{SpreadIndex:0,PageProgressInSpread:0};setTimeout(function(){window.removeEventListener(O.Mobile?"orientationchange":"resize",R.onresize),R.Main.removeEventListener("scroll",R.onscroll),setTimeout(function(){R.layout({Destination:n,Reset:!0,Setting:e&&e.Setting?e.Setting:void 0}),R.Relayouting--,R.Relayouting||setTimeout(function(){window.addEventListener(O.Mobile?"orientationchange":"resize",R.onresize),R.Main.addEventListener("scroll",R.onscroll),e&&"function"==typeof e.callback&&e.callback(),sML.removeClass(O.HTML,"layouting"),O.stamp("Relayout End"),E.dispatch("bibi:relayout"),C.note("")},100)},100)},222)}},R.onscroll=function(){L.Opened&&(clearTimeout(R.Timer_onscroll),R.Timer_onscroll=setTimeout(function(){E.dispatch("bibi:scrolled")},123))},R.onresize=function(){L.Opened&&(clearTimeout(R.Timer_onresize),R.Timer_onresize=setTimeout(R.onresized,O.Mobile?888:8))},R.onresized=function(){R.relayout(),E.dispatch("bibi:resized")},R.changeView=function(e){return S["reader-view-mode-fixed"]||"string"!=typeof e||S.RVM==e||!/^(paged|horizontal|vertical)$/.test(e)?!1:L.Opened?("paged"!=e&&R.Spreads.forEach(function(e){e.style.opacity=""}),void R.relayout({Setting:{"reader-view-mode":e},callback:function(){E.dispatch("bibi:changeView",e)}})):(S.update({"reader-view-mode":e}),L.play())},R.getCurrentPages=function(){var e=sML.Coord.getScrollCoord(R.Main),t=sML.Coord.getClientSize(R.Main);e={Left:e.X,Right:e.X+t.Width,Top:e.Y,Bottom:e.Y+t.Height},e.Before=e[S.BASE.B]/R.Scale,e.After=e[S.BASE.A]/R.Scale;var n=[],i=[],o=[],r=0,a=!1;R.Pages.forEach(function(t){if(!a){var s=sML.getCoord(t);s.Before=s[S.BASE.B],s.After=s[S.BASE.A];var l=Math.min(e.After*S.AXIS.PM,s.After*S.AXIS.PM)-Math.max(e.Before*S.AXIS.PM,s.Before*S.AXIS.PM),c=0>=l||!s[S.SIZE.L]||isNaN(l)?0:Math.round(l/s[S.SIZE.L]*100);0>=c?n.length&&(a=!0):c>r?(n[0]=t,i[0]=c,o[0]=R.getCurrentPages.getStatus(c,s,e),r=c):c==r&&(n.push(t),i.push(c),o.push(R.getCurrentPages.getStatus(c,s,e)))}});var s={Ratio:i,Status:o,StartPage:n[0],StartPageRatio:i[0],StartPageStatus:o[0],EndPage:n[n.length-1],EndPageRatio:i[i.length-1],EndPageStatus:o[o.length-1]};for(var l in s)n[l]=s[l];return n},R.getCurrentPages.getStatus=function(e,t,n){if(e>=100)return"including";var i=[];window["inner"+S.SIZE.L]<t[S.SIZE.L]&&i.push("oversize");var o=n.Before,r=n.After;return o*S.AXIS.PM<t.Before*S.AXIS.PM&&i.push("entering"),o*S.AXIS.PM==t.Before*S.AXIS.PM&&i.push("entered"),r*S.AXIS.PM==t.After*S.AXIS.PM&&i.push("passsing"),r*S.AXIS.PM>t.After*S.AXIS.PM&&i.push("passed"),i.join(" ")},R.getCurrent=function(){return R.Current.Pages=R.getCurrentPages(),R.Current.Page=R.Current.Pages.EndPage,R.Current.PageNumber=R.Current.Page.PageIndex+1,R.Current.Item=R.Current.Page.Item,R.Current.ItemNumber=R.Current.Item.ItemIndex+1,R.Current.Percent=Math.round(R.Current.PageNumber/R.Pages.length*100),R.Pages.forEach(function(e){[e,e.Item,e.Item.ItemBox,e.Spread,e.Spread.SpreadBox].forEach(function(e){sML.removeClass(e,"current"),sML.addClass(e,"not-current")})}),R.Current.Pages.forEach(function(e){[e,e.Item,e.Item.ItemBox,e.Spread,e.Spread.SpreadBox].forEach(function(e){sML.removeClass(e,"not-current"),sML.addClass(e,"current")})}),R.Current},R.focus=function(e,t){if(R.Moving)return!1;if(e=R.focus.hatchDestination(e),!e)return!1;R.Moving=!0;var n=0;"reflowable"==S["book-rendition-layout"]?"head"==e.Edge?n="rtl"!=S.SLD?0:R.Main.Book["offset"+[S.SIZE.L]]-sML.Coord.getClientSize(R.Main)[S.SIZE.L]:"foot"==e.Edge?n="rtl"==S.SLD?0:R.Main.Book["offset"+[S.SIZE.L]]-sML.Coord.getClientSize(R.Main)[S.SIZE.L]:(n=O.getElementCoord(e.Page)[S.AXIS.L],"after"==e.Side&&(n+=(e.Page["offset"+S.SIZE.L]-window["inner"+S.SIZE.L])*S.AXIS.PM),"rtl"==S.SLD&&(n+=e.Page.offsetWidth-window.innerWidth)):window["inner"+S.SIZE.L]>e.Page.Spread["offset"+S.SIZE.L]?(n=O.getElementCoord(e.Page.Spread)[S.AXIS.L],n-=Math.floor((window["inner"+S.SIZE.L]-e.Page.Spread["offset"+S.SIZE.L])/2)):(n=O.getElementCoord(e.Page)[S.AXIS.L],window["inner"+S.SIZE.L]>e.Page["offset"+S.SIZE.L]&&(n-=Math.floor((window["inner"+S.SIZE.L]-e.Page["offset"+S.SIZE.L])/2))),"number"==typeof e.TextNodeIndex&&R.selectTextLocation(e);var i={X:0,Y:0};i[S.AXIS.L]=n*R.Scale;var o=function(){R.getCurrent(),R.Moving=!1};return"paged"==S.RVM?sML.scrollTo(R.Main,i,{Duration:0,callback:o}):(t||(t={}),t.callback=o,sML.scrollTo(R.Main,i,t)),!1},R.focus.hatchDestination=function(e){return e?("number"==typeof e||"string"==typeof e&&/^\d+$/.test(e)?e=R.getBibiToDestination(e):"string"==typeof e?"head"==e||"foot"==e?e={Edge:e}:X.EPUBCFI&&(e=R.getEPUBCFIDestination(e)):e.tagName&&(e="number"==typeof e.PageIndex?{Page:e}:"number"==typeof e.ItemIndex?{Item:e}:"number"==typeof e.SpreadIndex?{Spread:e}:{Element:e}),e.Page&&!e.Page.parentElement&&delete e.Page,e.Item&&!e.Item.parentElement&&delete e.Item,e.Spread&&!e.Spread.parentElement&&delete e.Spread,e.Element&&!e.Element.parentElement&&delete e.Element,"string"==typeof e.Edge?"head"==e.Edge?e.Page=R.Pages[0]:(e.Page=R.Pages[R.Pages.length-1],e.Edge="foot"):(e.Element||(e.Item||("number"==typeof e.ItemIndexInAll?e.Item=R.AllItems[e.ItemIndexInAll]:"number"==typeof e.ItemIndex?e.Item=R.Items[e.ItemIndex]:(e.Spread||"number"!=typeof e.SpreadIndex||(e.Spread=R.Spreads[e.SpreadIndex]),e.Spread&&("number"==typeof e.PageIndexInSpread?e.Page=e.Spread.Pages[e.PageIndexInSpread]:"number"==typeof e.ItemIndexInSpread?e.Item=e.Spread.Items[e.ItemIndexInSpread]:e.Item=e.Spread.Items[0]))),e.Item&&"string"==typeof e.ElementSelector&&(e.Element=e.Item.contentDocument.querySelector(e.ElementSelector))),e.Element?e.Page=R.focus.getNearestPageOfElement(e.Element):e.Page||("number"==typeof e.PageIndexInSpread?e.Page=e.Spread.Pages[e.PageIndexInSpread]:"number"==typeof e.PageProgressInSpread?e.Page=e.Spread.Pages[Math.floor(e.Spread.Pages.length*e.PageProgressInSpread)]:e.Page=e.Item.Pages[0])),e.Page?(e.Item=e.Page.Item,e.Spread=e.Page.Spread,e):null):null},R.focus.getNearestPageOfElement=function(e){var t=e.ownerDocument.body.Item;if(!t)return R.Pages[0];if(t.Columned){sML.style(t.HTML,{"column-width":""});var n=O.getElementCoord(e)[S.AXIS.B];"rtl"==S.PPD&&"vertical"==S.SLA&&(n=t.offsetWidth-(S["item-padding-left"]+S["item-padding-right"])-n-e.offsetWidth),sML.style(t.HTML,{"column-width":t.ColumnLength+"px"});var i=t.Pages[Math.ceil(n/t.ColumnBreadth-1)]}else{var n=O.getElementCoord(e)[S.AXIS.L];"rtl"==S.SLD&&"horizontal"==S.SLA&&(n=t.HTML.offsetWidth-n-e.offsetWidth);for(var i=t.Pages[0],o=0,r=t.Pages.length;r>o;o++)if(n-=t.Pages[o]["offset"+S.SIZE.L],0>=n){i=t.Pages[o];break}}return i},R.selectTextLocation=function(e){if("number"==typeof e.TextNodeIndex){var t=e.Element.childNodes[e.TextNodeIndex];if(t&&t.textContent){var n={Start:{Node:t,Index:0},End:{Node:t,Index:t.textContent.length}};if(e.TermStep)if(e.TermStep.Preceding||e.TermStep.Following){if(n.Start.Index=e.TermStep.Index,n.End.Index=e.TermStep.Index,e.TermStep.Preceding&&(n.Start.Index-=e.TermStep.Preceding.length),e.TermStep.Following&&(n.End.Index+=e.TermStep.Following.length),n.Start.Index<0||t.textContent.length<n.End.Index)return;if(t.textContent.substr(n.Start.Index,n.End.Index-n.Start.Index)!=e.TermStep.Preceding+e.TermStep.Following)return}else if(e.TermStep.Side&&"a"==e.TermStep.Side){for(n.Start.Node=t.parentNode.firstChild;n.Start.Node.childNodes.length;)n.Start.Node=n.Start.Node.firstChild;n.End.Index=e.TermStep.Index-1}else{for(n.Start.Index=e.TermStep.Index,n.End.Node=t.parentNode.lastChild;n.End.Node.childNodes.length;)n.End.Node=n.End.Node.lastChild;n.End.Index=n.End.Node.textContent.length}return sML.select(n)}}},R.move=function(e,t){if(R.Moving||!L.Opened||isNaN(e))return!1;if(e*=1,-1!=e&&(e=1),e>0)var n="EndPage",i="before";else var n="StartPage",i="after";R.getCurrent();var o=R.Current.Pages[n];if(R.Columned||"pre-paginated"==S.BRL||o.Item.PrePaginated||o.Item.Outsourcing||1==o.Item.Pages.length||0>e&&0==o.PageIndexInItem||e>0&&o.PageIndexInItem==o.Item.Pages.length-1){var r=R.Current.Pages[n+"Status"],a=R.Current.Pages[n+"Ratio"];/(oversize)/.test(r)?e>0?a>=90?i="before":/entering/.test(r)?(i="before",e=0):/entered/.test(r)&&(i="after",e=0):a>=90?i="after":/passing/.test(r)?(i="before",e=0):/passed/.test(r)&&(i="after",e=0):e>0?/enter/.test(r)&&(i="before",e=0):/pass/.test(r)&&(i="after",e=0);var s=o.PageIndex+e;0>s?s=0:s>R.Pages.length-1&&(s=R.Pages.length-1);var l=R.Pages[s];"pre-paginated"==S.BRL&&l.Item.Pair&&"horizontal"==S.SLA&&window["inner"+S.SIZE.L]>l.Spread["offset"+S.SIZE.L]&&(0>e&&0==l.PageIndexInSpread&&(l=l.Spread.Pages[1]),e>0&&1==l.PageIndexInSpread&&(l=l.Spread.Pages[0])),R.focus({Page:l,Side:i},t)}else R.Moving=!0,t||(t={}),t.callback=function(){R.getCurrent(),R.Moving=!1},sML.scrollTo(R.Main,function(t){var t=sML.Coord.getScrollCoord(R.Main);switch(S.SLD){case"ttb":return{Y:t.Y+(window.innerHeight+R.Stage.PageGap)*e};case"ltr":return{X:t.X+(window.innerWidth+R.Stage.PageGap)*e};case"rtl":return{X:t.X+(window.innerWidth+R.Stage.PageGap)*e*-1}}}(),t);E.dispatch("bibi:move",e)},R.page=R.scroll=R.move,R.to=function(e){return R.focus(R.getBibiToDestination(e))},R.getBibiToDestination=function(e){if("number"==typeof e&&(e=""+e),"string"!=typeof e||!/^[1-9][0-9]*(-[1-9][0-9]*(\.[1-9][0-9]*)*)?$/.test(e))return null;var t="",n=e.split("-"),i=parseInt(n[0])-1,o=n[1]?n[1]:null;return o&&o.split(".").forEach(function(e){t+=">*:nth-child("+e+")"}),{BibitoString:e,ItemIndexInAll:i,ElementSelector:t?"body"+t:void 0}},R.Scale=1,R.zoom=function(e){("number"!=typeof e||0>=e)&&(e=1),R.getCurrent();var t=R.Current.Pages.StartPage;sML.style(R.Main.Book,{"transform-origin":"rtl"==S.SLD?"100% 0":"0 0"}),1==e?(O.HTML.style.overflow="",sML.style(R.Main.Book,{transform:""})):(sML.style(R.Main.Book,{transform:"scale("+e+")"}),O.HTML.style.overflow="auto"),setTimeout(function(){R.focus({Page:t},{Duration:0})},0),R.Scale=e},C={},C.initialize=function(){C.createNotifier(),C.createVeil(),C.createPanel(),C.createSwitches(),C.createHelp(),C.createPowered()},C.createNotifier=function(){C.Notifier=O.Body.appendChild(sML.create("div",{id:"bibi-notifier"})),C.Notifier.Board=C.Notifier.appendChild(sML.create("div",{className:"hidden",id:"bibi-notifier-board"})),C.note=function(e,t){e?C.note.Time="number"==typeof t?t:3210:C.note.Time=0,C.Notifier.Board.innerHTML="<p>"+e+"</p>",clearTimeout(C.Notifier.Board.hide_Timer),C.Notifier.Board.style.display="block",setTimeout(function(){C.Notifier.Board.className="",setTimeout(function(){C.Notifier.Board.hide_Timer=setTimeout(function(){C.Notifier.Board.className="hidden",setTimeout(function(){C.Notifier.Board.style.display="none"},200)},C.note.Time)},0)},0),O.Mobile||(O.statusClearer&&clearTimeout(O.statusClearer),window.status="BiB/i: "+e,O.statusClearer=setTimeout(function(){window.status=""},C.note.Time))}},C.createVeil=function(){C.Veil=O.Body.appendChild(sML.create("div",{id:"bibi-veil",State:1,open:function(e){return 1==this.State?"function"==typeof e?e():this.State:(this.State=1,this.style.display="block",this.style.zIndex=100,sML.style(this,{transition:"0.5s ease-out",transform:"",opacity:.75},function(){"function"==typeof e&&e()}),this.State)},close:function(e){if(0==this.State)return"function"==typeof e?e():this.State;this.State=0;var t=function(e){if("vertical"!=S.RVM)var t="X",n="ltr"==S.PPD?-1:1;else var t="Y",n=-1;return"translate"+t+"("+e*n+"%)"};return sML.style(this,{transition:"0.5s ease-in",transform:t(240),opacity:0},function(){sML.style(this,{transition:"none",transform:t(-240)}),this.style.zIndex=1,this.style.display="none","function"==typeof e&&e()}),this.State},toggle:function(e){return 0==this.State?this.open(e):this.close(e)}})),C.Veil.Cover=C.Veil.appendChild(sML.create("div",{id:"bibi-veil-cover"}));var e=(O.Mobile?"Tap":"Click")+" to Open";C.Veil.PlayButton=C.Veil.appendChild(sML.create("p",{id:"bibi-veil-play",title:e,innerHTML:'<span class="non-visual">'+e+"</span>",play:function(e){e.stopPropagation(),L.play(),E.dispatch("bibi:play:button")},hide:function(){this.removeEventListener("click",C.Veil.PlayButton.play),sML.style(this,{opacity:0,cursor:"default"})}})),C.Veil.PlayButton.addEventListener("click",C.Veil.PlayButton.play),E.add("bibi:play",function(){C.Veil.PlayButton.hide()}),E.dispatch("bibi:createVeil")},C.createPanel=function(){C.Panel=O.Body.appendChild(sML.create("div",{id:"bibi-panel",Locked:!1,State:0,open:function(e){return 1==this.State?("function"==typeof e&&e(),1):(C.Panel.Locked=!0,this.State=1,sML.addClass(O.HTML,"panel-opened"),E.dispatch("bibi:openPanel"),this.callback(e),setTimeout(function(){C.Panel.Locked=!1},1),this.State)},close:function(e){return 0==this.State?("function"==typeof e&&e(),0):(C.Panel.Locked=!0,this.State=0,sML.removeClass(O.HTML,"panel-opened"),E.dispatch("bibi:closePanel"),this.callback(e),setTimeout(function(){C.Panel.Locked=!1},1),this.State)},toggle:function(e){return this.State?this.close():this.open(),this.callback(e),this.State},callback:function(e){"function"==typeof e&&setTimeout(e,250)}})),E.add("bibi:command:openPanel",function(){C.Panel.open()}),E.add("bibi:command:closePanel",function(){C.Panel.close()}),E.add("bibi:command:togglePanel",function(){C.Panel.toggle()}),C.observeTap(C.Panel).addTapEventListener(function(){C.Panel.Locked||E.dispatch("bibi:command:togglePanel")}),sML.appendStyleRule("html.page-rtl div#bibi-panel:after","bottom: "+O.Scrollbars.Height+"px;"),C.Panel.BookInfo=C.Panel.appendChild(sML.create("div",{id:"bibi-panel-bookinfo"})),C.Panel.BookInfo.Box=C.Panel.BookInfo.appendChild(sML.create("div",{id:"bibi-panel-bookinfo-box"})),C.Panel.BookInfo.Navigation=C.Panel.BookInfo.Box.appendChild(sML.create("div",{id:"bibi-panel-bookinfo-navigation"})),C.Panel.BookInfo.Cover=C.Panel.BookInfo.Box.appendChild(sML.create("div",{id:"bibi-panel-bookinfo-cover"})),C.Panel.MenuAlpha=C.Panel.appendChild(sML.create("div",{id:"bibi-panel-menu-alpha",on:{click:function(e){e.stopPropagation()}}})),C.Panel.MenuBeta=C.Panel.appendChild(sML.create("div",{id:"bibi-panel-menu-beta",on:{click:function(e){e.stopPropagation()}}})),E.dispatch("bibi:createPanel")},C.createSwitches=function(){C.SwitchAlpha=O.Body.appendChild(sML.create("div",{id:"bibi-switch-alpha",on:{click:function(e){e.stopPropagation()}}})),C.SwitchBeta=O.Body.appendChild(sML.create("div",{id:"bibi-switch-beta",on:{click:function(e){e.stopPropagation()}}})),C.PanelSwitch=C.addButton({className:"bibi-button-toggle-panel",Type:"toggle",Area:C.SwitchAlpha,Labels:{"default":{ja:"",en:"Open Menu"},active:{ja:"",en:"Close Menu"}},execute:function(){C.Panel.toggle()}}),E.add("bibi:openPanel",function(){C.setState(C.PanelSwitch,"active")}),E.add("bibi:closePanel",function(){C.setState(C.PanelSwitch,"")}),E.add("bibi:start",function(){sML.style(C.PanelSwitch,{display:"block"})})},C.createHelp=function(){C.Help=O.Body.appendChild(sML.create("div",{id:"bibi-help"})),C.Help.Message=C.Help.appendChild(sML.create("p",{className:"hidden",id:"bibi-help-message"})),C.Help.show=function(e){C.Help.Message.innerHTML=e,C.Help.className="shown"},C.Help.hide=function(){C.Help.className=""},sML.appendStyleRule("html.page-rtl div#bibi-help","bottom: "+O.Scrollbars.Height+"px;")},C.createPowered=function(){C.Powered=O.Body.appendChild(sML.create("div",{id:"bibi-powered",innerHTML:["<p>",'<a href="http://bibi.epub.link" target="_blank" title="BiB/i | Web Site">',"<span>BiB/i</span>",'<img class="bibi-logo-white" alt="" src="../../bib/i/res/images/bibi-logo_white.png" />','<img class="bibi-logo-black" alt="" src="../../bib/i/res/images/bibi-logo_black.png" />',"</a>","</p>"].join("")})),sML.appendStyleRule("html.page-rtl div#bibi-powered","bottom: "+O.Scrollbars.Height+"px;")},C.addButtonGroup=function(e){e||(e={});var t=e.Area&&e.Area.tagName?e.Area:C.Panel.MenuBeta,n=t.appendChild(document.createElement("ul"));return n},C.addButton=function(e,t){e||(e={});var n=e.Group&&/^ul$/i.test(e.Group.tagName)?e.Group:C.addButtonGroup(e);n.Buttons||(n.Buttons=[]);var i=n.appendChild(document.createElement("li"));"string"==typeof e.Type&&/^(normal|toggle|radio)$/.test(e.Type)||(e.Type="normal");var o=["bibi-button","bibi-button-"+e.Type];"string"==typeof e.className&&e.className&&o.push(e.className);var r=i.appendChild(sML.create("string"==typeof e.tagName?e.tagName:"span",{className:o.join(" "),BibiButton:!0,Area:n.Area,Group:n,Box:i,Type:e.Type}));n.Buttons.push(r);for(var a in e)switch(a){case"tagName":case"className":case"extraHTML":case"Area":case"Group":case"Box":continue;default:r[a]=e[a]}if(r.Label=r.appendChild(sML.create("span",{className:"bibi-button-label"})),"string"==typeof e.extraHTML&&(r.innerHTML=r.innerHTML+e.extraHTML),C.setLabels(r),C.observeTap(r),C.setFeedback(r),"function"!=typeof t)for(EventName in t)"function"==typeof t[EventName]&&("tap"!=eventname?r.addEventListener(EventName,function(e){return e.stopPropagation(),"toggle"!=r.Type&&"radio"!=r.Type||"active"!=r.State||"active"!=r.PreviousState?t[EventName].apply(r,arguments):!1}):r.execute=t.tap);else r.execute=t;return"function"==typeof r.execute&&r.addTapEventListener(r.execute),r},C.setLabels=function(e){if(e.Labels&&e.Labels["default"])for(var t in e.Labels)e.Labels[t]?"string"==typeof e.Labels[t]?e.Labels[t]=e.Labels[t]:e.Labels[t][O.Language]?e.Labels[t]=e.Labels[t][O.Language]:e.Labels[t]["default"]?e.Labels[t]=e.Labels[t]["default"]:e.Labels[t].en?e.Labels[t]=e.Labels[t].en:e.Labels[t]="":e.Labels[t]="";else e.Labels={"default":""};return e},C.observeTap=function(e){return e.addEventListener(S.touchstart,function(t){clearTimeout(e.TapCounter),e.TouchStart={Time:new Date,X:t.pageX,Y:t.pageY},e.TapCounter=setTimeout(function(){e.TouchStart=void 0},300)}),e.addEventListener(S.touchend,function(t){e.TouchEnd={Time:new Date,X:t.pageX,Y:t.pageY},e.TouchStart&&e.TouchEnd.Time-e.TouchStart.Time<300&&Math.abs(e.TouchEnd.X-e.TouchStart.X)<5&&Math.abs(e.TouchEnd.Y-e.TouchStart.Y)<5&&E.dispatch("bibi:tap",t,e)}),e.addTapEventListener=function(t){return E.add("bibi:tap",function(n){return t.call(e,n)},e),e},e},C.setFeedback=function(e){return e.isAvailable||(e.isAvailable=function(){return!0}),e.changeState=function(){switch(e.Type){case"toggle":return function(e){var t=this;C.setState(t,"default"==t.State?"active":"default")};case"radio":return function(e){var t=this;C.setState(t,"active"),t.Group.Buttons.forEach(function(e){e!=t&&C.setState(e,"")})};default:return function(t){var n=this;C.setState(n,"active"),clearTimeout(n.Timer_deactivate),e.Timer_deactivate=setTimeout(function(){C.setState(n,"")},200)}}}(),e.activate=function(t){return e.isAvailable(t)?(e.changeState(t),e.hideHelp(t),e):e},e.hover=function(t){return e.Hover||!e.isAvailable(t)?e:(e.Hover=!0,sML.addClass(e,"hover"),e.showHelp(t),e)},e.unhover=function(t){return e.Hover?(e.Hover=!1,sML.removeClass(e,"hover"),e.hideHelp(t),e):e},
e.showHelp=function(t){return e.Labels&&e.Labels[e.State]&&C.Help.show(e.Labels[e.State]),e},e.hideHelp=function(t){return C.Help.hide(),e},E.add("bibi:tap",e.activate,e),O.Mobile||(e.addEventListener("mouseover",function(t){e.hover(t)}),e.addEventListener("mouseout",function(t){e.unhover(t)})),C.setState(e,"default"),e},C.setState=function(e,t){return t||(t="default"),e.PreviousState=e.State,t!=e.State?(e.State=t,e.Labels&&e.Labels[e.State]&&(e.title=e.Labels[e.State],e.Label&&(e.Label.innerHTML=e.Labels[e.State])),sML.replaceClass(e,e.PreviousState,e.State),e.State):void 0},P={},P.initialize=function(e){O.apply(e,P),/^([\w\d]+:)?\/+/.test(P.bookshelf)||(P.bookshelf=O.getPath(location.href.split("?")[0].replace(/[^\/]*$/,"")+P.bookshelf)),/^(horizontal|vertical|paged)$/.test(P["reader-view-mode"])||(P["reader-view-mode"]="paged"),["reader-view-mode-fided","autostart","play-in-new-window"].forEach(function(e){"string"==typeof P[e]?P[e]=/^(yes|no|mobile|desktop)$/.test(P[e])?P[e]:"no":P[e]=P[e]?"yes":"no"}),["spread-gap","spread-margin","item-padding-left","item-padding-right","item-padding-top","item-padding-bottom"].forEach(function(e){P[e]="number"!=typeof P[e]||P[e]<0?0:Math.round(P[e])}),P["trustworthy-origins"]instanceof Array||(P["trustworthy-origins"]=[]),P["trustworthy-origins"][0]!=location.origin&&P["trustworthy-origins"].unshift(location.origin),P.ExtensionsToLoad=0,P.LoadedExtensions=0;var t={};for(var n in P.extensions)if("string"==typeof n&&/^[^\/]+$/.test(n)&&P.extensions[n]){switch(n){case"bibi":continue;case"unzipper":if(sML.UA.InternetExplorer)continue}P.ExtensionsToLoad++,t[n]=P.extensions[n]}if(P.extensions=t,!P.ExtensionsToLoad)return E.dispatch("bibi:initializePreset"),void(P.Initialized=!0);for(var n in P.extensions)document.head.appendChild(sML.create("script",{src:"./extensions/"+n+"/"+n+".js",async:"async",onload:function(){P.LoadedExtensions++,P.LoadedExtensions==P.ExtensionsToLoad&&(E.dispatch("bibi:initializePreset"),P.Initialized=!0)}}))},U={},U.initialize=function(){var e=U.parseQuery(location.search),t=U.parseHash(location.hash);U.book=function(){var t=e.book?e.book:O.Body.getAttribute("data-bibi-book");if("string"==typeof t&&(!/^([\w\d]+:)?\/\//.test(t)||(/^\/\//.test(t)&&(t=location.protocol+t),t.replace(/^([\w\d]+:\/\/[^\/]+).*$/,"$1")==location.origin)))return t}();var n=function(e){return"string"!=typeof e?{}:void e.replace(" ","").split(",").forEach(function(e){if(e=e.split(":"),e[0]){if(e[1])switch(e[0]){case"parent-uri":case"parent-origin":e[1]=U.decode(e[1]);break;case"reader-view-mode":/^(horizontal|vertical|paged)$/.test(e[1])||(e[1]=void 0);break;case"reader-view-mode-fixed":case"autostart":case"play-in-new-window":case"hide-arrows":"true"==e[1]?e[1]="yes":"false"==e[1]?e[1]="no":/^(yes|no|mobile|desktop)$/.test(e[1])||(e[1]=void 0);break;case"to":e[1]=R.getBibiToDestination(e[1]);break;case"nav":e[1]=/^[1-9]\d*$/.test(e[1])?1*e[1]:void 0;break;case"preset":case"pipi-id":break;default:e[0]=void 0}else switch(e[0]){case"horizontal":case"vertical":case"paged":e[1]=e[0],e[0]="reader-view-mode";break;case"reader-view-mode-fixed":case"autostart":case"play-in-new-window":case"hide-arrows":e[1]="yes";break;default:e[0]=void 0}e[0]&&"string"==typeof e[1]&&(U[e[0]]=e[1])}})};t.epubcfi&&(U.epubcfi=t.epubcfi,E.add("bibi:ready",function(){X.EPUBCFI&&(U.to=R.getEPUBCFIDestination(t.epubcfi))})),t.bibi&&n(t.bibi),t.pipi&&(n(t.pipi),U["parent-origin"]&&U["parent-origin"]!=location.origin&&P["trustworthy-origins"].push(U["parent-origin"]),history.replaceState&&history.replaceState(null,null,location.href.replace(/[\,#]pipi\([^\)]*\)$/g,"")))},U.decode=function(e){return decodeURIComponent(e.replace("_BibiKakkoClose_",")").replace("_BibiKakkoOpen_","("))},U.parseQuery=function(e){if("string"!=typeof e)return{};e=e.replace(/^\?/,"");var t={};return e.split("&").forEach(function(e){e=e.split("="),/^[a-z]+$/.test(e[0])&&(t[e[0]]=e[1])}),t},U.parseHash=function(e){if("string"!=typeof e)return{};e=e.replace(/^#/,"");var t={},n=0,i=function(){for(var i=n,o="";/[a-z_]/.test(e.charAt(n));)n++;if("("!=e.charAt(n))return{};for(o=e.substr(i,n-1-i+1),n++;")"!=e.charAt(n);)n++;o&&(t[o]=e.substr(i,n-i+1).replace(/^[a-z_]+\(/,"").replace(/\)$/,"")),n++};for(i();","==e.charAt(n);)n++,i();return t},S={},S.initialize=function(){S.reset(),S["reader-view-mode-fixed"]=S.decide("reader-view-mode-fixed","Always"),S.autostart=S.decide("autostart"),S["play-in-new-window"]=S.decide("play-in-new-window"),S["hide-arrows"]=S.decide("hide-arrows","Always"),O.Mobile?(S.touchstart="touchstart",S.touchend="touchend"):(S.touchstart="mousedown",S.touchend="mouseup")},S.decide=function(e,t){return U[e]?"yes"==U[e]||"mobile"==U[e]&&O.Mobile||"desktop"==U[e]&&!O.Mobile:O.WindowEmbedded||t?"yes"==S[e]||"mobile"==S[e]&&O.Mobile||"desktop"==S[e]&&!O.Mobile:"autostart"==e},S.reset=function(){for(var e in S)"function"!=typeof S[e]&&delete S[e];O.apply(P,S),O.apply(U,S),delete S.book,delete S.bookshelf},S.update=function(e){var t=S.BRL,n=S.RVM,i=S.PPD,o=S.SLA,r=S.SLD,a=S.ARD;if("object"==typeof e)for(var s in e)"function"!=typeof S[s]&&(S[s]=e[s]);S.BRL=S["book-rendition-layout"]=B.Package.Metadata["rendition:layout"],S.BWM=S["book-writing-mode"]=/^tb/.test(B.WritingMode)&&!O.VerticalTextEnabled?"lr-tb":B.WritingMode,S.FontFamilyStyleIndex&&sML.deleteStyleRule(S.FontFamilyStyleIndex),S["ui-font-family"]&&(S.FontFamilyStyleIndex=sML.appendStyleRule("html","font-family: "+S["ui-font-family"]+" !important;")),S.RVM=S["reader-view-mode"],"reflowable"==S.BRL?"tb-rl"==S.BWM?(S.PPD=S["page-progression-direction"]="rtl",S.SLA=S["spread-layout-axis"]="paged"==S.RVM?"vertical":S.RVM):"tb-lr"==S.BWM?(S.PPD=S["page-progression-direction"]="ltr",S.SLA=S["spread-layout-axis"]="paged"==S.RVM?"vertical":S.RVM):"rl-tb"==S.BWM?(S.PPD=S["page-progression-direction"]="rtl",S.SLA=S["spread-layout-axis"]="paged"==S.RVM?"horizontal":S.RVM):(S.PPD=S["page-progression-direction"]="ltr",S.SLA=S["spread-layout-axis"]="paged"==S.RVM?"horizontal":S.RVM):(S.PPD=S["page-progression-direction"]="rtl"==B.PPD?"rtl":"ltr",S.SLA=S["spread-layout-axis"]="paged"==S.RVM?"horizontal":S.RVM),S.SLD=S["spread-layout-direction"]="vertical"==S.SLA?"ttb":S.PPD,S.ARD=S["apparent-reading-direction"]="vertical"==S.RVM?"ttb":S.PPD,"horizontal"==S.SLA?(S.SIZE={b:"height",B:"Height",l:"width",L:"Width",w:"length",W:"Length",h:"breadth",H:"Breadth"},"ltr"==S.PPD?(S.AXIS={B:"Y",L:"X",PM:1},S.BASE={b:"left",B:"Left",a:"right",A:"Right",s:"top",S:"Top",e:"bottom",E:"Bottom",c:"middle",m:"center"}):(S.AXIS={B:"Y",L:"X",PM:-1},S.BASE={b:"right",B:"Right",a:"left",A:"Left",s:"top",S:"Top",e:"bottom",E:"Bottom",c:"middle",m:"center"})):(S.SIZE={b:"width",B:"Width",l:"height",L:"Height",w:"breadth",W:"Breadth",h:"length",H:"Length"},S.AXIS={B:"X",L:"Y",PM:1},"ltr"==S.PPD?S.BASE={b:"top",B:"Top",a:"bottom",A:"Bottom",s:"left",S:"Left",e:"right",E:"Right",c:"center",m:"middle"}:S.BASE={b:"top",B:"Top",a:"bottom",A:"Bottom",s:"right",S:"Right",e:"left",E:"Left",c:"center",m:"middle"}),t!=S.BRL&&sML.replaceClass(O.HTML,"book-"+t,"book-"+S.BRL),n!=S.RVM&&sML.replaceClass(O.HTML,"view-"+n,"view-"+S.RVM),i!=S.PPD&&sML.replaceClass(O.HTML,"page-"+i,"page-"+S.PPD),o!=S.SLA&&sML.replaceClass(O.HTML,"spread-"+o,"spread-"+S.SLA),r!=S.SLD&&sML.replaceClass(O.HTML,"spread-"+r,"spread-"+S.SLD),a!=S.ARD&&sML.replaceClass(O.HTML,"appearance-"+a,"appearance-"+S.ARD),E.dispatch("bibi:updateSetting",S)},O={},O.log=function(e,t){var n="BiB/i: ";switch(t){case"-*":t="-"+O.log.Depth;break;case"*:":t=O.log.Depth+":";break;case"/*":t="/"+(O.log.Depth-1)}switch(t){case"-x":n+="[ERROR] ";break;case"-0":n+=" ";break;case"-1":n+=" - ",O.log.Depth=1;break;case"1:":n+=" ",O.log.Depth=2;break;case"-2":n+=" - ",O.log.Depth=2;break;case"2:":n+=" ",O.log.Depth=3;break;case"-3":n+=" - ",O.log.Depth=3;break;case"3:":n+=" ",O.log.Depth=4;break;case"-4":n+=" - ",O.log.Depth=4;break;case"4:":n+=" ",O.log.Depth=5;break;case"/4":n+=" ",O.log.Depth=4;break;case"/3":n+=" ",O.log.Depth=3;break;case"/2":n+=" ",O.log.Depth=2;break;case"/1":n+=" ",O.log.Depth=1}console.log(n+e)},(parent&&parent!=window||!console||!console.log)&&(O.log=function(){return!1}),O.log.Depth=1,O.error=function(e){E.dispatch("bibi:stopLoading"),E.dispatch("bibi:error",e),O.log(e,"-x")},O.apply=function(e,t){for(var n in e)"function"!=typeof t[n]&&"function"!=typeof e[n]&&(t[n]=e[n])},O.download=function(e,t){return new Promise(function(n,i){var o=new XMLHttpRequest;t&&o.overrideMimeType(t),o.open("GET",e,!0),/\.x?html$/i.test(e)&&(o.responseType="document"),o.onloadend=function(){return 200!==o.status?i(o):n(o)},o.send(null)})},O.openDocument=function(e){return B.Unzipped?O.download(B.Path+"/"+e).then(function(e){return e.responseXML})["catch"](function(e){O.error("XHR HTTP status: "+e.status+' "'+e.responseURL+'"')}):Promise.resolve().then(function(){return(new DOMParser).parseFromString(B.Files[e],/\.(xml|opf|ncx)$/i.test(e)?"text/xml":"text/html")})},O.getWritingMode=function(e){var t=getComputedStyle(e);return O.WritingModeProperty?/^vertical-/.test(t[O.WritingModeProperty])?("rtl"==t.direction?"bt":"tb")+"-"+(/-lr$/.test(t[O.WritingModeProperty])?"lr":"rl"):/^horizontal-/.test(t[O.WritingModeProperty])?("rtl"==t.direction?"rl":"lr")+"-"+(/-bt$/.test(t[O.WritingModeProperty])?"bt":"tb"):/^(lr|rl|tb|bt)-/.test(t[O.WritingModeProperty])?t[O.WritingModeProperty]:void 0:"rtl"==t.direction?"rl-tb":"lr-tb"},O.getElementInnerText=function(e){var t="InnerText",n=document.createElement("div");return n.innerHTML=e.innerHTML.replace(/ (src(set)?|source|(xlink:)?href)=/g," data-$1="),sML.each(n.querySelectorAll("svg"),function(){this.parentNode.removeChild(this)}),sML.each(n.querySelectorAll("video"),function(){this.parentNode.removeChild(this)}),sML.each(n.querySelectorAll("audio"),function(){this.parentNode.removeChild(this)}),sML.each(n.querySelectorAll("img"),function(){this.parentNode.removeChild(this)}),sML.each(n.querySelectorAll("script"),function(){this.parentNode.removeChild(this)}),sML.each(n.querySelectorAll("style"),function(){this.parentNode.removeChild(this)}),"undefined"!=typeof n.textContent?t=n.textContent:"undefined"!=typeof n.innerText&&(t=n.innerText),t.replace(/[\r\n\s\t ]/g,"")},O.getElementCoord=function(e){for(var t={X:e.offsetLeft,Y:e.offsetTop};e.offsetParent;)e=e.offsetParent,t.X+=e.offsetLeft,t.Y+=e.offsetTop;return t},O.getPath=function(){var e="",t=arguments[0];if(2==arguments.length&&/^[\w\d]+:\/\//.test(arguments[1]))t=arguments[1];else for(var n=1;n<arguments.length;n++)t+="/"+arguments[n];for(t.replace(/^([a-zA-Z]+:\/\/[^\/]+)?\/*(.*)$/,function(){e=arguments[1],t=arguments[2]});/([^:\/])\/{2,}/.test(t);)t=t.replace(/([^:\/])\/{2,}/g,"$1/");for(;/\/\.\//.test(t);)t=t.replace(/\/\.\//g,"/");for(;/[^\/]+\/\.\.\//.test(t);)t=t.replace(/[^\/]+\/\.\.\//g,"");return t=t.replace(/^(\.\/)+/g,""),e&&(t=e+"/"+t),t},O.stamp=function(e,t){t||(t=O.TimeCard);var n=Date.now()-O.TimeCard.Origin;t[n]&&(e=t[n]+" -&- "+e),t[n]=e},O.TimeCard={Origin:Date.now(),getNow:function(){return(Date.now()-O.TimeCard.Origin)/1e3+"sec"}},E={},E.Binded={},E.add=function(e,t,n){return"string"==typeof e&&/^bibi:/.test(e)&&"function"==typeof t?(t.bibiEventListener||(t.bibiEventListener=function(e){return t.call(document,e.detail)}),(n?n:document).addEventListener(e,t.bibiEventListener,!1),t):!1},E.remove=function(e,t,n){return"string"==typeof e&&/^bibi:/.test(e)&&"function"==typeof t&&"function"==typeof t.bibiEventListener?((n?n:document).removeEventListener(e,t.bibiEventListener),!0):!1},E.bind=function(e,t){return"string"!=typeof e||"function"!=typeof t?!1:(E.Binded[e]instanceof Array||(E.Binded[e]=[]),E.Binded[e].push(t),{Name:e,Index:E.Binded[e].length-1,Function:t})},E.unbind=function(e){if(!e)return!1;if("string"==typeof arguments[0]&&"function"==typeof arguments[1]&&(e={Name:arguments[0],Function:arguments[1]}),"object"!=typeof e||"string"!=typeof e.Name||!(E.Binded[e.Name]instanceof Array))return!1;if("number"==typeof e.Index)return"function"!=typeof E.Binded[e.Name][e.Index]?!1:(E.Binded[e.Name][e.Index]=void 0,!0);if("function"==typeof e.Function){for(var t=!1,n=0,i=E.Binded[e.Name].length;i>n;n++)E.Binded[e.Name][n]==e.Function&&(E.Binded[e.Name][n]=void 0,t=!0);return t}return delete E.Binded[e.Name]},E.dispatch=function(e,t,n){if(E.Binded[e]instanceof Array)for(var i=0,o=E.Binded[e].length;o>i;i++)"function"==typeof E.Binded[e][i]&&E.Binded[e][i].call(Bibi,t);return(n?n:document).dispatchEvent(new CustomEvent(e,{detail:t}))},M={},M.post=function(e,t){return O.WindowEmbedded&&"string"==typeof e&&e?("string"==typeof t&&t||(t="*"),window.parent.postMessage(e,t)):!1},M.receive=function(e){try{if(e=JSON.parse(e),"object"!=typeof e||!e)return!1;for(var t in e)/^bibi:command:/.test(t)&&E.dispatch(t,e[t]);return!0}catch(n){}return!1},M.gate=function(e){if(e&&e.data)for(var t=0,n=S["trustworthy-origins"].length;n>t;t++)if(S["trustworthy-origins"][t]==e.origin)return M.receive(e.data)},X={},X.Extensions=[],X.add=function(e){return e&&"object"==typeof e?"string"!=typeof e.name?function(){E.bind("bibi:ready",function(){O.error("Extension name is invalid.")})}:X[e.name]?function(){E.bind("bibi:ready",function(){O.error('Extension name "'+e.name+'" is reserved or already taken.')})}:("string"!=typeof e.description&&(e.decription=""),"string"!=typeof e.author&&(e.author=""),"string"!=typeof e.version&&(e.version=""),"string"!=typeof e.build&&(e.build=""),X.Extensions.push(e),X[e.name]=e,function(t){E.bind("bibi:ready",function(){t.call(e)})}):function(){return!1}},Bibi.x=X.add,/*!
 *
 * # BiB/i Extension: C+Mover
 *
 * - Copyright (c) Satoru MATSUSHIMA - http://bibi.epub.link/ or https://github.com/satorumurmur/bibi
 * - Licensed under the MIT license. - http://www.opensource.org/licenses/mit-license.php
 */
Bibi.x({name:"C+Mover",description:"Utilities and UIs for Moving (Scrolling and Page-Flipping by Clicking, Tapping or Swiping)",author:"Satoru MATSUSHIMA (@satorumurmur)",version:Bibi.version,build:Bibi.build})(function(){C.Mover={Borders:{"default":37,touch:.4},getArea:function(e){if(!e)return{};var t,n,i=[],o=[];e.srcElement.ownerDocument.documentElement==O.HTML?(t=e.pageX,n=e.pageY):(ItemCoord=O.getElementCoord(e.srcElement.ownerDocument.documentElement.Item),HTMLXY={X:ItemCoord.X+S["item-padding-left"],Y:ItemCoord.Y+S["item-padding-top"]},t=HTMLXY.X+e.pageX-R.Main.scrollLeft,n=HTMLXY.Y+e.pageY-R.Main.scrollTop);var r=C.Mover.Borders[O.TouchActive?"touch":"default"];i[0]=o[0]=r,1>r?(t/=window.innerWidth,n/=window.innerHeight,i[1]=o[1]=1-r):(i[1]=window.innerWidth-i[0],o[1]=window.innerHeight-o[0]);return t=t<i[0]?"left":i[1]<t?"right":"center",n=n<o[0]?"top":o[1]<n?"bottom":"middle",{X:t,Y:n}},preventDefault:function(e){return e.preventDefault(),!1}},C.Arrows={createArrows:function(){if(!C.Arrows.Back&&!C.Arrows.Forward){S["hide-arrows"]&&sML.addClass(O.HTML,"hide-arrows"),C.Arrows.Back=C.Arrows.back=R.Main.appendChild(sML.create("div",{className:"bibi-arrow",id:"bibi-arrow-back",Distance:-1,Labels:{"default":{ja:"",en:"Back"}},isAvailable:function(){return R.Current.Pages.StartPage!=R.Pages[0]||100!=R.Current.Pages.StartPageRatio}})),C.Arrows.Forward=C.Arrows.forward=R.Main.appendChild(sML.create("div",{className:"bibi-arrow",id:"bibi-arrow-forward",Distance:1,Labels:{"default":{ja:"",en:"Forward"}},isAvailable:function(){return R.Current.Pages.EndPage!=R.Pages[R.Pages.length-1]||100!=R.Current.Pages.EndPageRatio}})),C.Arrows.Back.Pair=C.Arrows.Forward,C.Arrows.Forward.Pair=C.Arrows.Back,[C.Arrows.Back,C.Arrows.Forward].forEach(function(e){C.setLabels(e),C.setFeedback(e),e.showHelp=e.hideHelp=function(){},O.Mobile||(e.removeEventListener("mouseover",e.hover),e.removeEventListener("mouseout",e.unhover))}),R.Items.concat(O).forEach(function(e){});O.Mobile||R.Items.concat(O).forEach(function(e){e.HTML.addEventListener("mousemove",C.Arrows.hover),e.HTML.addEventListener("mouseover",C.Arrows.hover),e.HTML.addEventListener("mouseout",C.Arrows.hover),sML.each(e.Body.querySelectorAll("img"),function(){this.addEventListener("mousedown",C.Mover.preventDefault)})}),R.Items.concat(O).forEach(function(e){C.observeTap(e.HTML).addTapEventListener(function(e){C.Arrows.go(e)})})}},update:function(){"vertical"==S.RVM?(C.Arrows.top=C.Arrows.Back,C.Arrows.bottom=C.Arrows.Forward,C.Arrows.left=C.Arrows.right=void 0):("ltr"==S.PPD?(C.Arrows.left=C.Arrows.Back,C.Arrows.right=C.Arrows.Forward):(C.Arrows.right=C.Arrows.Back,C.Arrows.left=C.Arrows.Forward),C.Arrows.top=C.Arrows.bottom=void 0)},navigate:function(){setTimeout(function(){R.getCurrent(),[C.Arrows.Back,C.Arrows.Forward].forEach(function(e){e.isAvailable()&&sML.addClass(e,"glowing")}),setTimeout(function(){[C.Arrows.Back,C.Arrows.Forward].forEach(function(e){sML.removeClass(e,"glowing")})},1234)},420)},activate:function(e){var t="";switch(e){case-1:t="back";break;case 1:t="forward"}return t&&C.Arrows[t]?C.Arrows[t].activate():void 0},isAvailable:function(e){if(1==C.Panel.State)return!1;if(e.srcElement.ownerDocument.documentElement==O.HTML){if(e.srcElement==R.Main.Book||/^(spread|item|bibi-arrow)/.test(e.srcElement.className))return!0}else if(!/^a$/i.test(e.srcElement.tagName))return!0;return!1},go:function(e,t){if(!C.Arrows.isAvailable(e))return!1;var n=C.Mover.getArea(e),i="vertical"==S.RVM?n.Y:n.X;C.Arrows[i]&&C.Arrows[i].isAvailable()&&E.dispatch("bibi:command:move",C.Arrows[i].Distance)},hover:function(e){if(!O.Mobile){if(!C.Arrows.isAvailable(e))return C.Arrows.unhover();var t=C.Mover.getArea(e),n="vertical"==S.RVM?t.Y:t.X;C.Arrows[n]&&C.Arrows[n].isAvailable()?(C.Arrows[n].hover(),C.Arrows[n].Pair.unhover(),e.srcElement.ownerDocument.documentElement.setAttribute("data-bibi-cursor",n)):C.Arrows.unhover()}},unhover:function(){C.Arrows.Back.unhover(),C.Arrows.Forward.unhover(),R.Items.concat(O).forEach(function(e){e.HTML.removeAttribute("data-bibi-cursor")})}},E.add("bibi:open",function(){C.Arrows.createArrows(),C.Arrows.update(),C.Arrows.navigate()}),E.add("bibi:updateSetting",function(){C.Arrows.update()}),E.add("bibi:relayout",function(){C.Arrows.navigate()}),E.add("bibi:command:move",function(e){C.Arrows.activate(e)}),C.Touch={State:0,UserChanged:!1,createButton:function(){C.Touch.Button||(C.Touch.Button=C.addButton({className:"bibi-button-toggle-touch",Type:"toggle",Area:C.SwitchBeta,Labels:{"default":{ja:"",en:"Toggle Tap/Swipe Availability (Current: OFF)"},active:{ja:"",en:"Toggle Tap/Swipe Availability (Current: ON)"}},execute:function(){C.Touch.toggle(),C.Touch.UserChanged=!0}}),E.add("bibi:activateTouch",function(){C.setState(C.Touch.Button,"active")}),E.add("bibi:deactivateTouch",function(){C.setState(C.Touch.Button,"")}))},update:function(){return L.Loaded&&!this.UserChanged?("paged"==S.RVM?this.activate():this.deactivate(),E.dispatch("bibi:updateTouch",this.State),this.State):void 0},activate:function(e){if(1==this.State)return"function"==typeof e&&e(),1;O.TouchActive=!0,this.State=1,this.activateElement(R.Main);for(var t=0,n=R.Items.length;n>t;t++)this.activateElement(R.Items[t].HTML);return E.dispatch("bibi:activateTouch"),"function"==typeof e&&setTimeout(e,0),O.log("Touch Activated.","-*"),this.State},activateElement:function(e){sML.addClass(e,"touch-active"),sML.observeTouch(e).addTouchEventListener("swipe",C.Touch.swipe),O.Mobile||sML.each(e.querySelectorAll("img"),function(){this.addEventListener("mousedown",C.Mover.preventDefault)})},deactivate:function(e){if(0==this.State)return"function"==typeof e&&e(),0;O.TouchActive=!1,this.State=0,this.deactivateElement(R.Main);for(var t=0,n=R.Items.length;n>t;t++)this.deactivateElement(R.Items[t].HTML);return E.dispatch("bibi:deactivateTouch"),"function"==typeof e&&setTimeout(e,0),O.log("Touch Deactivated.","-*"),this.State},deactivateElement:function(e){sML.removeClass(e,"touch-active"),sML.unobserveTouch(e),O.Mobile||sML.each(e.querySelectorAll("img"),function(){this.removeEventListener("mousedown",C.Mover.preventDefault)})},toggle:function(e){return this.State?this.deactivate():this.activate(),E.dispatch("bibi:toggleTouch",this.State),"function"==typeof e&&setTimeout(e,0),this.State},swipe:function(e,t){var n=t.angle+90,i={From:"",To:""};0>n&&(n+=360),n>=330||30>=n?(i.From="bottom",i.To="top"):n>=60&&120>=n?(i.From="left",i.To="right"):n>=150&&210>=n?(i.From="top",i.To="bottom"):n>=240&&300>=n&&(i.From="right",i.To="left"),C.Arrows[i.From]&&C.Arrows[i.From].isAvailable()&&E.dispatch("bibi:command:move",C.Arrows[i.From].Distance)}},E.add("bibi:loadItem",function(e){sML.appendStyleRule('html[data-bibi-cursor="left"]',"cursor: w-resize;",e.contentDocument),sML.appendStyleRule('html[data-bibi-cursor="right"]',"cursor: e-resize;",e.contentDocument),sML.appendStyleRule('html[data-bibi-cursor="top"]',"cursor: n-resize;",e.contentDocument),sML.appendStyleRule('html[data-bibi-cursor="bottom"]',"cursor: s-resize;",e.contentDocument)}),E.add("bibi:loadBook",function(){C.Touch.createButton()}),E.add("bibi:layout",function(){C.Touch.update()}),E.add("bibi:command:activateTouch",function(){C.Touch.activate()}),E.add("bibi:command:deactivateTouch",function(){C.Touch.deactivate()}),E.add("bibi:command:toggleTouch",function(){C.Touch.toggle()}),C.Keys={observe:function(e){if(L.Opened){e.preventDefault();var t=void 0;switch(e.keyCode){case 37:t="left";break;case 38:t="top";break;case 39:t="right";break;case 40:t="bottom"}C.Arrows[t]&&E.dispatch("bibi:command:move",C.Arrows[t].Distance)}},listen:function(){R.Items.forEach(function(e){e.contentWindow.addEventListener("keydown",C.Keys.observe,!1)}),window.addEventListener("keydown",C.Keys.observe,!1)}},E.add("bibi:start",function(){C.Keys.listen()})}),/*!
 *
 * # BiB/i Extension: C+Indicators
 *
 * - Copyright (c) Satoru MATSUSHIMA - http://bibi.epub.link/ or https://github.com/satorumurmur/bibi
 * - Licensed under the MIT license. - http://www.opensource.org/licenses/mit-license.php
 */
Bibi.x({name:"C+Indicators",description:"Add Indicators.",author:"Satoru MATSUSHIMA (@satorumurmur)",version:Bibi.version,build:Bibi.build})(function(){C.Indicator=O.Body.appendChild(sML.create("div",{id:"bibi-indicator"})),C.Indicator.Mark=C.Indicator.appendChild(sML.create("div",{id:"bibi-indicator-mark"}));for(var e=1;12>=e;e++)C.Indicator.Mark.appendChild(document.createElement("span"));E.add("bibi:startLoading",function(){sML.addClass(O.HTML,"loading"),C.note("Loading...")}),E.add("bibi:stopLoading",function(){sML.removeClass(O.HTML,"loading")}),C.Indicator.Progress=C.Indicator.appendChild(sML.create("div",{id:"bibi-indicator-progress"})),C.Indicator.Progress.progress=function(){clearTimeout(C.Indicator.Progress.Timer_vanish),clearTimeout(C.Indicator.Progress.Timer_transparentize),setTimeout(function(){sML.addClass(C.Indicator.Progress,"active")},0),setTimeout(function(){sML.addClass(C.Indicator.Progress,"hot")},10),C.Indicator.Progress.Timer_transparentize=setTimeout(function(){sML.removeClass(C.Indicator.Progress,"hot")},1981),C.Indicator.Progress.Timer_vanish=setTimeout(function(){sML.removeClass(C.Indicator.Progress,"active")},2236),E.dispatch("bibi:indicator:progress")},C.Indicator.Progress.Nombre=C.Indicator.Progress.appendChild(sML.create("div",{id:"bibi-indicator-progress-nombre"})),sML.appendStyleRule("html.view-horizontal div#bibi-indicator-progress-nombre","bottom: "+(O.Scrollbars.Height+2)+"px;"),sML.appendStyleRule("html.view-vertical   div#bibi-indicator-progress-nombre","right: "+(O.Scrollbars.Width+2)+"px;"),C.Indicator.Progress.Nombre.Current=C.Indicator.Progress.Nombre.appendChild(sML.create("span",{id:"bibi-indicator-progress-nombre-current"})),C.Indicator.Progress.Nombre.Delimiter=C.Indicator.Progress.Nombre.appendChild(sML.create("span",{id:"bibi-indicator-progress-nombre-delimiter"})),C.Indicator.Progress.Nombre.Total=C.Indicator.Progress.Nombre.appendChild(sML.create("span",{id:"bibi-indicator-progress-nombre-total"})),C.Indicator.Progress.Nombre.Percent=C.Indicator.Progress.Nombre.appendChild(sML.create("span",{id:"bibi-indicator-progress-nombre-percent"})),E.add("bibi:indicator:progress",function(){C.Indicator.Progress.Nombre.Current.innerHTML=function(){var e=R.Current.Pages.StartPage.PageIndex+1;return R.Current.Pages.StartPage!=R.Current.Pages.EndPage&&(e+='<span class="delimiter">-</span>'+(R.Current.Pages.EndPage.PageIndex+1)),e}(),C.Indicator.Progress.Nombre.Delimiter.innerHTML="/",C.Indicator.Progress.Nombre.Total.innerHTML=R.Pages.length,C.Indicator.Progress.Nombre.Percent.innerHTML="("+R.Current.Percent+'<span class="unit">%</span>)'}),C.Indicator.Progress.Bar=C.Indicator.Progress.appendChild(sML.create("div",{id:"bibi-indicator-progress-bar"})),C.Indicator.Progress.Bar.Pages=C.Indicator.Progress.Bar.appendChild(sML.create("div",{id:"bibi-indicator-progress-bar-pages"})),C.Indicator.Progress.Bar.Current=C.Indicator.Progress.Bar.appendChild(sML.create("div",{id:"bibi-indicator-progress-bar-current"})),E.add("bibi:indicator:progress",function(){C.Indicator.Progress.Bar.Current.className=R.Current.Pages.length>1?"two-pages":"",C.Indicator.Progress.Bar.Current.style.width=100/R.Pages.length*R.Current.Pages.length+"%",C.Indicator.Progress.Bar.Current.style["ltr"==S.PPD?"right":"left"]=(R.Pages.length-R.Current.PageNumber)/R.Pages.length*100+"%"}),E.add("bibi:layout",function(){C.Indicator.Progress.Bar.Pages.innerHTML="",R.Pages.forEach(function(e,t){var n=C.Indicator.Progress.Bar.Pages.appendChild(sML.create("div",{innerHTML:"<div>"+(t+1)+"</div>"},{width:100/R.Pages.length+"%"}));n.style["ltr"==S.PPD?"left":"right"]=100/R.Pages.length*t+"%",C.setFeedback(n)})}),C.Indicator.Progress.Bar.addEventListener("click",function(e){var t=(e.srcElement.offsetLeft+e.offsetX)/C.Indicator.Progress.Bar.offsetWidth;"rtl"==S.PPD&&(t=1-t);var n=R.Pages[Math.ceil(R.Pages.length*t)-1];n!=R.Current.Pages.StartPage&&n!=R.Current.Pages.EndPage&&R.focus(n)}),E.add("bibi:scrolled",C.Indicator.Progress.progress),E.add("bibi:start",function(){setTimeout(C.Indicator.Progress.progress,321)})}),/*!
 *
 * # BiB/i Extension: C+WindowUtilities
 *
 * - Copyright (c) Satoru MATSUSHIMA - http://bibi.epub.link/ or https://github.com/satorumurmur/bibi
 * - Licensed under the MIT license. - http://www.opensource.org/licenses/mit-license.php
 */
Bibi.x({name:"C+WindowUtilities",description:"Menu Buttons to Enter Fullscreen, Open in New Window, and Share.",author:"Satoru MATSUSHIMA (@satorumurmur)",version:Bibi.version,build:Bibi.build})(function(){var e=C.addButtonGroup({Area:C.Panel.MenuAlpha});O.FullscreenEnabled&&C.addButton({className:"bibi-button-toggle-fullscreen",Type:"toggle",Group:e,Labels:{"default":{ja:"",en:"Enter Fullscreen"},active:{ja:"",en:"Exit Fullscreen"}},execute:function(){O.FullscreenElement.Fullscreen?sML.exitFullscreen(O.FullscreenDocument):sML.requestFullscreen(O.FullscreenElement),C.Panel.toggle(function(){O.FullscreenElement.Fullscreen?(O.FullscreenElement.Fullscreen=!1,E.dispatch("bibi:exitFullscreen"),sML.removeClass(O.HTML,"fullscreen")):(O.FullscreenElement.Fullscreen=!0,E.dispatch("bibi:requestFullscreen"),sML.addClass(O.HTML,"fullscreen"))})}}),O.WindowEmbedded&&C.addButton({tagName:"a",className:"bibi-button-open-newwindow",href:location.href,target:"_blank",Group:e,Labels:{"default":{ja:"",en:"Open in New Window"}}}),E.dispatch("bibi:createWindowMenu")}),/*!
 *
 * # BiB/i Extension: C+ViewChanger
 *
 * - Copyright (c) Satoru MATSUSHIMA - http://bibi.epub.link/ or https://github.com/satorumurmur/bibi
 * - Licensed under the MIT license. - http://www.opensource.org/licenses/mit-license.php
 */
Bibi.x({name:"C+ViewChanger",description:"Menu Buttons to Change View Mode.",author:"Satoru MATSUSHIMA (@satorumurmur)",version:Bibi.version,build:Bibi.build})(function(){if(!S["reader-view-mode-fixed"]){var e={};e.Item='<span class="bibi-shape bibi-shape-item"></span>',e.Spread='<span class="bibi-shape bibi-shape-spread">'+e.Item+e.Item+"</span>",e.SpreadsP='<span class="bibi-shape bibi-shape-spreads bibi-shape-spreads-paged">'+e.Spread+e.Spread+e.Spread+"</span>",e.SpreadsH='<span class="bibi-shape bibi-shape-spreads bibi-shape-spreads-horizontal">'+e.Spread+e.Spread+e.Spread+"</span>",e.SpreadsV='<span class="bibi-shape bibi-shape-spreads bibi-shape-spreads-vertical">'+e.Spread+e.Spread+e.Spread+"</span>";var t=function(){var e=this;C.Panel.toggle(function(){R.changeView(e.Value)})},n=C.addButtonGroup({Area:C.Panel.MenuAlpha});C.addButton({className:"bibi-button-view-paged",extraHTML:e.SpreadsP,Type:"radio",Value:"paged",Group:n,Labels:{"default":{ja:"",en:"Change to Paged View"},active:{ja:"",en:"Paged View (Selected)"}},execute:t}),C.addButton({className:"bibi-button-view-horizontal",extraHTML:e.SpreadsH,Type:"radio",Value:"horizontal",Group:n,Labels:{"default":{ja:"",en:"Change to Horizontal-Scroll View"},active:{ja:"",en:"Horizontal-Scroll View (Selected)"}},execute:t}),C.addButton({className:"bibi-button-view-vertical",extraHTML:e.SpreadsV,Type:"radio",Value:"vertical",Group:n,Labels:{"default":{ja:"",en:"Change to Vertical-Scroll View"},active:{ja:"",en:"Vertical-Scroll View (Selected)"}},execute:t}),E.add("bibi:updateSetting",function(){n.Buttons.forEach(function(e){C.setState(e,e.Value==S.RVM?"active":"default")})}),E.dispatch("bibi:createViewMenu")}});